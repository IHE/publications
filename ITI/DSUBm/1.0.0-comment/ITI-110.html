<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>2:3.110 Resource Subscription [ITI-110] - Document Subscription for Mobile (DSUBm) v1.0.0-comment</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->
<link href="assets/css/ihe.css" rel="stylesheet"/>
<link href="assets/css/nonum.css" rel="stylesheet"/>
<script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-HLBNC861DJ" async> </script> 


    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="fhir-logo" sizes="144x144" href="assets/ico/icon-fhir-144.png"/>
    <link rel="fhir-logo" sizes="114x114" href="assets/ico/icon-fhir-114.png"/>
    <link rel="fhir-logo" sizes="72x72" href="assets/ico/icon-fhir-72.png"/>
    <link rel="fhir-logo" href="assets/ico/icon-fhir-57.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"3"}
    h3,h4,h5,h6{--heading-prefix:"3"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->
      <div class="container">  <!-- container -->
        <!-- Placeholder for child template header declarations -->

<div id="project-nav">
  <a id="ihe-logo" no-external="true" href="http://profiles.ihe.net">
    <img height="71" alt="Visit the IHE website" src="assets/images/ihe-international.png"/>
  </a>
</div>
<div id="family-nav">
  <a id="family-logo" no-external="true" href="http://hl7.org/fhir"><img height="30" alt="Visit the FHIR website" src="assets/images/fhir-logo.png"/> </a>
</div>
<!--
<div id="hl7-search">
  <a id="hl7-search-lnk" no-external="true" href="searchform.html"><img alt="Search FHIR" src="assets/images/search.png"/></a>
</div>
-->
<div id="project-nav">
  
  
    <a id="project-logo" no-external="true" href="http://profiles.ihe.net/ITI/index.html"><img height="70" alt="Visit the ITI website" src="assets/images/ITI.png"/> </a>
</div>

        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">Document Subscription for Mobile (DSUBm)</span>
            <br/>
            <span style="display:inline-block;">1.0.0-comment - ballot



  <img alt="International flag" src="assets/images/001.svg" height="16" title="International"/>


            </span>
          </p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->

    <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">  <!-- container -->
        <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
          <!--status-bar-->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a class="navbar-brand hidden" href="http://hl7.org/fhir/R5/index.html">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <!-- menu.xml  -->

<ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
  <li>
    <a href="index.html">DSUBm Home</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Volume 1
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="volume-1.html">Introduction</a>
      </li>
      <li>
        <a href="volume-1.html#1541-dsubm-actors-transactions-and-content-modules">Actors and Transactions</a>
      </li>
      <li>
        <a href="volume-1.html#1542-actor-options">Actor Options</a>
      </li>
      <li>
        <a href="volume-1.html#1543-required-actor-groupings">Required Groupings</a>
      </li>
      <li>
        <a href="volume-1.html#1544-dsubm-overview">Overview</a>
      </li>
      <li>
        <a href="volume-1.html#1545-security-considerations">Security Considerations</a>
      </li>
      <li>
        <a href="volume-1.html#1546-cross-profile-considerations">Cross-Profile Considerations</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Volume 2
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="ITI-110.html">Resource Subscription [ITI-110]</a>
      </li>
      <li>
        <a href="ITI-111.html">Resource Publish [ITI-111]</a>
      </li>
      <li>
        <a href="ITI-112.html">Resource Notify [ITI-112]</a>
      </li>
      <li>
        <a href="ITI-113.html">Resource Subscription Search [ITI-113]</a>
      </li>
      <li>
        <a href="ITI-114.html">Resource SubscriptionTopic Search [ITI-114]</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="artifacts.html">Artifacts</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Other
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="other.html">Changes to Other IHE Specifications</a>
      </li>
      <li>
        <a href="download.html">Download and Analysis</a>
      </li>
      <li>
        <a href="testplan.html">Test Plan</a>
      </li>
    </ul>
  </li>
</ul>
            </div>  <!-- /.nav-collapse -->
          </div>  <!-- /.container -->
        </nav>  <!-- /.navbar -->
      <!-- /HEADER CONTENT -->
      </div>  <!-- /container -->
    </div>  <!-- /segment-navbar -->
    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><b>2:3.110 Resource Subscription [ITI-110]</b></li>

          <span style="float:right;">

            <a href="volume-1.html">&lt;prev</a> | 

            <a href="#bottom">bottom</a>

          | <a href="ITI-111.html">next&gt;</a>

          </span>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">This page is part of the Document Subscription for Mobile (DSUBm) (v1.0.0-comment: Publication Ballot 1) based on <a no-external="true" href="http://hl7.org/fhir/4.3.0">FHIR v4.3.0</a>. .  For a full list of available versions, see the <a no-external="true" href="https://profiles.ihe.net/ITI/DSUBm/history.html">Directory of published versions</a></p><!--EndReleaseHeader-->
  <h2>2:3.110 Resource Subscription [ITI-110]</h2>
  












    <p><!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#231101-scope" id="markdown-toc-231101-scope">2:3.110.1 Scope</a></li>
  <li><a href="#231102-actors-roles" id="markdown-toc-231102-actors-roles">2:3.110.2 Actors Roles</a></li>
  <li><a href="#231103-referenced-standards" id="markdown-toc-231103-referenced-standards">2:3.110.3 Referenced Standards</a></li>
  <li><a href="#231104-interactions" id="markdown-toc-231104-interactions">2:3.110.4 Interactions</a></li>
  <li><a href="#231105-create-subscription-request-message" id="markdown-toc-231105-create-subscription-request-message">2:3.110.5 Create Subscription Request Message</a></li>
  <li><a href="#231106-create-subscription-response-message" id="markdown-toc-231106-create-subscription-response-message">2:3.110.6 Create Subscription Response Message</a></li>
  <li><a href="#231107-update-subscription-request-message" id="markdown-toc-231107-update-subscription-request-message">2:3.110.7 Update Subscription Request Message</a></li>
  <li><a href="#231108-update-subscription-response-message" id="markdown-toc-231108-update-subscription-response-message">2:3.110.8 Update Subscription Response Message</a></li>
  <li><a href="#231109-subscription-topic-and-filter-expressions" id="markdown-toc-231109-subscription-topic-and-filter-expressions">2:3.110.9 Subscription Topic and Filter Expressions</a></li>
  <li><a href="#2311010-mapping-between-dsubm-criteria-and-dsub-subscription-filters" id="markdown-toc-2311010-mapping-between-dsubm-criteria-and-dsub-subscription-filters">2:3.110.10 Mapping between DSUBm Criteria and DSUB subscription Filters.</a></li>
  <li><a href="#2311011-capabilitystatement-resource" id="markdown-toc-2311011-capabilitystatement-resource">2:3.110.11 CapabilityStatement Resource</a></li>
  <li><a href="#2311012-security-considerations" id="markdown-toc-2311012-security-considerations">2:3.110.12 Security Considerations</a></li>
</ul>

</div>
<p>This section corresponds to the Resource Subscription [ITI-110] transaction of the IHE Technical Framework. The Resource Subscription [ITI-110] transaction is used by the Resource Notification Subscriber and Resource Notification Broker actors to submit a subscription in order to receive a notification.</p>

<h3 id="231101-scope">2:3.110.1 Scope</h3>

<p>The Resource Subscription [ITI-110] transaction passes a Resource Subscription Request from a Resource Notification Subscriber to a Resource Notification Broker. This transaction can be used to <strong>create a new Subscription</strong> or to <strong>update an existing Subscription</strong>. The update of the subscription is intended to be used only to <strong>unsubscribe (deactivate)</strong> to an existing Subscription or <strong>re-activate</strong> an already existing Subscription (in case of errors or deactivation).</p>

<h3 id="231102-actors-roles">2:3.110.2 Actors Roles</h3>

<p><strong>Table 2:3.110.2-1: Actor Roles</strong></p>

<table class="grid">
  <thead>
    <tr>
      <th>Actor</th>
      <th>Role</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="volume-1.html#154112-resource-notification-subscriber">Resource Notification Subscriber</a></td>
      <td>Sends the Subscription request to the Resource Notification Broker</td>
    </tr>
    <tr>
      <td><a href="volume-1.html#154111-resource-notification-broker">Resource Notification Broker</a></td>
      <td>Receives and processes the Subscription request</td>
    </tr>
  </tbody>
</table>

<h3 id="231103-referenced-standards">2:3.110.3 Referenced Standards</h3>

<p><strong>FHIR-R4B</strong> <a href="https://www.hl7.org/FHIR/R4B">HL7 FHIR Release 4.3.0</a></p>

<h3 id="231104-interactions">2:3.110.4 Interactions</h3>

<figure>
<?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="274px" preserveAspectRatio="none" style="width:489px;height:274px;background:#FFFFFF;" version="1.1" viewBox="0 0 489 274" width="489px" zoomAndPan="magnify"><defs /><g><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="375" y="114.3125" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="375" y="219.3672" /><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="115" x2="115" y1="37.6094" y2="267.7188" /><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="380" x2="380" y1="37.6094" y2="267.7188" /><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="220" x="5" y="5" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="206" x="12" y="26.5332">Resource Notification Subscriber</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="194" x="283" y="5" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="180" x="290" y="26.5332">Resource Notification Broker</text><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="375" y="114.3125" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="375" y="219.3672" /><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="482" x="0" y="68.7852" /><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="482" y1="68.7852" y2="68.7852" /><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="482" y1="71.7852" y2="71.7852" /><rect fill="#EEEEEE" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="81" x="200.5" y="57.6094" /><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="206.5" y="75.1045">Subscribe</text><polygon fill="#181818" points="363,110.3125,373,114.3125,363,118.3125,367,114.3125" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="115" x2="369" y1="114.3125" y2="114.3125" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="122" y="109.4561">Create Subscription Request</text><polygon fill="#181818" points="126,140.6641,116,144.6641,126,148.6641,122,144.6641" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="120" x2="379" y1="144.6641" y2="144.6641" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="132" y="139.8076">Create Subscription Response Message</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="482" x="0" y="173.8398" /><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="482" y1="173.8398" y2="173.8398" /><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="482" y1="176.8398" y2="176.8398" /><rect fill="#EEEEEE" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="95" x="193.5" y="162.6641" /><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="77" x="199.5" y="180.1592">Unsubscribe</text><polygon fill="#181818" points="363,215.3672,373,219.3672,363,223.3672,367,219.3672" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="115" x2="369" y1="219.3672" y2="219.3672" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="122" y="214.5107">Update Subscription Request</text><polygon fill="#181818" points="126,245.7188,116,249.7188,126,253.7188,122,249.7188" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="120" x2="379" y1="249.7188" y2="249.7188" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="132" y="244.8623">Update Subscription Response Message</text></g></svg>
<figcaption><b>Figure 2:3.110.4-1: Resource Subscription [ITI-110] interactions</b></figcaption>
</figure>
<p><br clear="all" /></p>

<h3 id="231105-create-subscription-request-message">2:3.110.5 Create Subscription Request Message</h3>
<p>This message uses the HTTP POST method on the target Resource Notification Broker endpoint to submit the Subscription resource.</p>

<h4 id="2311051-trigger-events">2:3.110.5.1 Trigger Events</h4>

<p>This method is invoked when the Resource Notification Subscriber needs to submit a new subscription resource to the Resource Notification Broker. The Resource Notification Subscriber shall have already discovered the SubscriptionTopics supported by the Resource Notification Broker in order to create a subscription. The discovery should be performed by the <a href="ITI-114.html">Resource SubscriptionTopic Search [ITI-114]</a> transaction or may be performed by any other methods that are out of the scope of this profile.</p>

<h4 id="2311052-message-semantics">2:3.110.5.2 Message Semantics</h4>

<p>The Resource Notification Subscriber shall initiate an HTTP request according to the requirements defined in the HL7® FHIR® standard for the “<a href="https://hl7.org/fhir/R4B/http.html#create">create</a>” interaction. The message uses an HTTP POST method to submit a Subscription FHIR Resource as specified in <a href="#23110521-subscription-resource">3.110.5.2.1 Subscription Resource paragraph</a>.</p>

<p>The Resource Notification Subscriber actor shall submit the FHIR Subscription resource in either XML format or JSON format thus the media type of the HTTP body shall be either <code class="language-plaintext highlighter-rouge">application/fhir+json</code> or <code class="language-plaintext highlighter-rouge">application/fhir+xml</code> respectively.</p>

<p>The Subscription is sent to the base URL as defined in FHIR. See <a href="https://hl7.org/fhir/R4B/http.html">http://hl7.org/fhir/R4B/http.html</a> for the definition of “HTTP” access methods and “base.”</p>

<p>It is possible to use HTTP protocol or HTTPS protocol. The HTTPS protocol is highly recommended.</p>

<h5 id="23110521-subscription-resource">2:3.110.5.2.1 Subscription Resource</h5>

<p>The Subscription resource shall be compliant with the <a href="https://hl7.org/fhir/R4B/Subscription.html">Subscription</a> resource and shall be compliant with the <a href="http://hl7.org/fhir/uv/subscriptions-backport/StructureDefinition/backport-subscription">Profile: R4/B Topic-Based Subscription</a>.</p>

<p>The <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element shall include the canonical URL to a SubscriptionTopic resource that represents the Topic that the Subscription resource is related to. The <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element shall support the <a href="https://build.fhir.org/ig/HL7/fhir-subscription-backport-ig/StructureDefinition-backport-filter-criteria.html#root">FilterBy Criteria extension</a>. This extension shall be used to narrow the subscription triggering events defined in the related SubscriptionTopic resource.</p>

<p>All the Subscription resources shall support the following extensions:</p>

<ul>
  <li><a href="http://hl7.org/fhir/uv/subscriptions-backport/StructureDefinition/backport-channel-type">channel type</a></li>
  <li><a href="http://hl7.org/fhir/uv/subscriptions-backport/StructureDefinition/backport-payload-content">payload content</a></li>
</ul>

<p>The Resource Notification Subscriber shall indicate in the <code class="language-plaintext highlighter-rouge">Subscription.payload.content</code> element the level of detail of the future notification that the Resource Notification Broker will send. The payload content extension defines three types of payload:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">empty</code> = No resource content is transmitted in the notification payload.</li>
  <li><code class="language-plaintext highlighter-rouge">id-only</code> = Only the resource id is transmitted in the notification payload.</li>
  <li><code class="language-plaintext highlighter-rouge">full-resource</code> = The entire resource is transmitted in the notification payload.</li>
</ul>

<p>All the Subscription resources shall have <code class="language-plaintext highlighter-rouge">Subscription.status="requested"</code>, <code class="language-plaintext highlighter-rouge">channel.type = "rest-hook"</code>, and <code class="language-plaintext highlighter-rouge">channel.endpoint</code> shall contain the URL that identifies where the Resource Notification Recipient receives the notification.</p>

<p>All the Subscription resources may have <code class="language-plaintext highlighter-rouge">Subscription.end</code> element set, indicating the instant when the subscription automatically terminates.</p>

<p>For documents, different types of subscription resources may be submitted to the Resource Notification Broker.</p>

<p>This profile defines the following types of Subscriptions with related SubscriptionTopic, which the Resource Notification Broker shall support and at least one of them the Resource Notification Subscriber shall support:</p>

<table class="grid">
  <thead>
    <tr>
      <th>Subscription type</th>
      <th>SubscriptionTopic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="StructureDefinition-DSUBm-DocumentReference-PatientDependent-Subscription.html">Patient-Dependent DocumentReference Subscriptions</a></td>
      <td><a href="#2311091-patient-dependent-documentreference-subscription-topic">Patient-Dependent DocumentReference SubscriptionTopic</a></td>
    </tr>
    <tr>
      <td><a href="StructureDefinition-DSUBm-DocumentReference-MultiPatient-Subscription.html">Multi-Patient DocumentReference Subscriptions</a></td>
      <td><a href="#2311092-multi-patient-documentreference-subscriptions-topic">Multi-Patient DocumentReference SubscriptionsTopic</a></td>
    </tr>
    <tr>
      <td><a href="StructureDefinition-DSUBm-SubmissionSet-PatientDependent-Subscription.html">Patient-Dependent SubmissionSet Subscriptions</a></td>
      <td><a href="#2311093-patient-dependent-submissionset-subscription-topic">Patient-Dependent SubmissionSet SubscriptionTopic</a></td>
    </tr>
    <tr>
      <td><a href="StructureDefinition-DSUBm-SubmissionSet-MultiPatient-Subscription.html">Multi-Patient SubmissionSet Subscriptions</a></td>
      <td><a href="#2311094-multi-patient-submissionset-subscription-topic">Multi-Patient SubmissionSet SubscriptionTopic</a></td>
    </tr>
  </tbody>
</table>

<h6 id="231105211-subscription-with-documentreference-subscription-for-minimal-update-option">2:3.110.5.2.1.1 Subscription with DocumentReference Subscription for Minimal Update option</h6>

<p>When supporting the DocumentReference Subscription for Minimal Update option, this profile also defines the following types of Subscriptions with related SubscriptionTopic:</p>

<table class="grid">
  <thead>
    <tr>
      <th>Subscription type</th>
      <th>SubscriptionTopic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="StructureDefinition-DSUBm-DocumentReference-PatientDependent-Subscription-MinUpdate.html">Patient-Dependent DocumentReference Subscriptions with DocumentReference Subscription for Minimal Update option</a></td>
      <td><a href="#23110911-patient-dependent-documentreference-subscription-subscription-with-documentreference-subscription-for-minimal-update-option-topic">Patient-Dependent DocumentReference SubscriptionTopic with DocumentReference Subscription for Minimal Update option</a></td>
    </tr>
    <tr>
      <td><a href="StructureDefinition-DSUBm-DocumentReference-MultiPatient-Subscription-MinUpdate.html">Multi-Patient DocumentReference Subscription DocumentReference Subscription for Minimal Update option</a></td>
      <td><a href="#23110921-multi-patient-documentreference-subscription-subscription-with-documentreference-subscription-for-minimal-update-option-topic">Multi-Patient DocumentReference SubscriptionTopic with DocumentReference Subscription for Minimal Update option</a></td>
    </tr>
  </tbody>
</table>

<h6 id="231105212-subscription-with-documentreference-subscription-for-full-events-option">2:3.110.5.2.1.2 Subscription with DocumentReference Subscription for Full Events option</h6>

<p>When supporting the DocumentReference Subscription for Full Events option, this profile also defines the following types of Subscriptions with related SubscriptionTopic:</p>

<table class="grid">
  <thead>
    <tr>
      <th>Subscription type</th>
      <th>SubscriptionTopic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="StructureDefinition-DSUBm-DocumentReference-PatientDependent-Subscription-AllEvents.html">Patient-Dependent DocumentReference Subscriptions with DocumentReference Subscription for Full Events option</a></td>
      <td><a href="#23110912-patient-dependent-documentreference-subscription-subscription-with-documentreference-subscription-for-full-events-option-topic">Patient-Dependent DocumentReference SubscriptionTopic with DocumentReference Subscription for Full Events option</a></td>
    </tr>
    <tr>
      <td><a href="StructureDefinition-DSUBm-DocumentReference-MultiPatient-Subscription-AllEvents.html">Multi-Patient DocumentReference Subscription with DocumentReference Subscription for Full Events option</a></td>
      <td><a href="#23110922-multi-patient-documentreference-subscription-subscription-with-documentreference-subscription-for-full-events-option-topic">Multi-Patient DocumentReference SubscriptionTopic with DocumentReference Subscription for Full Events option</a></td>
    </tr>
  </tbody>
</table>

<h6 id="231105213-subscription-with-basic-folder-subscription-option">2:3.110.5.2.1.3 Subscription with Basic Folder Subscription option</h6>

<p>When supporting the Basic Folder Subscription option, this profile also defines the following types of Subscriptions with related SubscriptionTopic:</p>

<table class="grid">
  <thead>
    <tr>
      <th>Subscription type</th>
      <th>SubscriptionTopic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="StructureDefinition-DSUBm-Basic-Folder-Subscription.html">Basic Folder Subscriptions</a></td>
      <td><a href="#2311095-basic-folder-subscription-topic">Basic Folder SubscriptionTopic</a></td>
    </tr>
  </tbody>
</table>

<h6 id="231105214-subscription-with-folder-subscription-for-minimal-update-option">2:3.110.5.2.1.4 Subscription with Folder Subscription for Minimal Update option</h6>

<p>When supporting the Folder Subscription for Minimal Update option, this profile also defines the following types of Subscriptions with related SubscriptionTopic:</p>

<table class="grid">
  <thead>
    <tr>
      <th>Subscription type</th>
      <th>SubscriptionTopic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="StructureDefinition-DSUBm-Folder-Subscription-MinUpdateOpt.html">Folder Subscriptions with Folder Subscription for Minimal Update option</a></td>
      <td><a href="#23110951-folder-subscription-with-folder-subscription-for-minimal-update-option-topic">Folder SubscriptionTopic with Folder Subscription for Minimal Update option</a></td>
    </tr>
  </tbody>
</table>

<h6 id="231105215-subscription-with-folder-subscription-for-update-option">2:3.110.5.2.1.5 Subscription with Folder Subscription for Update option</h6>

<p>When supporting the Folder Subscription for Update option, this profile also defines the following types of Subscriptions with related SubscriptionTopic:</p>

<table class="grid">
  <thead>
    <tr>
      <th>Subscription type</th>
      <th>SubscriptionTopic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="StructureDefinition-DSUBm-Folder-Subscription-UpdateOpt.html">Folder Subscriptions with Folder Subscription for Update option</a></td>
      <td><a href="#23110952-folder-subscription-with-folder-subscription-for-update-option-topic">Folder SubscriptionTopic with Folder Subscription for Update option</a></td>
    </tr>
  </tbody>
</table>

<h6 id="231105216-subscription-with-folder-subscription-for-full-events-option">2:3.110.5.2.1.6 Subscription with Folder Subscription for Full Events option</h6>

<p>When supporting the Folder Subscription for Full Events option, this profile also defines the following types of Subscriptions with related SubscriptionTopic:</p>

<table class="grid">
  <thead>
    <tr>
      <th>Subscription type</th>
      <th>SubscriptionTopic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="StructureDefinition-DSUBm-Folder-Subscription-for-Full-Events.html">Folder Subscriptions with Folder Subscription for Full Events option</a></td>
      <td><a href="#23110953-folder-subscription-with-folder-subscription-for-full-events-option-topic">Folder SubscriptionTopic with Folder Subscription for Full Events option</a></td>
    </tr>
  </tbody>
</table>

<h4 id="2311053-expected-actions">2:3.110.5.3 Expected Actions</h4>

<p>Upon receiving the request message the Resource Notification Broker shall verify the following conditions:</p>

<ul>
  <li>the SubscriptionTopic (referred in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element received in the Subscription resource) is valid;</li>
  <li>all requested filters are defined in the requested topic;</li>
  <li>the channel-type is <code class="language-plaintext highlighter-rouge">rest-hook</code>;</li>
  <li>the channel endpoint is valid for the channel provided (e.g., it is a valid URL of the expected type);</li>
  <li>the payload configuration is known and implemented by the server;</li>
  <li>the payload configuration is valid for the channel type requested (e.g., complies with the Resource Notification Broker security policy);</li>
  <li>the termination time (<code class="language-plaintext highlighter-rouge">Subscription.end</code>), if present, express a valid timestamp in the future.</li>
</ul>

<p>The Resource Notification Broker actor shall support the handshake process to verify that the endpoint that identifies the Resource Notification Recipient, in the <code class="language-plaintext highlighter-rouge">Subscription.channel.endpoint</code> element of the subscription resource, is reachable before activating the subscription.
The Resource Notification Broker shall set initial status to <code class="language-plaintext highlighter-rouge">requested</code>, pending verification of the nominated endpoint URL. In this case the Resource Notification Broker shall send to the Resource Notification Recipient a <a href="ITI-112.html#231125-handshake-notification-request-message">Handshake Notification Message [ITI-112]</a>. After a successful handshake notification has been sent and accepted, the Resource Notification Broker shall update the status to <code class="language-plaintext highlighter-rouge">active</code>. Any errors in the initial handshake shall result in the status being changed to <code class="language-plaintext highlighter-rouge">error</code>. Note that the Resource Notification Subscriber should implement the <a href="ITI-113.html">Subscription Search [ITI-113]</a> transaction in order to verify the activation of the subscription.</p>

<p>The Resource Notification Broker shall enforce all the <a href="#2311012-security-considerations">Security Considerations.</a></p>

<p>The Resource Notification Broker may opt to not duplicate a Subscription on the basis of the information transmitted in the request message (e.g. criteria, endpoint, user authentication, etc.) in order to prevent multiple Subscriptions and Notifications.</p>

<p>Based on the outcome of the conditions above the Resource Notification Broker shall accept or reject the subscription resource received. If all the conditions are true the Resource Notification Broker shall create a Subscription resource and activate the subscription.</p>

<p>When the Subscription Resource uses the <code class="language-plaintext highlighter-rouge">heartbeatPeriod</code>, if accepted, the Resource Notification Broker should send one <a href="ITI-112.html#231127-heartbeat-notification-request-message">Heartbeat Notification Message [ITI-112]</a> per interval on the accepted and active subscription.</p>

<p>Once the Subscription is activated, the Resource Notification Broker shall monitor resources based on the Subscription criteria and, if matches, shall send the appropriate Resource Notification Recipient a <a href="ITI-112.html#231129-event-notification-request-message">Event Notification Message [ITI-112]</a>.</p>

<p>Further considerations needs to be done, for the activation of a Subscription, considering DSUBm as an interface for a DSUB environment.</p>

<h5 id="23110531-expected-actions-with-dsubm-as-an-interface-for-dsub">2:3.110.5.3.1 Expected Actions with DSUBm as an interface for DSUB</h5>

<p>If the Resource Notification Broker is grouped with DSUB Document Metadata Subscriber and DSUB Document Metadata Notification Recipient, considering <a href="volume-1.html#15463-dsubm-as-an-interface-for-dsub">DSUBm as an interface for DSUB</a> model, if the subscription is accepted, the Resource Notification Broker shall trigger a <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-52.html#3.52.4.2">Subscribe Request message</a> towards the DSUB Document Metadata Notification Broker from the DSUB Document Metadata Subscriber with an Document Metadata Subscribe [ITI-52] transaction.</p>

<p>The mapping between the Subscription resource contained in the Resource Subscription [ITI-110] transaction and the Document Metadata Subscribe [ITI-52] transaction shall be as following:</p>

<ul>
  <li>
    <p>If the Subscription resource has a <code class="language-plaintext highlighter-rouge">Subscription.payload = "full-resource"</code> the Document Metadata Subscribe [ITI-52]  transaction shall have a <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-52.html#3.52.5.2.2">“ihe:FullDocumentEntry” Topic Expression</a>. Otherwise a <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-52.html#3.52.5.1.2">“ihe:MinimalDocumentEntry” Topic Expression</a> shall be used.</p>
  </li>
  <li>
    <p>Depending on the type of the Subscription, the AdHocQuery/@id attribute and the the Filters parameter of the Document Metadata Subscribe [ITI-52] transaction shall be set as follows:</p>

    <table class="grid">
      <thead>
        <tr>
          <th>Subscription type</th>
          <th>AdHocQuery/@id</th>
          <th>Filter parameter</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Patient-Dependent DocumentReference Subscriptions</td>
          <td><code class="language-plaintext highlighter-rouge">urn:uuid:aa2332d0-f8fe-11e0-be50-0800200c9a66</code></td>
          <td>Mapping based on <a href="#table-docRef">Table 3:110.9-1</a></td>
        </tr>
        <tr>
          <td>Multi-Patient DocumentReference Subscriptions</td>
          <td><code class="language-plaintext highlighter-rouge">urn:uuid:742790e0-aba6-43d6-9f1fe43ed9790b79</code></td>
          <td>Mapping based on <a href="#table-docRef">Table 3:110.9-1</a></td>
        </tr>
        <tr>
          <td>Patient-Dependent SubmissionSet Subscriptions</td>
          <td><code class="language-plaintext highlighter-rouge">urn:uuid:fbede94e-dbdc-4f6b-bc1f-d730e677cece</code></td>
          <td>Mapping based on <a href="#table-submiss">Table 3:110.9-2</a></td>
        </tr>
        <tr>
          <td>Multi-Patient SubmissionSet Subscriptions</td>
          <td><code class="language-plaintext highlighter-rouge">urn:uuid:868cad3d-ec09-4565-b66c-1be10d034399</code></td>
          <td>Mapping based on <a href="#table-submiss">Table 3:110.9-2</a></td>
        </tr>
        <tr>
          <td>Basic Folder Subscriptions</td>
          <td><code class="language-plaintext highlighter-rouge">urn:uuid:9376254e-da05-41f5-9af3-ac56d63d8ebd</code></td>
          <td>Mapping based on <a href="#table-folder">Table 3:110.9-3</a></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>If the Subscription resource has the <code class="language-plaintext highlighter-rouge">Subscription.end</code> element set, the Document Metadata Subscribe [ITI-52] transaction shall have a <code class="language-plaintext highlighter-rouge">wsnt:InitialTerminationTime</code> element set.</p>
  </li>
</ul>

<p>When the Document Metadata Subscribe [ITI-52] transaction has a successful result, the Resource Notification Broker shall maintain the coupling between the Subscription Resource id and the webservice endpoint present in the <code class="language-plaintext highlighter-rouge">Address</code> element of the Document Metadata Subscribe [ITI-52] response message, in order to be capable of managing a later unsubscription.</p>

<p>If the DSUB Document Metadata Notification Broker sends an assigned duration for the subscription, the Resource Notification Broker shall associate the assigned duration with the accepted subscription request end eventually unsubscribe towards the DSUB Document Metadata Notification Broker when expired.</p>

<h3 id="231106-create-subscription-response-message">2:3.110.6 Create Subscription Response Message</h3>

<p>The Resource Notification Broker sends a Resource Subscription Response Message to respond to a Create Subscription Request Message.</p>

<h4 id="2311061-trigger-events">2:3.110.6.1 Trigger Events</h4>

<p>When the Resource Notification Broker has finished evaluating the subscription received and the operation, the Resource Notification Broker sends this message to the Resource Notification Subscriber acknowledging the result of the creation of the resource.</p>

<h4 id="2311062-message-semantics">2:3.110.6.2 Message Semantics</h4>
<p>When the Resource Notification Broker has processed the request, it shall return an HTTP response with an overall status code.</p>

<p>The Resource Notification Broker shall returns an HTTP status code appropriate to the request and the operation.</p>

<p>If the Subscription has been created, the Resource Notification Broker shall respond with an <code class="language-plaintext highlighter-rouge">HTTP 201 Created</code> status code as indicated for “<a href="https://hl7.org/fhir/R4B/http.html#create">create</a>” and the Resource Notification Broker shall return the entire resource in which the status shall be <code class="language-plaintext highlighter-rouge">requested</code>. If the Resource Notification Broker has assigned a termination time, the element <code class="language-plaintext highlighter-rouge">end</code> shall be valued.</p>

<p>If the interaction failed, common HTTP Status codes returned on FHIR-related errors (in addition to normal HTTP errors related to security, header and content type negotiation issues) are:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">400 Bad Request</code> - resource could not be parsed or failed basic FHIR validation rules (or multiple matches were found for conditional criteria)</li>
  <li><code class="language-plaintext highlighter-rouge">401 Not Authorized</code> - authorization is required for the interaction that was attempted</li>
  <li><code class="language-plaintext highlighter-rouge">404 Not Found</code> - resource type not supported, or not a FHIR end-point</li>
  <li><code class="language-plaintext highlighter-rouge">405 Method Not allowed</code> - the resource did not exist prior to the update, and the server does not allow client defined ids</li>
  <li><code class="language-plaintext highlighter-rouge">422 Unprocessable Entity</code> - the proposed resource violated applicable FHIR profiles or server business rules
Those should be accompanied by an <a href="https://hl7.org/fhir/R4B/operationoutcome.html">OperationOutcome</a> resource providing additional detail.</li>
</ul>

<p>The Resource Notification Broker can return other status codes 4xx or 5xx in accordance to internal business rules that are out of scope for this transaction.</p>

<h4 id="2311063-expected-actions">2:3.110.6.3 Expected Actions</h4>

<p>The Resource Notification Subscriber processes the response according to application-defined rules.</p>

<p>For the Subscription creation:</p>

<ul>
  <li>
    <p>If the Resource Notification Subscriber had not indicated a requested duration for the subscription, the Resource Notification Broker may send an assigned duration for the subscription (if any), using the <code class="language-plaintext highlighter-rouge">Subscription.end</code> element.</p>
  </li>
  <li>
    <p>If the Resource Notification Broker sends an assigned duration for the subscription, the Resource Notification Subscriber shall associate the assigned duration with the accepted subscription request.</p>
  </li>
  <li>
    <p>The Resource Notification Subscriber shall associate the accepted subscription request with the subscription id assigned by the Resource Notification Broker in order to be able to send cancellations for existing subscriptions.</p>
  </li>
</ul>

<h3 id="231107-update-subscription-request-message">2:3.110.7 Update Subscription Request Message</h3>
<p>This message uses the HTTP PUT method on the target Resource Notification Broker endpoint to update an existing Subscription resource in order to:</p>
<ul>
  <li>unsubscribe, or</li>
  <li>re-activate it.</li>
</ul>

<h4 id="2311071-trigger-events">2:3.110.7.1 Trigger Events</h4>

<p>This method is invoked when the Resource Notification Subscriber needs to:</p>
<ul>
  <li>unsubscribe for an already existing subscription</li>
  <li>re-activate an already existing subscription</li>
</ul>

<p>so it sends an update of the Subscription resource to the Resource Notification Broker.</p>

<h4 id="2311072-message-semantics">2:3.110.7.2 Message Semantics</h4>

<p>The Resource Notification Subscriber shall initiate an HTTP request according to requirements defined in the HL7® FHIR® standard for “<a href="https://hl7.org/fhir/R4B/http.html#update">update</a>” interaction. The message uses an HTTP PUT method to update a Subscription FHIR Resource previously created (see section <a href="#231105-create-subscription-request-message">2:3.110.5 Create Subscription Request Message</a>).</p>

<p>The <code class="language-plaintext highlighter-rouge">Subscription.id</code> element shall be valued with the id of the Subscription to be updated.</p>

<p>In order to unsubscribe, the Subscription Resource shall have <code class="language-plaintext highlighter-rouge">status=off</code>.</p>

<p>In order to re-activate an already existing Subscription, the Subscription Resource shall have <code class="language-plaintext highlighter-rouge">status=requested</code>.</p>

<p>The Resource Notification Subscriber actor shall submit the FHIR Subscription resource in either XML format or JSON format thus the media type of the HTTP body shall be either <code class="language-plaintext highlighter-rouge">application/fhir+json</code> or <code class="language-plaintext highlighter-rouge">application/fhir+xml</code> respectively.</p>

<p>The Resource Subscription message is sent to the base URL as defined in FHIR. See <a href="https://hl7.org/fhir/R4B/http.html">http://hl7.org/fhir/R4B/http.html</a> for the definition of “HTTP” access methods and “base”.</p>

<p>It is possible to use HTTP protocol or HTTPS protocol. The HTTPS protocol is highly recommended.</p>

<h4 id="2311073-expected-actions">2:3.110.7.3 Expected Actions</h4>

<p>Upon receiving the request message the Resource Notification Broker shall verify the following conditions:</p>

<ul>
  <li>that the Subscription resource to be updated exists (Prevent Update as Create);</li>
  <li>the Subscription.status sended is <code class="language-plaintext highlighter-rouge">off</code> or the Subscription.status sended is <code class="language-plaintext highlighter-rouge">requested</code> and the actual Subscription.status is <code class="language-plaintext highlighter-rouge">error</code> or <code class="language-plaintext highlighter-rouge">off</code>.</li>
</ul>

<p>The Resource Notification Broker shall enforce all the <a href="#2311012-security-considerations">Security Considerations</a>.</p>

<p>Based on the outcome of the conditions above the Resource Notification Broker shall accept or reject the update of the subscription resource received. If all the conditions are true the Resource Notification Broker shall:</p>
<ul>
  <li>in case of unsubscribe, update the Subscription resource and deactivate the subscription (<code class="language-plaintext highlighter-rouge">status=off</code>). When deactivated, the Resource Notification Broker should sent a <a href="ITI-112.html#2311211-subscription-deactivation-notification-request-message">Subscription Deactivation Notification [ITI-112]</a> to the Resource Notification Recipient. No other notification shall be sent.</li>
  <li>in case of re-activation of an already existing subscription, follow the Expected Actions which are reported in Section <a href="#2311053-expected-actions">2:3.110.5.3 Expected Actions</a>.</li>
</ul>

<p>Further considerations needs to be done in the following paragraph, considering DSUBm as an interface for DSUB environment.</p>

<h5 id="23110731-expected-actions-with-dsubm-as-an-interface-for-dsub-for-unsubscription">2:3.110.7.3.1 Expected Actions with DSUBm as an interface for DSUB for unsubscription</h5>

<p>If the Resource Notification Broker is grouped with DSUB Document Metadata Subscriber and DSUB Document Metadata Notification Recipient, considering <a href="volume-1.html#15463-dsubm-as-an-interface-for-dsub">DSUBm as an interface for DSUB</a> model, if the update of the subscription is accepted, the Resource Notification Broker shall trigger the Document Metadata Subscriber to send an <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-52.html#3.52.4.3">Unsubscribe Request message</a> towards the Document Metadata Notification Broker with an [ITI-52] Document Metadata Subscribe transaction. The message shall be sent to the webservice endpoint previously associated to the Subscription id (see section <a href="#23110531-expected-actions-with-dsubm-as-an-interface-for-dsub">2:3.110.5.3.1 Expected Actions</a> section).</p>

<h5 id="23110732-expected-actions-with-dsubm-as-an-interface-for-dsub-for-re-activation">2:3.110.7.3.2 Expected Actions with DSUBm as an interface for DSUB for re-activation</h5>

<p>If the Resource Notification Broker is grouped with DSUB Document Metadata Subscriber and DSUB Document Metadata Notification Recipient, considering <a href="volume-1.html#15463-dsubm-as-an-interface-for-dsub">DSUBm as an interface for DSUB</a> model, when the update is for re-activate errored Subscription (Subscription.status sended is <code class="language-plaintext highlighter-rouge">requested</code> and the actual Subscription.status is <code class="language-plaintext highlighter-rouge">error</code>) this grouping does not require further Expected Actions.</p>

<p>Instead, for this grouping, when the update is for re-activate turned off Subscription (Subscription.status sended is <code class="language-plaintext highlighter-rouge">requested</code> and the actual Subscription.status is <code class="language-plaintext highlighter-rouge">off</code>) the Resource Notification Broker shall consider the re-activation like a new Subscription that shall be propagated to the DSUB Document Metadata Notification Broker. So, the Resource Notification Broker shall trigger a <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-52.html#3.52.4.2">Subscribe Request message</a> towards the DSUB Document Metadata Notification Broker from the DSUB Document Metadata Subscriber with an Document Metadata Subscribe [ITI-52] transaction, following what is defined in Section <a href="#23110531-expected-actions-with-dsubm-as-an-interface-for-dsub">Expected Actions with DSUBm as an interface for DSUB</a>.</p>

<h3 id="231108-update-subscription-response-message">2:3.110.8 Update Subscription Response Message</h3>

<p>The Resource Notification Broker sends a Resource Subscription Response Message to respond to an Update Subscription Request Message.</p>

<h4 id="2311081-trigger-events">2:3.110.8.1 Trigger Events</h4>

<p>When the Resource Notification Broker has finished evaluating the subscription received and the operation, the Resource Notification Broker sends this message to the Resource Notification Subscriber acknowledging the result the update of the resource.</p>

<h4 id="2311082-message-semantics">2:3.110.8.2 Message Semantics</h4>
<p>When the Resource Notification Broker has processed the request, it shall return an HTTP response with an overall status code.</p>

<p>The Resource Notification Broker shall returns an HTTP status code appropriate to the request and the operation.</p>

<p>If the Subscription has been updated, the Resource Notification Broker shall respond with an <code class="language-plaintext highlighter-rouge">HTTP 200 OK</code> status code as indicated for “<a href="https://hl7.org/fhir/R4B/http.html#update">update</a>” and the Resource Notification Broker shall return the entire resource in which the status shall be <code class="language-plaintext highlighter-rouge">off</code> for subscription deactivation or <code class="language-plaintext highlighter-rouge">requested</code> for subscription re-activation from error.</p>

<p>If the interaction failed, common HTTP Status codes returned on FHIR-related errors (in addition to normal HTTP errors related to security, header and content type negotiation issues) are:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">400 Bad Request</code> - resource could not be parsed or failed basic FHIR validation rules (or multiple matches were found for conditional criteria)</li>
  <li><code class="language-plaintext highlighter-rouge">401 Not Authorized</code> - authorization is required for the interaction that was attempted</li>
  <li><code class="language-plaintext highlighter-rouge">404 Not Found</code> - resource type not supported, or not a FHIR end-point</li>
  <li><code class="language-plaintext highlighter-rouge">405 Method Not allowed</code> - the resource did not exist prior to the update, and the server does not allow client defined ids</li>
  <li><code class="language-plaintext highlighter-rouge">422 Unprocessable Entity</code> - the proposed resource violated applicable FHIR profiles or server business rules
Those should be accompanied by an <a href="https://hl7.org/fhir/R4B/operationoutcome.html">OperationOutcome</a> resource providing additional detail.</li>
</ul>

<p>The Resource Notification Broker can return other status codes 4xx or 5xx in accordance to internal business rules that are out of scope for this transaction.</p>

<h4 id="2311083-expected-actions">2:3.110.8.3 Expected Actions</h4>

<p>The Resource Notification Subscriber processes the response according to application-defined rules.</p>

<h3 id="231109-subscription-topic-and-filter-expressions">2:3.110.9 Subscription Topic and Filter Expressions</h3>

<p>This section clarifies the Subscription Topics and the filter parameters for each type of Subscription that this profile defines.</p>

<p>Further, for each type of subscription, the events for which subscriptions are possible are specified that the Resource Notification Broker shall evaluate. The Resource Notification Broker becomes aware of such events either via a Resource Publish [ITI-111] transaction, or via other mechanisms not specified by this profile.</p>

<p><a name="Patient-Dependent DocumentReference Subscription Topic"> </a></p>

<h4 id="2311091-patient-dependent-documentreference-subscription-topic">2:3.110.9.1 Patient-Dependent DocumentReference Subscription Topic</h4>

<p>For this type of subscription, the stream of events for which subscriptions are possible is limited to events representing the <strong>creation</strong> of DocumentReference Resources related to Documents. Note that these events could be determined by Document Entry Objects creation in XDS environment. Note that these creation events could be happened with other events.</p>

<p>For this type of subscription, the possible subscription filter parameters are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">author.given</code> and <code class="language-plaintext highlighter-rouge">author.family</code></li>
  <li><code class="language-plaintext highlighter-rouge">category</code></li>
  <li><code class="language-plaintext highlighter-rouge">event</code></li>
  <li><code class="language-plaintext highlighter-rouge">facility</code></li>
  <li><code class="language-plaintext highlighter-rouge">format</code></li>
  <li><code class="language-plaintext highlighter-rouge">patient</code></li>
  <li><code class="language-plaintext highlighter-rouge">patient.identifier</code></li>
  <li><code class="language-plaintext highlighter-rouge">security-label</code></li>
  <li><code class="language-plaintext highlighter-rouge">setting</code></li>
  <li><code class="language-plaintext highlighter-rouge">type</code></li>
  <li><code class="language-plaintext highlighter-rouge">status</code></li>
</ul>

<p>For the definition of these parameters see <a href="https://profiles.ihe.net/ITI/MHD/ITI-67.html#23674121-query-search-parameters">ITI-67 Query Search Parameters</a>.</p>

<p>At least one of the patient or patient.identifier parameters shall be used.</p>

<p>With the exception of status and patient or patient.identifier, all parameters may be multi-valued.</p>

<p>The canonical URL of this SubscriptionTopic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-DocumentReference-PatientDependent</code>.</p>

<p>The Resource Notification Broker shall support all the filter parameter that are expressed in the SubscriptionTopic. The Resource Notification Broker shall determine if there is a Subscription which matches any of the DocumentReference resources in an event. The evaluation performed is likely a search operation using the criteria in the Subscription. If it matches, the Resource Notification Broker shall send an <a href="ITI-112.html#231129-event-notification-request-message">Event Notification Message [ITI-112]</a>. If the <code class="language-plaintext highlighter-rouge">Subscription.payload.content</code> includes resources, the DocumentReference resources shall be present.</p>

<p>The canonical instance of this SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-DocumentReference-PatientDependent.html">Patient-Dependent DocumentReference SubscriptionTopic</a>.</p>

<h5 id="23110911-patient-dependent-documentreference-subscription-subscription-with-documentreference-subscription-for-minimal-update-option-topic">2:3.110.9.1.1 Patient-Dependent DocumentReference Subscription Subscription with DocumentReference Subscription for Minimal Update option Topic</h5>

<p>When supporting the <a href="volume-1.html#15421-documentreference-subscription-for-minimal-update-option">DocumentReference Subscription for Minimal Update option</a>, this Subscription Topic extends the <a href="#2311091-patient-dependent-documentreference-subscription-topic">Patient-Dependent DocumentReference SubscriptionTopic</a> in this way:</p>

<ul>
  <li>the stream of events for which subscriptions are possible also <strong>includes</strong> events representing <strong>only the update of the “status” and the deletion</strong> of DocumentReference resources related to Documents. Note that these events could be determined by Document Entry Objects updated or deleted in an XDS environment.</li>
</ul>

<p>The canonical URL of this SubscriptionTopic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-DocReference-PatientDependent-MinUpdate</code>.</p>

<p>The canonical instance of this SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-DocReference-PatientDependent-MinUpdate.html">Patient-Dependent DocumentReference SubscriptionTopic with DocumentReference Subscription for Minimal Update option</a>.</p>

<h5 id="23110912-patient-dependent-documentreference-subscription-subscription-with-documentreference-subscription-for-full-events-option-topic">2:3.110.9.1.2 Patient-Dependent DocumentReference Subscription Subscription with DocumentReference Subscription for Full Events option Topic</h5>

<p>When supporting the <a href="volume-1.html#15422-documentreference-subscription-for-full-events-option">DocumentReference Subscription for Full Events option</a>, this Subscription Topic extends the <a href="#2311091-patient-dependent-documentreference-subscription-topic">Patient-Dependent DocumentReference SubscriptionTopic</a> in this way:</p>

<ul>
  <li>the stream of events for which subscriptions are possible also <strong>includes</strong> events representing <strong>the update and the deletion</strong> of DocumentReference Resources related to Documents. Note that these events could be determined by Document Entry Objects updated or deleted in an XDS environment.</li>
</ul>

<p>The canonical URL of this SubscriptionTopic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-DocReference-PatientDependent-AllEvents</code>.</p>

<p>The canonical instance of this SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-DocReference-PatientDependent-AllEvents.html">Patient-Dependent DocumentReference SubscriptionTopic with Updates to document sharing resources option</a>.</p>

<h4 id="2311092-multi-patient-documentreference-subscriptions-topic">2:3.110.9.2 Multi-Patient DocumentReference Subscriptions Topic</h4>

<p>For this type of subscription, the stream of events for which subscriptions are possible is limited to events representing the <strong>creation</strong> of DocumentReference Resources related to Documents. Note that these events could be determined from Document Entry Objects created in an XDS environment. Note that these creation events could happen with other events.</p>

<p>For this type of subscription, the possible subscription filter parameters are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">author.given</code> and <code class="language-plaintext highlighter-rouge">author.family</code></li>
  <li><code class="language-plaintext highlighter-rouge">category</code></li>
  <li><code class="language-plaintext highlighter-rouge">event</code></li>
  <li><code class="language-plaintext highlighter-rouge">facility</code></li>
  <li><code class="language-plaintext highlighter-rouge">format</code></li>
  <li><code class="language-plaintext highlighter-rouge">security-label</code></li>
  <li><code class="language-plaintext highlighter-rouge">setting</code></li>
  <li><code class="language-plaintext highlighter-rouge">type</code></li>
  <li><code class="language-plaintext highlighter-rouge">status</code></li>
</ul>

<p>For the definition of these parameters see <a href="https://profiles.ihe.net/ITI/MHD/ITI-67.html#23674121-query-search-parameters">ITI-67 Query Search Parameters</a>.</p>

<p>With the exception of status, all parameters may be multi-valued.</p>

<p>The canonical URL of this SubscriptionTopic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-DocumentReference-MultiPatient</code>.</p>

<p>The Resource Notification Broker shall support all the filter parameter that are expressed in the SubscriptionTopic. The Resource Notification Broker shall determine if there is a Subscription which matches any of the DocumentReference resources in an event. The evaluation performed is likely a search operation using the criteria in the Subscription. If it matches, the Resource Notification Broker shall send a <a href="ITI-112.html#231129-event-notification-request-message">Event Notification Message [ITI-112]</a>. If the <code class="language-plaintext highlighter-rouge">Subscription.payload.content</code> includes resources, the DocumentReference resources shall be present.</p>

<p>The canonical instance of this SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-DocumentReference-MultiPatient.html">Multi-Patient DocumentReference SubscriptionTopic</a>.</p>

<h5 id="23110921-multi-patient-documentreference-subscription-subscription-with-documentreference-subscription-for-minimal-update-option-topic">2:3.110.9.2.1 Multi-Patient DocumentReference Subscription Subscription with DocumentReference Subscription for Minimal Update option Topic</h5>

<p>When the <a href="volume-1.html#15421-documentreference-subscription-for-minimal-update-option">DocumentReference Subscription for Minimal Update option</a> is supported, the following Subscription Topic extends the <a href="#2311092-multi-patient-documentreference-subscriptions-topic">Multi-Patient DocumentReference Subscriptions Topic</a> in this way:</p>

<ul>
  <li>the stream of events for which subscriptions are possible also <strong>includes</strong> events representing <strong>only the update of the “status” and the deletion</strong> of DocumentReference Resources related to Documents. Note that these events could be determined by Document Entry Objects updated or deleted in an XDS environment.</li>
</ul>

<p>The canonical URL of this SubscriptionTopic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-DocReference-MultiPatient-MinUpdate</code>.</p>

<p>The canonical instance of this extended SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-DocReference-MultiPatient-MinUpdate.html">Multi-Patient DocumentReference SubscriptionTopic with DocumentReference Subscription for Minimal Update option</a>.</p>

<h5 id="23110922-multi-patient-documentreference-subscription-subscription-with-documentreference-subscription-for-full-events-option-topic">2:3.110.9.2.2 Multi-Patient DocumentReference Subscription Subscription with DocumentReference Subscription for Full Events option Topic</h5>

<p>When the <a href="volume-1.html#15422-documentreference-subscription-for-full-events-option">DocumentReference Subscription for Full Events option</a> is supported, the following Subscription Topic extends the <a href="#2311092-multi-patient-documentreference-subscriptions-topic">Multi-Patient DocumentReference Subscriptions Topic</a> in this way:</p>

<ul>
  <li>the stream of events for which subscriptions are possible also <strong>includes</strong> events representing <strong>the update and the deletion</strong> of DocumentReference Resources related to Documents. Note that these events could be determined by Document Entry Objects updated or deleted in an XDS environment.</li>
</ul>

<p>The canonical URL of this SubscriptionTopic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-DocReference-MultiPatient-AllEvents</code>.</p>

<p>The canonical instance of this extended SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-DocReference-MultiPatient-AllEvents.html">Multi-Patient DocumentReference SubscriptionTopic with DocumentReference Subscription for Full Events option</a>.</p>

<h4 id="2311093-patient-dependent-submissionset-subscription-topic">2:3.110.9.3 Patient-Dependent SubmissionSet Subscription Topic</h4>

<p>For this type of subscription, the stream of events for which subscriptions are possible is limited to events representing the <strong>creation</strong> of SubmissionSet type List Resources related to SubmissionSet. Note that these events could be determined from SubmissionSet Objects created in an XDS environment. Note that these creation events could be happened with other events.</p>

<p>For this type of subscription, the possible subscription filter parameters are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">code</code></li>
  <li><code class="language-plaintext highlighter-rouge">patient</code></li>
  <li><code class="language-plaintext highlighter-rouge">patient.identifier</code></li>
  <li><code class="language-plaintext highlighter-rouge">source.given</code> and <code class="language-plaintext highlighter-rouge">source.family</code></li>
  <li><code class="language-plaintext highlighter-rouge">sourceId</code></li>
  <li><code class="language-plaintext highlighter-rouge">intendedRecipient</code></li>
</ul>

<p>For the definition of these parameters see <a href="https://profiles.ihe.net/ITI/MHD/ITI-66.html#23664121-query-search-parameters">ITI-66 Query Search Parameters</a>.</p>

<p>At least one of the patient or patient.identifier parameters shall be used.</p>

<p>Only the source.given, source.family, sourceId and intendedRecipient parameters may be multi-valued.</p>

<p>The canonical URL of this Subscription Topic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-SubmissionSet-PatientDependent</code>.</p>

<p>The Resource Notification Broker shall support all the filter parameter that are expressed in the SubscriptionTopic. The Resource Notification Broker shall determine if there is a Subscription which matches any of the SubmissionSet type List resources in an event. The evaluation performed is likely a search operation using the criteria in the Subscription. If it matches, the Resource Notification Broker shall send an <a href="ITI-112.html#231129-event-notification-request-message">Event Notification Message [ITI-112]</a>. If the <code class="language-plaintext highlighter-rouge">Subscription.payload.content</code> includes resources, the SubmissionSet type List resources shall be present.</p>

<p>The canonical instance of this SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-SubmissionSet-PatientDependent.html">Patient-Dependent SubmissionSet SubscriptionTopic</a>.</p>

<h4 id="2311094-multi-patient-submissionset-subscription-topic">2:3.110.9.4 Multi-Patient SubmissionSet Subscription Topic</h4>

<p>For this type of subscription, the stream of events for which subscriptions are possible is limited to events representing the <strong>creation</strong> of SubmissionSet type List Resources related to SubmissionSet. Note that these events could be determined from SubmissionSet Objects creation in an XDS environment. Note that these creation events could happen with other events.</p>

<p>For this type of subscription, the possible subscription filter parameters are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">code</code></li>
  <li><code class="language-plaintext highlighter-rouge">source.given</code> and <code class="language-plaintext highlighter-rouge">source.family</code></li>
  <li><code class="language-plaintext highlighter-rouge">sourceId</code></li>
  <li><code class="language-plaintext highlighter-rouge">intendedRecipient</code></li>
</ul>

<p>For the definition of these parameters see <a href="https://profiles.ihe.net/ITI/MHD/ITI-66.html#23664121-query-search-parameters">ITI-66 Query Search Parameters</a>.</p>

<p>All the parameters may be multi-valued.</p>

<p>The canonical URL of this SubscriptionTopic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-SubmissionSet-MultiPatient</code>.</p>

<p>The Resource Notification Broker shall support all the filter parameter that are expressed in the SubscriptionTopic. The Resource Notification Broker shall determine if there is a Subscription which matches any of the SubmissionSet type List resources in an event. The evaluation performed is likely a search operation using the criteria in the Subscription. If it matches, the Resource Notification Broker shall send an <a href="ITI-112.html#231129-event-notification-request-message">Event Notification Message [ITI-112]</a>. If the <code class="language-plaintext highlighter-rouge">Subscription.payload.content</code> includes resources, the SubmissionSet type List resources shall be present.</p>

<p>The canonical instance of this SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-SubmissionSet-MultiPatient.html">Multi-Patient SubmissionSet SubscriptionTopic</a>.</p>

<h4 id="2311095-basic-folder-subscription-topic">2:3.110.9.5 Basic Folder Subscription Topic</h4>
<p>When the <a href="volume-1.html#15423-basic-folder-subscription-option">Basic Folder Subscription option</a> is supported, this type of subscription is admitted. For this type of subscription, the stream of events for which subscriptions are possible is limited to events representing <strong>the creation of Folder type List Resources and the update to insert new documents in Folder</strong>. Note that these events could be determined from Folder Objects created or updated and Association Object creation in an XDS environment. Note that these creation or updating events could happen with other events.</p>

<p>For this type of subscription, the possible subscription filter parameters are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">code</code></li>
  <li><code class="language-plaintext highlighter-rouge">patient</code></li>
  <li><code class="language-plaintext highlighter-rouge">patient.identifier</code></li>
  <li><code class="language-plaintext highlighter-rouge">identifier</code></li>
  <li><code class="language-plaintext highlighter-rouge">designationType</code></li>
  <li><code class="language-plaintext highlighter-rouge">status</code></li>
</ul>

<p>For the definition of these parameters see <a href="https://profiles.ihe.net/ITI/MHD/ITI-66.html#23664121-query-search-parameters">ITI-66 Query Search Parameters</a>.</p>

<p>At least one of the patient or patient.identifier parameters shall be used.</p>

<p>Only the identifier and designationType parameters may be multi-valued.</p>

<p>The canonical URL of this SubscriptionTopic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-Basic-Folder-Subscription</code>.</p>

<p>The Resource Notification Broker shall support all the filter parameter that are expressed in the SubscriptionTopic. The Resource Notification Broker shall determine if there is a Subscription which matches any of the Folder type List resources in an event. The evaluation performed is likely a search operation using the criteria in the Subscription. If it matches, the Resource Notification Broker shall send an <a href="ITI-112.html#231129-event-notification-request-message">Event Notification Message [ITI-112]</a>. If the <code class="language-plaintext highlighter-rouge">Subscription.payload.content</code> includes resources, the Folder type List resources shall be present.</p>

<p>The canonical instance of this SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-Basic-Folder-Subscription.html">Basic Folder SubscriptionTopic</a>.</p>

<h5 id="23110951-folder-subscription-with-folder-subscription-for-minimal-update-option-topic">2:3.110.9.5.1 Folder Subscription with Folder Subscription for Minimal Update option Topic</h5>

<p>When the <a href="volume-1.html#15424-folder-subscription-for-minimal-update-option">Folder Subscription for Minimal Update option</a> is supported, this Subscription Topic extends the <a href="#2311095-basic-folder-subscription-topic">Basic Folder Subscription Topic</a> in this way:</p>

<ul>
  <li>the stream of events for which subscriptions are possible <strong>includes</strong> also events representing the <strong>update to remove documents and update of the “status”</strong> of Folder type List Resources related to Folders. Note that these events could be determined from Folder Objects update or Association Objects update or delete in an XDS environment.</li>
</ul>

<p>The canonical URL of this Subscription Topic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-Folder-Subscription-MinUpdateOpt</code>.</p>

<p>The canonical instance of this SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-Folder-Subscription-MinUpdateOpt.html">Folder SubscriptionTopic with Folder Subscription for Minimal Update option</a>.</p>

<h5 id="23110952-folder-subscription-with-folder-subscription-for-update-option-topic">2:3.110.9.5.2 Folder Subscription with Folder Subscription for Update option Topic</h5>

<p>When the <a href="volume-1.html#15425-folder-subscription-for-update-option">Folder Subscription for Update option</a> is supported, this Subscription Topic extends the <a href="#2311095-basic-folder-subscription-topic">Basic Folder Subscription Topic</a> in this way:</p>

<ul>
  <li>the stream of events for which subscriptions are possible <strong>includes</strong> also events representing <strong>all the updates</strong> of Folder type List Resources related to Folders. Note that these events could be determined from Folder Objects update or Association Objects creation, update or delete in an XDS environment.</li>
</ul>

<p>The canonical URL of this Subscription Topic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-Folder-Subscription-UpdateOpt</code>.</p>

<p>The canonical instance of this SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-Folder-Subscription-UpdateOpt.html">Folder SubscriptionTopic with Folder Subscription for Minimal Update option</a>.</p>

<h5 id="23110953-folder-subscription-with-folder-subscription-for-full-events-option-topic">2:3.110.9.5.3 Folder Subscription with Folder Subscription for Full Events option Topic</h5>

<p>When the <a href="volume-1.html#15426-folder-subscription-for-full-events-option">Folder Subscription for Full Events option</a> is supported, this Subscription Topic extends the <a href="#2311095-basic-folder-subscription-topic">Basic Folder Subscription Topic</a> in this way:</p>

<ul>
  <li>the stream of events for which subscriptions are possible <strong>includes</strong> also events representing <strong>all the updates and the deletion</strong> of Folder type List Resources related to Folders. Note that these events could be determined from Folder Objects update or deletion, or Association Objects creation, update or delete in an XDS environment.</li>
</ul>

<p>The canonical URL of this Subscription Topic that shall be used in the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> element is <code class="language-plaintext highlighter-rouge">https://profiles.ihe.net/ITI/DSUBm/DSUBm-SubscriptionTopic-Folder-Subscription-for-Full-Events</code>.</p>

<p>The canonical instance of this SubscriptionTopic is reported here: <a href="SubscriptionTopic-DSUBm-SubscriptionTopic-Folder-Subscription-for-Full-Events.html">Folder SubscriptionTopic with Folder Subscription for Full Events option option</a>.</p>

<h3 id="2311010-mapping-between-dsubm-criteria-and-dsub-subscription-filters">2:3.110.10 Mapping between DSUBm Criteria and DSUB subscription Filters.</h3>
<p>If the Resource Notification Broker is grouped with Document Metadata Subscriber and Document Metadata Notification Recipient, considering <a href="volume-1.html#15463-dsubm-as-an-interface-for-dsub">DSUBm as an interface for DSUB</a> model, the <code class="language-plaintext highlighter-rouge">Subscription.criteria</code> available parameters in the Subscription resource shall be mapped with the DSUB filter Expression.</p>

<p><a name="table-docRef"> </a></p>

<p><strong>Table 2:3.110.10-1: DSUBm DocumentReference subscription criteria mapping to DSUB DocumentEntry Filters</strong></p>

<table class="grid">
  <thead>
    <tr>
      <th><strong>DSUBm<br />Subscription.criteria</strong></th>
      <th><strong>DSUB <br />DocumentEntry Filters</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>author.given / author.family</td>
      <td>$XDSDocumentEntryAuthorPerson</td>
    </tr>
    <tr>
      <td>category</td>
      <td>$XDSDocumentEntryClassCode</td>
    </tr>
    <tr>
      <td>event</td>
      <td>$XDSDocumentEntryEventCodeList</td>
    </tr>
    <tr>
      <td>facility</td>
      <td>$XDSDocumentEntryHealthcareFacilityTypeCode</td>
    </tr>
    <tr>
      <td>format</td>
      <td>$XDSDocumentEntryFormatCode</td>
    </tr>
    <tr>
      <td>patient or patient.identifier</td>
      <td>$XDSDocumentEntryPatientId</td>
    </tr>
    <tr>
      <td>security-label</td>
      <td>$XDSDocumentEntryConfidentialityCode</td>
    </tr>
    <tr>
      <td>type</td>
      <td>$XDSDocumentEntryTypeCode</td>
    </tr>
    <tr>
      <td>status</td>
      <td>none</td>
    </tr>
  </tbody>
</table>

<p><a name="table-submiss"> </a></p>

<p><strong>Table 2:3.110.10-2: DSUBm SubmissionSet subscription criteria mapping to DSUB DocumentEntry Filters</strong></p>

<table class="grid">
  <thead>
    <tr>
      <th><strong>DSUBm<br />Subscription.criteria</strong></th>
      <th><strong>DSUB <br />SubmissionSet Filters</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>code</td>
      <td>none</td>
    </tr>
    <tr>
      <td>patient or patient.identifier</td>
      <td>$XDSSubmissionSetPatientId</td>
    </tr>
    <tr>
      <td>source.given or source.family</td>
      <td>$XDSSubmissionSetAuthorPerson</td>
    </tr>
    <tr>
      <td>sourceId</td>
      <td>$XDSSubmissionSetSourceId</td>
    </tr>
    <tr>
      <td>intendedRecipient</td>
      <td>$XDSSubmissionSetIntendedRecipient</td>
    </tr>
  </tbody>
</table>

<p><a name="table-folder"> </a></p>

<p><strong>Table 2:3.110.10-3: DSUBm Folder subscription criteria mapping to DSUB DocumentEntry Filters</strong></p>

<table class="grid">
  <thead>
    <tr>
      <th><strong>DSUBm<br />Subscription.criteria</strong></th>
      <th><strong>DSUB <br />Folder Filters</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>code</td>
      <td>none</td>
    </tr>
    <tr>
      <td>patient or patient.identifier</td>
      <td>$XDSFolderPatientId</td>
    </tr>
    <tr>
      <td>identifier</td>
      <td>$XDSFolderUniqueId</td>
    </tr>
    <tr>
      <td>designationType</td>
      <td>$XDSFolderCodeList</td>
    </tr>
    <tr>
      <td>status</td>
      <td>none</td>
    </tr>
  </tbody>
</table>

<h3 id="2311011-capabilitystatement-resource">2:3.110.11 CapabilityStatement Resource</h3>
<p>The Resource Notification Subscriber implementing this transaction shall provide a CapabilityStatement Resource as described in <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.3-capabilitystatement-resource">ITI TF-2x: Appendix Z.3</a> indicating the transaction has been implemented. 
The possible CapabilityStatements for the Resource Notification Subscriber ar listed in Section <a href="volume-1.html#154112-resource-notification-subscriber">1:54.1.1.2 Resource Notification Subscriber</a>.</p>

<p>The Resource Notification Broker implementing this transaction shall provide a CapabilityStatement Resource as described in <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.3-capabilitystatement-resource">ITI TF-2x: Appendix Z.3</a> indicating the transaction has been implemented. 
The possible CapabilityStatements for the Resource Notification Broker ar listed in Section <a href="volume-1.html#154111-resource-notification-broker">1:54.1.1.1 Resource Notification Broker</a>.</p>

<h3 id="2311012-security-considerations">2:3.110.12 Security Considerations</h3>
<p>See <a href="volume-1.html#1545-security-considerations">DSUBm Security Considerations</a>.</p>

<p>The Resource Notification Broker shall control that the Resource Notification Subscriber is acceptable and authorized to create or update a Subscription Resource. It’s highly recommended that the Resource Notification Subscriber should use some form of authentication method when creating or updating a Subscription.
The Resource Notification Broker shall also be aware and enforce any agreed policy in order to control that the Subscription criteria received, that describe the notification event, are permitted to the authenticated Resource Notification Subscriber. For example a veterinary clinical record may be allowed to request a subscription but the Resource Notification Broker shall verify that the Subscription is related only to documents produced for animal subjects and shall reject any subscription made for documents produced for human subjects.</p>

<p>If there is a policy that needs to be enforced in order to control which subscriber can Subscribe or Unsubscribe then, the Resource Notification Broker might maintain a whitelist of acceptable senders for the ITI-110 transactions. 
The Resource Notification Broker may enforce some control on the <code class="language-plaintext highlighter-rouge">channel.endpoint</code> element of the Subscription resource received in order to control where the notification will be sent. The Resource Notification Broker might maintain an allow-list of acceptable endpoints or trusted certificate authorities for rest-hook channels.
The Resource Notification Broker may control the <code class="language-plaintext highlighter-rouge">Subscription.payload</code> element of Subscription resource received in order to mitigate the risk of disclosing sensitive information. For example, if the Subscription criteria includes sensitive documents, the Resource Notification Broker may allow just ‘id-only’ payloads. In this way further authorization mechanisms shall be enforced when the Resource Notification Recipient tries to retrieve the information using the id.</p>

<h4 id="23110121-security-audit-considerations">2:3.110.12.1 Security Audit Considerations</h4>

<p>The Resource Notification Subscriber, when grouped with <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-9.html">ATNA</a> Secure Node or Secure Application Actor, shall be able to record fundamental AuditEvents for:</p>
<ul>
  <li><a href="https://profiles.ihe.net/ITI/BALP/index.html">BALP</a> <a href="https://profiles.ihe.net/ITI/BALP/1.1.2/StructureDefinition-IHE.BasicAudit.Create.html">Create</a> when a subscribe interaction is performed;</li>
  <li><a href="https://profiles.ihe.net/ITI/BALP/index.html">BALP</a> <a href="https://profiles.ihe.net/ITI/BALP/1.1.2/StructureDefinition-IHE.BasicAudit.Update.html">Update</a> when an unsubscribe interaction is performed.</li>
</ul>

<p>The Resource Notification Broker,  when grouped with <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-9.html">ATNA</a> Secure Node or Secure Application Actor, shall be able to record fundamental AuditEvents for:</p>
<ul>
  <li><a href="https://profiles.ihe.net/ITI/BALP/index.html">BALP</a> <a href="https://profiles.ihe.net/ITI/BALP/1.1.2/StructureDefinition-IHE.BasicAudit.Create.html">Create</a> when a subscribe interaction is performed;</li>
  <li><a href="https://profiles.ihe.net/ITI/BALP/index.html">BALP</a><a href="https://profiles.ihe.net/ITI/BALP/1.1.2/StructureDefinition-IHE.BasicAudit.Update.html">Update</a> when an unsubscribe interaction is performed.</li>
</ul>




</div>
        </div>  <!-- /inner-wrapper -->
      </div>  <!-- /row -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-content -->

  <script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

  <script type="text/javascript">
    $(document).ready(function(){
      if(window.location.hash != "") {
          $('a[href="' + window.location.hash + '"]').click()
      }
    });
  </script>
  <a name="bottom"> </a>
  <div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
    <div class="container">  <!-- container -->

      <div style="background-color:var(--footer-nav-bg-color)">
        <table style="width:100%">
          <tbody>
            <tr>
              <td style="text-align:left">&#xA0;

                <a href="volume-1.html">&lt;prev</a>

              </td>
              <td style="text-align:center">
                <a href="#top">top</a>
              </td>
              <td style="text-align:right">&#xA0;

                <a href="ITI-111.html">next&gt;</a>

              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="inner-wrapper">
        <p>
          IG &#169; 2023+ <a style="color:var(--footer-hyperlink-text-color)" href="https://www.ihe.net/ihe_domains/it_infrastructure/">IHE IT Infrastructure Technical Committee</a>.  Package ihe.iti.dsubm#1.0.0-comment based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R5/">FHIR 4.3.0</a>. Generated <span title="Fri, Nov 17, 2023 09:35-0600">2023-11-17</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)">
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                  | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/IHE/ITI.DSUBm/issues/new/choose">New Issue</a> | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/IHE/ITI.DSUBm/issues">Issues</a>
                
                 <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://profiles.ihe.net/ITI/DSUBm/history.html">Version History</a></a> |
                 <a style="color: var(--footer-hyperlink-text-color)" rel="license" href="https://profiles.ihe.net/GeneralIntro/ch-9.html"><img style="border-style: none;" alt="CC0" src="assets/images/cc-by.png" height="17"/></a> |
                <!-- <a style="color: var(--footer-hyperlink-text-color)" href="searchform.html">Search</a> | -->
                 <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://www.ihe.net/resources/public_comment/">Propose a change<img alt="external" style="vertical-align: baseline" src="external.png"/></a>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HLBNC861DJ');
</script>

          </span>
        </p>
      </div>  <!-- /inner-wrapper -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
    <div class="container">  <!-- container -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-post-footer -->
  
  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
  <script type="text/javascript" src="assets/js/respond.min.js"> </script>
  <script type="text/javascript" src="assets/js/anchor.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard-btn.js"> </script>
  <script>anchors.options.visible = 'hover'
anchors.add()</script>
  
<!-- feedback form - Google forms -->
<!-- v0.1, 2021-01-09 -->


  
    
  


  
    
  



<!-- / feedback form  -->

  <!-- Analytics Below
  ================================================== -->
  </body>
</html>

