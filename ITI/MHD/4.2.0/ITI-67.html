<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>IHE.ITI.MHD\2:3.67 Find Document References [ITI-67] - FHIR v4.0.1</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->
<link href="assets/css/ihe.css" rel="stylesheet"/>
<link href="assets/css/nonum.css" rel="stylesheet"/>
<script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-HLBNC861DJ" async> </script> 


    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"10"}
    h3,h4,h5,h6{--heading-prefix:"10"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->
      <div class="container">  <!-- container -->
        <!-- Placeholder for child template header declarations -->

<div id="project-nav">
  <a id="ihe-logo" no-external="true" href="http://profiles.ihe.net">
    <img height="71" alt="Visit the IHE website" src="assets/images/ihe-international.png"/>
  </a>
</div>
<div id="family-nav">
  <a id="family-logo" no-external="true" href="http://hl7.org/fhir"><img height="30" alt="Visit the FHIR website" src="assets/images/fhir-logo.png"/> </a>
</div>
<!--
<div id="hl7-search">
  <a id="hl7-search-lnk" no-external="true" href="searchform.html"><img alt="Search FHIR" src="assets/images/search.png"/></a>
</div>
-->
<div id="project-nav">
  
  
    <a id="project-logo" no-external="true" href="http://profiles.ihe.net/ITI/index.html"><img height="70" alt="Visit the ITI website" src="assets/images/ITI.png"/> </a>
</div>

        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">Mobile access to Health Documents (MHD)</span>
            <br/>
            <span style="display:inline-block;">4.2.0 - Trial-Implementation



  <img alt="International flag" src="assets/images/001.svg" height="16" title="International"/>


            </span>
          </p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->

    <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">  <!-- container -->
        <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
          <!--status-bar-->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a class="navbar-brand hidden" href="http://hl7.org/fhir/R4/index.html">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <!-- menu.xml  -->

<ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
  <li>
    <a href="index.html">MHD Home</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Volume 1
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="index.html">Introduction</a>
      </li>
      <li>
        <a href="1331_actors_and_transactions.html">Actors and Transactions</a>
      </li>
      <li>
        <a href="1332_actor_options.html">Actor Options</a>
      </li>
      <li>
        <a href="1333_required_grouping.html">Actor Required Grouping</a>
      </li>
      <li>
        <a href="1334_overview.html">Overview</a>
      </li>
      <li>
        <a href="1335_security_considerations.html">Security Considerations</a>
      </li>
      <li>
        <a href="1336_cross_profile_considerations.html">Cross Profile Considerations</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Volume 2
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="ITI-65.html">Provide Document Bundle [ITI-65]</a>
      </li>
      <li>
        <a href="ITI-66.html">Find Document Lists [ITI-66]</a>
      </li>
      <li>
        <a href="ITI-67.html">Find Document References [ITI-67]</a>
      </li>
      <li>
        <a href="ITI-68.html">Retrieve Document [ITI-68]</a>
      </li>
      <li>
        <a href="ITI-105.html">Simplified Publish [ITI-105]</a>
      </li>
      <li>
        <a href="ITI-106.html">Generate Metadata [ITI-106]</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Volume 3
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="31_xds.html">Error Codes</a>
      </li>
      <li>
        <a href="32_fhir_maps.html">FHIR Maps</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="testplan.html">Test Plan</a>
  </li>
  <li>
    <a href="artifacts.html">Artifact Index</a>
  </li>
</ul>
            </div>  <!-- /.nav-collapse -->
          </div>  <!-- /.container -->
        </nav>  <!-- /.navbar -->
      <!-- /HEADER CONTENT -->
      </div>  <!-- /container -->
    </div>  <!-- /segment-navbar -->
    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><b>2:3.67 Find Document References [ITI-67]</b></li>

          <span style="float:right;">

            <a href="ITI-66.html">&lt;prev</a> | 

            <a href="#bottom">bottom</a>

          | <a href="ITI-68.html">next&gt;</a>

          </span>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">This page is part of the IHE Mobile Access to Health Documents (v4.2.0: Publication) based on <a href="http://hl7.org/fhir/R4">FHIR R4</a>. This is the current published version in its permanent home (it will always be available at this URL).  For a full list of available versions, see the <a href="https://profiles.ihe.net/ITI/MHD/history.html">Directory of published versions <img src="external.png" style="text-align: baseline"></a></p><!--EndReleaseHeader-->
  <h2>2:3.67 Find Document References [ITI-67]</h2>
  












    <p><!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#23671-scope" id="markdown-toc-23671-scope">2:3.67.1 Scope</a></li>
  <li><a href="#23672-actors-roles" id="markdown-toc-23672-actors-roles">2:3.67.2 Actors Roles</a></li>
  <li><a href="#23673-referenced-standards" id="markdown-toc-23673-referenced-standards">2:3.67.3 Referenced Standards</a></li>
  <li><a href="#23674-messages" id="markdown-toc-23674-messages">2:3.67.4 Messages</a></li>
  <li><a href="#23675-security-considerations" id="markdown-toc-23675-security-considerations">2:3.67.5 Security Considerations</a></li>
</ul>

</div>
<p>This section corresponds to transaction [ITI-67] of the IHE Technical Framework. Transaction [ITI-67] is used by the Document Consumer and Document Responder Actors.</p>

<h3 id="23671-scope">2:3.67.1 Scope</h3>

<p>The Find Document References transaction is used to find DocumentReference Resources that satisfy a set of parameters. It is equivalent to the FindDocuments and FindDocumentsByReferenceId queries from the Registry Stored Query [ITI-18] transaction. The result of the query is a FHIR Bundle containing DocumentReference Resources that match the query parameters.</p>

<h3 id="23672-actors-roles">2:3.67.2 Actors Roles</h3>

<p><strong>Table 2:3.67.2-1: Actor Roles</strong></p>

<table class="grid">
  <thead>
    <tr>
      <th>Actor</th>
      <th>Role</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="1331_actors_and_transactions.html#133112-document-consumer">Document Consumer</a></td>
      <td>Requests a list of DocumentReference Resources, matching the supplied set of criteria, from the Document Responder</td>
    </tr>
    <tr>
      <td><a href="1331_actors_and_transactions.html#133114-document-responder">Document Responder</a></td>
      <td>Returns DocumentReference Resources that match the search criteria provided by the Document Consumer</td>
    </tr>
  </tbody>
</table>

<h3 id="23673-referenced-standards">2:3.67.3 Referenced Standards</h3>

<p><strong>FHIR-R4</strong> <a href="http://www.hl7.org/FHIR/R4">HL7 FHIR Release 4.0</a></p>

<h3 id="23674-messages">2:3.67.4 Messages</h3>

<div>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="149px" preserveAspectRatio="none" style="width:417px;height:149px;background:#FFFFFF;" version="1.1" viewBox="0 0 417 149" width="417px" zoomAndPan="magnify"><defs><filter height="300%" id="f1wg9owrgfjlwv" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0" /><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0" /><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3" /><feBlend in="SourceGraphic" in2="blurOut3" mode="normal" /></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="279" x="66.75" y="30.6855">Find Document References [ITI-67]</text><rect fill="#FFFFFF" filter="url(#f1wg9owrgfjlwv)" height="36.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="75.5" y="88.25" /><rect fill="#FFFFFF" filter="url(#f1wg9owrgfjlwv)" height="36.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="324.5" y="88.25" /><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="80" x2="80" y1="78.25" y2="142.6016" /><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="329.5" x2="329.5" y1="78.25" y2="142.6016" /><rect fill="#FEFECE" filter="url(#f1wg9owrgfjlwv)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="147" x="5" y="41.6406" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133" x="12" y="63.1738">Document Consumer</text><rect fill="#FEFECE" filter="url(#f1wg9owrgfjlwv)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="152" x="251.5" y="41.6406" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="258.5" y="63.1738">Document Responder</text><rect fill="#FFFFFF" filter="url(#f1wg9owrgfjlwv)" height="36.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="75.5" y="88.25" /><rect fill="#FFFFFF" filter="url(#f1wg9owrgfjlwv)" height="36.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="324.5" y="88.25" /><polygon fill="#A80036" points="312.5,106.6016,322.5,110.6016,312.5,114.6016,316.5,110.6016" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.0;" x1="85.5" x2="318.5" y1="110.6016" y2="110.6016" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="92.5" y="105.7451">1. Find Document References [ITI-67]</text><polygon fill="#A80036" points="91.5,120.6016,81.5,124.6016,91.5,128.6016,87.5,124.6016" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="85.5" x2="328.5" y1="124.6016" y2="124.6016" /></g></svg>
</div>

<p><br clear="all" /></p>

<p><strong>Figure 2:3.67.4-1: Find Document References Interactions</strong></p>

<h4 id="236741-find-document-references-request-message">2:3.67.4.1 Find Document References Request Message</h4>

<p>This message uses the search method parameterized query to obtain DocumentReference Resources from the Document Responder.</p>

<h5 id="2367411-trigger-events">2:3.67.4.1.1 Trigger Events</h5>

<p>When the Document Consumer needs to discover DocumentReference Resources matching various metadata parameters, it issues a Find Document References message.</p>

<h5 id="2367412-message-semantics">2:3.67.4.1.2 Message Semantics</h5>

<p>The Document Consumer executes an HTTP search against the Document Responders DocumentReference URL. The search target follows the FHIR HTTP specification, addressing the DocumentReference Resource <a href="http://hl7.org/fhir/R4/http.html">http://hl7.org/fhir/R4/http.html</a>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[base]/DocumentReference?&lt;query&gt;
</code></pre></div></div>
<p>This URL is configurable by the Document Responder and is subject to the following constraints:</p>

<p>The <code class="language-plaintext highlighter-rouge">&lt;query&gt;</code> represents a series of encoded name-value pairs representing the filter for the query, as specified in Section <a href="#23674121-query-search-parameters">Query Search Parameters</a>, as well as control parameters to modify the behavior of the Document Responder such as response format, or pagination.</p>

<p>The Document Consumer may use GET or POST based searches. The Document Responder shall support both GET and POST based searches <a href="http://hl7.org/fhir/R4/http.html#search">http://hl7.org/fhir/R4/http.html#search</a>.</p>

<h6 id="23674121-query-search-parameters">2:3.67.4.1.2.1 Query Search Parameters</h6>

<p>The Document Consumer may supply, and the Document Responder shall be capable of processing, all query parameters listed below. All query parameter values shall be appropriately encoded per RFC3986 “percent” encoding rules. Note that percent encoding does restrict the character set to a subset of ASCII characters which is used for encoding all other characters used in the URL.</p>

<p>The Document Consumer shall include search parameter <code class="language-plaintext highlighter-rouge">patient</code> or <code class="language-plaintext highlighter-rouge">patient.identifier</code>, and <code class="language-plaintext highlighter-rouge">status</code>. The other parameters described below are optional. The Document Responder must implement the parameters described below. The Document Responder may choose to support additional query parameters beyond the subset listed below. Any additional query parameters supported shall be supported according to the core FHIR specification. Such additional parameters are considered out of scope for this transaction. Any additional parameters not supported should be ignored. See <a href="http://hl7.org/fhir/R4/search.html#errors">http://hl7.org/fhir/R4/search.html#errors</a>.</p>

<p><strong>author.given</strong> and <strong>author.family</strong>:
These parameters, of type string, specify the name parts of the author person, which is associated with the DocumentReference Resource, or in Document Sharing nomenclature, the author of the Document Entry. See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.2-query-parameters">ITI TF-2x: Appendix Z.2</a> for use of the string data type.  This use of <strong>author.given</strong> and <strong>author.family</strong> follows the <a href="http://hl7.org/fhir/search.html#chaining">FHIR Chaining Parameters</a> search methodology.</p>

<p><strong>category</strong>:
This parameter, of type token, specifies the general classification of the DocumentReference Resource, or in Document Sharing nomenclature, the classCode of the Document Entry. See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.2-query-parameters">ITI TF-2x: Appendix Z.2</a> for additional constraints on the use of the token search parameter type.</p>

<p><strong>creation</strong>:
This IHE defined parameter defined as <a href="SearchParameter-DocumentReference-Creation.html">DocumentReference-Creation</a>, of type dateTime, specifies a search against the DocumentReference.content.attachment.creation. See FHIR <a href="http://hl7.org/fhir/R4/search.html#date">http://hl7.org/fhir/R4/search.html#date</a> for use of the date search type.</p>

<p><strong>date</strong>:
This parameter, of type date, specifies the time when the DocumentReference was created. See FHIR <a href="http://hl7.org/fhir/R4/search.html#date">http://hl7.org/fhir/R4/search.html#date</a> for use of the date search type.</p>

<p><strong>event</strong>:
This parameter, of type token, specifies the main clinical acts documented by the DocumentReference Resource, or in Document Sharing nomenclature, the eventCodeList of the Document Entry. See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.2-query-parameters">ITI TF-2x: Appendix Z.2</a> for additional constraints on the use of the token search parameter type.</p>

<p><strong>facility</strong>:
This parameter, of type token, specifies the kind of facility found in DocumentReference.context.facilityType, or in Document Sharing nomenclature, the healthcareFacilityTypeCode of the Document Entry. See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.2-query-parameters">ITI TF-2x: Appendix Z.2</a> for additional constraints on the use of the token search parameter type.</p>

<p><strong>format</strong>:
This parameter, of type token, specifies the format of the DocumentReference Resource, or in Document Sharing nomenclature, the formatCode of the Document Entry. See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.2-query-parameters">ITI TF-2x: Appendix Z.2</a> for additional constraints on the use of the token search parameter type.</p>

<p><strong>identifier</strong>:
This parameter, of type token, specifies an identifier for this DocumentReference and/or the contained document. The search results represent the results of a search on DocumentReference.masterIdentifier and DocumentReference.identifier. See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.2-query-parameters">ITI TF-2x: Appendix Z.2</a> for additional constraints on the use of the token search parameter type.</p>

<p><strong>patient</strong>:
This parameter is of type Reference(Patient). The Document Consumer may get this reference using the <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-38.html">PDQm</a> or <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-41.html">PIXm</a> Profile. When the patient parameter is used, the Patient reference would need to be accessible to both the Document Consumer and the Document Responder.</p>

<p><strong>patient.identifier</strong>:
This parameter, of type token, specifies an identifier associated with the patient to which the DocumentReference Resource is assigned.  See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.2-query-parameters">ITI TF-2x: Appendix Z.2</a> for additional constraints on the use of the token search parameter type. This use of <strong>patient.identifier</strong> follows the <a href="http://hl7.org/fhir/search.html#chaining">FHIR Chaining Parameters</a> search methodology.</p>

<p><strong>period</strong>:
This parameter, of type date, represents the time of service that is being documented by the DocumentReference. The period search parameter specifies an interval which the time of service overlaps. In Document Sharing nomenclature, this query parameter represents from/to parameters for the serviceStartTime and serviceStopTime of the Document Entry. See FHIR <a href="http://hl7.org/fhir/R4/search.html#date">http://hl7.org/fhir/R4/search.html#date</a> for use of the date search type.</p>

<p><strong>related</strong>:
This parameter, of type reference, represents other identifiers associated with the DocumentReference Resource, or in Document Sharing nomenclature, the referenceIdList of the Document Entry.</p>

<p><strong>security-label</strong>:
This parameter, of type token, specifies the security labels of the document referenced by DocumentReference Resource, or in Document Sharing nomenclature, the confidentialityCode of the Document Entry. See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.2-query-parameters">ITI TF-2x: Appendix Z.2</a> for additional constraints on the use of the token search parameter type.</p>

<p><strong>setting</strong>:
This parameter, of type token, specifies the specific practice setting of the DocumentReference Resource, or in Document Sharing nomenclature, the practiceSettingCode of the Document Entry. See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.2-query-parameters">ITI TF-2x: Appendix Z.2</a> for additional constraints on the use of the token search parameter type.</p>

<p><strong>status</strong>:
This parameter, of type token, specifies the status of the DocumentReference Resource, or in Document Sharing nomenclature, the availabilityStatus of the Document Entry. The Document Consumer shall populate the identifier portion of the token using one of the short codes in Table 2:3.67.4.1.2.1-1. The system portion of the token shall not be populated.</p>

<p><strong>type</strong>:
This parameter, of type token, specifies the specific type of the DocumentReference resource or in Document Sharing nomenclature, the typeCode of the Document Entry. See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.2-query-parameters">ITI TF-2x: Appendix Z.2</a> for additional constraints on the use of the token search parameter type.</p>

<h6 id="23674122-populating-expected-response-format">2:3.67.4.1.2.2 Populating Expected Response Format</h6>

<p>The FHIR standard provides encodings for responses as either XML or JSON. The Document Responder shall support both message encodings, whilst the Document Consumer shall support one and may support both.</p>

<p>See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.6-populating-the-expected-response-format">ITI TF-2x: Appendix Z.6</a> for details.</p>

<h6 id="23674123-example-documentreference-search">2:3.67.4.1.2.3 Example DocumentReference Search</h6>

<p>For example given:</p>
<ul>
  <li>FHIR server root is <code class="language-plaintext highlighter-rouge">http://test.fhir.org/R4/fhir</code></li>
  <li>Patient reference id is <code class="language-plaintext highlighter-rouge">9876</code></li>
  <li>status of current</li>
  <li>with clinical code from loinc of <code class="language-plaintext highlighter-rouge">1234-5</code></li>
  <li>examples do not include all http headers such as the security headers</li>
</ul>

<h6 id="236741231-example-get">2:3.67.4.1.2.3.1 Example GET</h6>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET test.fhir.net/R4/fhir/DocumentReference?patient=9876&amp;status=current&amp;type=http://loinc.org|1234-5
</code></pre></div></div>

<h6 id="236741232-example-post">2:3.67.4.1.2.3.2 Example POST</h6>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST test.fhir.net/R4/fhir/DocumentReference/_search?patient=9876&amp;status=current&amp;type=http://loinc.org|1234-5
</code></pre></div></div>

<h6 id="236741233-example-post-body">2:3.67.4.1.2.3.3 Example POST Body</h6>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST test.fhir.net/R4/fhir/DocumentReference/_search	  
Host test.fhir.net
Content-Type: application/x-www-form-urlencoded
Accept: application/fhir+json; fhirVersion=4.0										  

patient=9876&amp;status=current&amp;type=http://loinc.org|1234-5
</code></pre></div></div>

<h5 id="2367413-expected-actions">2:3.67.4.1.3 Expected Actions</h5>

<p>The Document Responder shall process the query to discover the DocumentReference entries that match the search parameters given.</p>

<h6 id="23674131-xds-on-fhir-option">2:3.67.4.1.3.1 XDS on FHIR Option</h6>

<p>The Document Responder is grouped with an XDS Document Consumer when it supports the <a href="1332_actor_options.html#13322-xds-on-fhir-option">XDS on FHIR</a> Option. The Document Responder shall map the query parameters as listed in Table 2:3.67.4.1.3.1-1 and shall execute a Registry Stored Query [ITI-18] for FindDocuments or FindDocumentsByReferenceIdList (see <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-18.html#3.18.4.1.2.3.7.1">ITI TF-2a: 3.18.4.1.2.3.7.1</a> and <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-18.html#3.18.4.1.2.3.7.14">3.18.4.1.2.3.7.14</a> ). All of the query parameters in Table 3.67.4.1.3-1 shall be supported by the Document Responder. No additional query parameters as defined in FHIR are required of the Document Responder, but they may be offered.</p>

<p><strong>Table 2:3.67.4.1.3.1-1: ITI-18 FindDocuments Query Parameter Mapping</strong></p>

<table class="grid">
  <thead>
    <tr>
      <th>[ITI-67] Parameter Name</th>
      <th>[ITI-18] Parameter Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>patient or patient.identifier</td>
      <td>$XDSDocumentEntryPatientId</td>
    </tr>
    <tr>
      <td>creation (Note 1) (Note 5)</td>
      <td>$XDSDocumentEntryCreationTimeFrom</td>
    </tr>
    <tr>
      <td>creation (Note 2) (Note 5)</td>
      <td>$XDSDocumentEntryCreationTimeTo</td>
    </tr>
    <tr>
      <td>author.given / author.family</td>
      <td>$XDSDocumentEntryAuthorPerson</td>
    </tr>
    <tr>
      <td>status</td>
      <td>$XDSDocumentEntryStatus</td>
    </tr>
    <tr>
      <td>(Not supported) (Note 3)</td>
      <td>$XDSDocumentEntryType</td>
    </tr>
    <tr>
      <td>category</td>
      <td>$XDSDocumentEntryClassCode</td>
    </tr>
    <tr>
      <td>type</td>
      <td>$XDSDocumentEntryTypeCode</td>
    </tr>
    <tr>
      <td>setting</td>
      <td>$XDSDocumentEntryPracticeSettingCode</td>
    </tr>
    <tr>
      <td>period (Note 1)</td>
      <td>$XDSDocumentEntryServiceStartTimeFrom</td>
    </tr>
    <tr>
      <td>period (Note 2)</td>
      <td>$XDSDocumentEntryServiceStartTimeTo</td>
    </tr>
    <tr>
      <td>period (Note 1)</td>
      <td>$XDSDocumentEntryServiceStopTimeFrom</td>
    </tr>
    <tr>
      <td>period (Note 2)</td>
      <td>$XDSDocumentEntryServiceStopTimeTo</td>
    </tr>
    <tr>
      <td>facility</td>
      <td>$XDSDocumentEntryHealthcareFacilityTypeCode</td>
    </tr>
    <tr>
      <td>event</td>
      <td>$XDSDocumentEntryEventCodeList</td>
    </tr>
    <tr>
      <td>security-label</td>
      <td>$XDSDocumentEntryConfidentialityCode</td>
    </tr>
    <tr>
      <td>format</td>
      <td>$XDSDocumentEntryFormatCode</td>
    </tr>
    <tr>
      <td>related (Note 4)</td>
      <td>$XDSDocumentEntryReferenceIdList</td>
    </tr>
  </tbody>
</table>

<p>Note 1: This FindDocuments parameter is used when the greater than parameter modifier is used on the given parameter.</p>

<p>Note 2: This FindDocuments parameter is used when the less than parameter modifier is used on the given parameter.</p>

<p>Note 3: The $XDSDocumentEntryType is not a supported query parameter in HL7 FHIR.</p>

<p>Note 4: The $XDSDocumentEntryReferenceIdList can only be mapped when using the XDS FindDocumentsByReferenceId query. This parameter support requires XDS <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-10.html#10.2.6">Reference ID Option</a>.</p>

<p>Note 5: The FHIR R4 DocumentReference does not yet have a <code class="language-plaintext highlighter-rouge">.attachment.creation</code> query parameter, it has only a date element which is the creation date/time of the DocumentReference. MHD adds the search parameter <code class="language-plaintext highlighter-rouge">DocumentReference-Creation</code>, to provide the functionality of search against the document creation date/time.</p>

<p><strong>Table 2:3.67.4.1.3.1-2: Values for code for status of DocumentReference</strong></p>

<p>The following table is also available in a <a href="ConceptMap-FhirStatusVsStatusCode.html">concept map</a> artifact.</p>

<table class="grid">
  <thead>
    <tr>
      <th>FHIR Code</th>
      <th>ebRIM Code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>current</td>
      <td>urn:oasis:names:tc:ebxml-regrep:StatusType:Approved</td>
    </tr>
    <tr>
      <td>superseded</td>
      <td>urn:oasis:names:tc:ebxml-regrep:StatusType:Deprecated</td>
    </tr>
  </tbody>
</table>

<h4 id="236742-find-document-references-response-message">2:3.67.4.2 Find Document References Response Message</h4>

<p>The Document Responder returns a HTTP Status code appropriate to the processing as well as a Bundle of the matching DocumentReference Resources.</p>

<h5 id="2367421-trigger-events">2:3.67.4.2.1 Trigger Events</h5>

<p>The Document Responder completed processing of the Find Document Reference Request message.</p>

<h5 id="2367422-message-semantics">2:3.67.4.2.2 Message Semantics</h5>

<p>Based on the query results, the Document Responder will either return an error or success. Guidance on handling Access Denied related to use of 200, 403 and 404 can be found in <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.8-mobile-security-considerations">ITI TF-2x: Appendix Z.7</a>.</p>

<p>When the Document Responder needs to report an error, it shall use HTTP error response codes and should include a FHIR OperationOutcome with more details on the failure. See FHIR <a href="http://hl7.org/fhir/R4/http.html">http://hl7.org/fhir/R4/http.html</a> and <a href="http://hl7.org/fhir/R4/operationoutcome.html">http://hl7.org/fhir/R4/operationoutcome.html</a>.</p>

<p>If the Find Document References message is processed successfully, whether or not any DocumentReference Resources are found, the HTTP status code shall be 200. The Find Document References Response message shall be a Bundle Resource containing zero or more DocumentReference Resources. If the Document Responder is sending warnings, the Bundle Resource shall also contain an OperationOutcome Resource that contains those warnings.</p>

<p>The response shall adhere to the FHIR Bundle constraints specified in <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.1-resource-bundles">ITI TF-2x: Appendix Z.1</a>. The response bundle for a MHD Find Document References Comprehensive Response <a href="StructureDefinition-IHE.MHD.FindDocumentReferencesComprehensiveResponseMessage.html">is defined here</a>, with an <a href="StructureDefinition-IHE.MHD.FindDocumentReferencesComprehensiveResponseMessage-examples.html">example</a>.</p>

<h6 id="23674221-documentreference-resource-contents">2:3.67.4.2.2.1 DocumentReference Resource Contents</h6>

<p>The DocumentReference Resources returned shall be compliant with the FHIR specification <a href="http://hl7.org/fhir/R4/documentreference.html">http://hl7.org/fhir/R4/documentreference.html</a>.</p>

<p>The DocumentReference Resources returned should be compliant with the <a href="32_fhir_maps.html">MHD metadata</a> for the IHE restrictions on DocumentReference Resource and with the <a href="32_fhir_maps.html#documentEntry">mapping to DocumentEntry</a> from IHE Document Sharing profiles (e.g., XDS) to FHIR.</p>

<h6 id="236742211-document-location">2:3.67.4.2.2.1.1 Document Location</h6>

<p>The Document Responder shall place into the DocumentReference.content.attachment.url element a full URL that can be used by the Document Consumer to retrieve the document using the Retrieve Document <a href="ITI-68.html">[ITI-68]</a> transaction. IHE does not specify the format of the URL. There are many ways to encode this URL that allow for easy processing on a <a href="ITI-68.html">Retrieve Document</a> transaction. Some examples are to encode homeCommunityId, repositoryUniqueId, uniqueId, and patientId into the URL. This could be done in many ways including using character separators or directory separators. In this way, the Document Responder can support many communities, and/or many repositories.</p>

<h6 id="236742212-support-for-on-demand-documents">2:3.67.4.2.2.1.2 Support for On-Demand Documents</h6>

<p><a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-10.html">XDS</a> introduced the concept of a <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-10.html#10.2.7">On-Demand Document Option</a>, and is explained in the <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-10.html#10.4.11.3">Use Cases Summary</a>. The use of On-Demand Documents allows for documents that would be produced for a specific patient with content assembled at the time of processing the document consumer retrieve request.</p>

<p>On-Demand Documents are indicated in the DocumentReference by the DocumentReference.content.attachment with an absent .hash and .size element. For more background on <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-10.html#10.2.7">On-Demand Documents</a>. There is no need to declare an On-Demand Documents Option in MHD.</p>

<p>Informative note: When the Document Consumer retrieves the document using the Document location, then the retrieved document might exist as an [IsSnapshotOf Association according to XDS <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-43.html#3.43.4.2.3">\ITI-43]</a>. The IsSnapshotOf Association is identified as a new DocumentReference with relatesTo.code of <code class="language-plaintext highlighter-rouge">transforms</code>.</p>

<h6 id="236742213-support-for-delayed-document-assembly">2:3.67.4.2.2.1.3 Support for Delayed Document Assembly</h6>

<p><a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-10.html">XDS</a> introduced the concept of <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-10.html#10.2.10">Delayed Document Assembly Option</a>, and is explained in the <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-10.html#10.4.11.3">Use Cases Summary</a>. The use of Delayed Document Assembly allows source systems to register the existence of stable document content but defer actually assembling the document content only if and when it is retrieved.</p>

<p>Delayed Document Assembly is distinct from On-Demand Documents in that Delayed Document Assembly is a Documents that are static, clinician attested documents and the content of the document is identified prior to registration of the Document Entry. On-Demand Documents allows the content of the document to be identified at the time of receipt of the retrieval request (e.g., summary, or current). Delayed Document Assembly has been designed to be as transparent as possible to Document Consumer Actors. Document Consumers Actors may easily support Stable Documents whose assembly has been delayed just as if they were a regular Stable Document since the only constraint on Document Consumers brought by this Delayed Document Assembly Option is to support responses to queries with the presence of Stable Document Entries that have zero size and hash values.</p>

<p>Delayed Document Assembly are indicated in the DocumentReference by the DocumentReference.content.attachment with an .size element of <code class="language-plaintext highlighter-rouge">0</code> (zero), and a .hash element with the fixed value <code class="language-plaintext highlighter-rouge">da39a3ee5e6b4b0d3255bfef95601890afd80709</code> (SHA1 hash of a zero length file). For more background on the <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-10.html#10.2.10">Delayed Document Assembly</a>. There is no need to declare a Delayed Document Assembly in MHD.</p>

<p>Informative note: When the Document Consumer retrieves the document using the Document location, then the retrieved document actual size and hash is updated in the DocumentReference. In this way the Document Consumer may retrieve the updated DocumentReference after successful retrieval of the document to find the size and hash for content integrity validation.</p>

<h6 id="236742214-xds-associations">2:3.67.4.2.2.1.4 XDS Associations</h6>

<p>Where the DocumentReference Resource being returned has an XDS Association, this shall be represented in the DocumentReference.relatesTo element. Where the DocumentReference.relatesTo.target element holds the Reference to the other DocumentReference Resource, and the DocumentReference.relatesTo.code element holds the relationship type translated using the <a href="ConceptMap-AssociationTypeVsRelatesTo.html">AssociationType vs RelatesTo ConceptMap</a>.</p>

<h6 id="236742215-xds-identifiers-to-resource-references">2:3.67.4.2.2.1.5 XDS Identifiers to Resource References</h6>

<p>Where the DocumentReference Resource being returned is being translated from an XDS DocumentEntry, there will be identifiers in the DocumentEntry (e.g., ReferenceIdList) that may be represented in the DocumentReference as Resource References. The Document Responder is not required to convert identifiers into Resource References, but it is allowed to do this conversion. For example an identifier in ReferenceIdList may simply be copied into DocumentReference.content.related.identifier. Alternatively the ReferenceIdList may be resolved to a Resource Reference and that reference be placed into DocumentReference.content.related.reference.</p>

<p>Identifiers in XDS are encoded using the <a href="https://profiles.ihe.net/ITI/TF/Volume3/ch-4.2.html#4.2.3.1.7">Document Sharing CXi Metadata datatype</a>, which will indicate the kind of identifier. This kind of identifier shall be used when mapping values into DocumentReference elements (See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.9.1.2-xds-cxi-mapped-to-fhir-identifier-type">Appendix Z.9.1.2</a> ). Specifically the <code class="language-plaintext highlighter-rouge">CXi</code> Identifier Type Code of <code class="language-plaintext highlighter-rouge">urn:ihe:iti:xds:2015:encounterId</code> would indicate the Identifier value be mapped into DocumentReference.encounter.</p>

<h6 id="23674222-resource-bundling">2:3.67.4.2.2.2 Resource Bundling</h6>

<p>Resource Bundling shall comply with the guidelines in <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.1-resource-bundles">ITI TF-2x: Appendix Z.1</a>.</p>

<h4 id="236743-expected-actions">2:3.67.4.3 Expected Actions</h4>

<p>The Document Consumer shall process the results according to application-defined rules. The Document Consumer should be robust as the response may contain DocumentReference Resources that match the query parameters but are not compliant with the DocumentReference constraints defined here.</p>

<h4 id="236744-capabilitystatement-resource">2:3.67.4.4 CapabilityStatement Resource</h4>

<p>Document Responders implementing this transaction shall provide a CapabilityStatement Resource as described in <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.3-capabilitystatement-resource">ITI TF-2x: Appendix Z.3</a> indicating the transaction has been implemented.</p>
<ul>
  <li>Requirements CapabilityStatement for <a href="CapabilityStatement-IHE.MHD.DocumentConsumer.html">Document Consumer</a></li>
  <li>Requirements CapabilityStatement for <a href="CapabilityStatement-IHE.MHD.DocumentResponder.html">Document Responder</a></li>
</ul>

<h3 id="23675-security-considerations">2:3.67.5 Security Considerations</h3>

<p>See <a href="1335_security_considerations.html">MHD Security Considerations</a>.</p>

<p>This transaction should not return information that the Document Consumer is not authorized to access. Where authorization here is inclusive of system, app, and user according to local policy, patient consents, and security layering. However, the transaction may return DocumentReference resources that have Reference elements that the Document Consumer may not have access to. This is to say that the authorization need only be to the content returned in the Bundle. There may be references (URLs) for which the content is not authorized. This is considered proper as the Document Consumer would need to retrieve the content pointed to by those references, and at that time the proper authorization decision would be made on that context and content. In this way it is possible for a Document Consumer to get DocumentManifest resources that are pointing at data that the Document Consumer is not authorized to retrieve. Thus, the URLs used must be carefully crafted so as to not expose sensitive data in the URL value.</p>

<p>Given that the Document Responder is responsible for the URL placed into DocumentReference.content.attachment.url, care must be taken to assure that manipulation of this URL prior to a Retrieve Document transaction does not expose resources the Document Consumer should not have access to.</p>

<h4 id="236751-security-audit-considerations">2:3.67.5.1 Security Audit Considerations</h4>

<p>The security audit criteria are similar to those for the Registry Stored Query <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-18.html#3.18.5">[ITI-18]</a> transaction.</p>

<h5 id="2367511-document-consumer-audit">2:3.67.5.1.1 Document Consumer Audit</h5>

<p>The Document Consumer when grouped with ATNA Secure Node or Secure Application Actor shall be able to record a <a href="StructureDefinition-IHE.MHD.FindDocumentReferences.Audit.Consumer.html">Find Document References Consumer Audit Event Log</a>. <a href="AuditEvent-ex-auditFindDocumentReferences-consumer.html">Audit Example for a Find Document References transaction from consumer perspective</a>.</p>

<h5 id="2367512-document-responder-audit">2:3.67.5.1.2 Document Responder Audit</h5>

<p>The Document Responder when grouped with ATNA Secure Node or Secure Application Actor shall be able to record a <a href="StructureDefinition-IHE.MHD.FindDocumentReferences.Audit.Responder.html">Find Document References Responder Audit Event Log</a>. <a href="AuditEvent-ex-auditFindDocumentReferences-responder.html">Audit Example for a Find Document Lists Transaction from responder perspective</a>.</p>




</div>
        </div>  <!-- /inner-wrapper -->
      </div>  <!-- /row -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-content -->

  <script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

  <script type="text/javascript">
    $(document).ready(function(){
      if(window.location.hash != "") {
          $('a[href="' + window.location.hash + '"]').click()
      }
    });
  </script>
  <a name="bottom"> </a>
  <div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
    <div class="container">  <!-- container -->

      <div style="background-color:var(--footer-nav-bg-color)">
        <table style="width:100%">
          <tbody>
            <tr>
              <td style="text-align:left">&#xA0;

                <a href="ITI-66.html">&lt;prev</a>

              </td>
              <td style="text-align:center">
                <a href="#top">top</a>
              </td>
              <td style="text-align:right">&#xA0;

                <a href="ITI-68.html">next&gt;</a>

              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="inner-wrapper">
        <p>
          IG &#169; 2020+ <a style="color:var(--footer-hyperlink-text-color)" href="https://www.ihe.net/ihe_domains/it_infrastructure/">IHE IT Infrastructure Technical Committee</a>.  Package ihe.iti.mhd#4.2.0 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Wed, Dec 7, 2022 16:34-0600">2022-12-07</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)">
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                  | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/IHE/ITI.MHD/issues/new/choose">New Issue</a> | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/IHE/ITI.MHD/issues">Issues</a>
                
                 <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://profiles.ihe.net/ITI/MHD/history.html">Version History</a></a> |
                 <a style="color: var(--footer-hyperlink-text-color)" rel="license" href="https://profiles.ihe.net/GeneralIntro/ch-9.html"><img style="border-style: none;" alt="CC0" src="assets/images/cc-by.png" height="17"/></a> |
                <!-- <a style="color: var(--footer-hyperlink-text-color)" href="searchform.html">Search</a> | -->
                 <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://www.ihe.net/resources/public_comment/">Propose a change<img alt="external" style="vertical-align: baseline" src="external.png"/></a>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HLBNC861DJ');
</script>

          </span>
        </p>
      </div>  <!-- /inner-wrapper -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
    <div class="container">  <!-- container -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-post-footer -->
  
  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
  <script type="text/javascript" src="assets/js/respond.min.js"> </script>
  <script type="text/javascript" src="assets/js/anchor.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard-btn.js"> </script>
  <script>anchors.options.visible = 'hover'
anchors.add()</script>
  
<!-- feedback form - Google forms -->
<!-- v0.1, 2021-01-09 -->


  
    
  


  
    
  



<!-- / feedback form  -->

  <!-- Analytics Below
  ================================================== -->
  </body>
</html>

