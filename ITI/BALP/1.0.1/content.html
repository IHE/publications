<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>IHE.ITI.BASICAUDIT\3:5.7 Basic Audit Log Patterns - FHIR v4.0.1</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->
<link href="assets/css/ihe.css" rel="stylesheet"/>
<script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-HLBNC861DJ" async> </script> 

<link href="assets/css/nonum.css" rel="stylesheet"/>


    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"3"}
    h3,h4,h5,h6{--heading-prefix:"3"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->
      <div class="container">  <!-- container -->
        <!-- Placeholder for child template header declarations -->

<div id="project-nav">
  <a id="ihe-logo" no-external="true" href="http://profiles.ihe.net">
    <img height="71" alt="Visit the IHE website" src="assets/images/ihe-international.png"/>
  </a>
</div>
<div id="family-nav">
  <a id="family-logo" no-external="true" href="http://hl7.org/fhir"><img height="30" alt="Visit the FHIR website" src="assets/images/fhir-logo.png"/> </a>
</div>
<!--
<div id="hl7-search">
  <a id="hl7-search-lnk" no-external="true" href="searchform.html"><img alt="Search FHIR" src="assets/images/search.png"/></a>
</div>
-->
        <div id="project-nav">
          <a id="project-logo" no-external="true" href="http://profiles.ihe.net/ITI/index.html"><img height="70" alt="Visit the ITI website" src="assets/images/ITI_Graphic.png"/> </a>
        </div>




        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">IHE ITI Basic AuditEvent Implementation Guide</span>
            <br/>
            <span style="display:inline-block;">1.0.1 - ballot



  <img alt="International flag" src="assets/images/001.svg" height="16" title="International"/>


            </span>
          </p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->

    <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">  <!-- container -->
        <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
          <!--status-bar-->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a class="navbar-brand hidden" href="http://hl7.org/fhir/R4/index.html">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <!-- menu.xml  -->

<ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
  <li>
    <a href="index.html">BasicAudit Home</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Volume 1
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="volume-1.html">Introduction</a>
      </li>
      <li>
        <a href="volume-1.html#1521-basicaudit-actors-and-content">Actors and Content</a>
      </li>
      <li>
        <a href="volume-1.html#1522-basicaudit-actor-options">Actor Options</a>
      </li>
      <li>
        <a href="volume-1.html#1523-basicaudit-required-actor-grouping">Required Groupings</a>
      </li>
      <li>
        <a href="volume-1.html#1524-basicaudit-overview">Overview</a>
      </li>
      <li>
        <a href="volume-1.html#1525-basicaudit-security-considerations">Security Considerations</a>
      </li>
      <li>
        <a href="volume-1.html#1526-basicaudit-cross-profile-considerations">Cross-Profile Considerations</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Volume 3
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="content.html">Basic Audit Log Patterns</a>
      </li>
      <li>
        <a href="content.html#3573-restful-activities">-RESTful activities</a>
      </li>
      <li>
        <a href="content.html#3574-saml-security-token">-SAML Security Token</a>
      </li>
      <li>
        <a href="content.html#3575-oauth-security-token">-OAuth Security Token</a>
      </li>
      <li>
        <a href="content.html#3576-consent-authorized-decision-audit-message">-Consent Authorized Decision Audit Message</a>
      </li>
      <li>
        <a href="content.html#3577-privacy-disclosure-audit-message">-Privacy Disclosure Audit Message</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="testplan.html">Test Plan</a>
  </li>
  <li>
    <a href="artifacts.html">Artifacts</a>
  </li>
  <li>
    <a href="other.html">Other</a>
  </li>
</ul>
            </div>  <!-- /.nav-collapse -->
          </div>  <!-- /.container -->
        </nav>  <!-- /.navbar -->
      <!-- /HEADER CONTENT -->
      </div>  <!-- /container -->
    </div>  <!-- /segment-navbar -->
    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><b>3:5.7 Basic Audit Log Patterns</b></li>

          <span style="float:right;">

            <a href="volume-1.html">&lt;prev</a> | 

            <a href="#bottom">bottom</a>

          | <a href="testplan.html">next&gt;</a>

          </span>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">This page is part of the IHE Basic Audit Log Patterns (BALP) (v1.0.1: Public Comment Ballot 1) based on <a href="http://hl7.org/fhir/R4">FHIR R4</a>. The current version which supercedes this version is <a href="https://profiles.ihe.net/ITI/BALP/content.html">1.1.1</a>.  For a full list of available versions, see the <a href="https://profiles.ihe.net/ITI/BALP/history.html">Directory of published versions <img src="external.png" style="text-align: baseline"></a></p><!--EndReleaseHeader-->
  <h2>3:5.7 Basic Audit Log Patterns</h2>
  












    <p><!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#3571-scope" id="markdown-toc-3571-scope">3:5.7.1 Scope</a></li>
  <li><a href="#3572-content" id="markdown-toc-3572-content">3:5.7.2 Content</a></li>
  <li><a href="#3573-restful-activities" id="markdown-toc-3573-restful-activities">3:5.7.3 RESTful activities</a></li>
  <li><a href="#3574-saml-security-token" id="markdown-toc-3574-saml-security-token">3:5.7.4 SAML Security Token</a></li>
  <li><a href="#3575-oauth-security-token" id="markdown-toc-3575-oauth-security-token">3:5.7.5 OAuth Security Token</a></li>
  <li><a href="#3576-consent-authorized-decision-audit-message" id="markdown-toc-3576-consent-authorized-decision-audit-message">3:5.7.6 Consent Authorized Decision Audit Message</a></li>
  <li><a href="#3577-privacy-disclosure-audit-message" id="markdown-toc-3577-privacy-disclosure-audit-message">3:5.7.7 Privacy Disclosure Audit Message</a></li>
</ul>

</div>
<h3 id="3571-scope">3:5.7.1 Scope</h3>

<p>The AuditEvent resource is used to record that an auditable event has happened. These auditable events are usually security or privacy relevant, but may be for other purposes. The profiles of AuditEvent here are to support security and/or privacy use-cases. These profiles of AuditEvent can be used as is, or may be used to derive more specific profiles of AuditEvent for more specific use-cases.</p>

<h3 id="3572-content">3:5.7.2 Content</h3>

<p>The following AuditEvent patterns are defined:</p>
<ul>
  <li><a href="content.html#3573-restful-activities">RESTful activities</a></li>
  <li><a href="content.html#3574-saml-security-token">SAML Security Token</a></li>
  <li><a href="content.html#3575-oauth-security-token">OAuth Security Token</a></li>
  <li><a href="content.html#3576-consent-authorized-decision-audit-message">Consent Authorized Decision Audit Message</a></li>
  <li><a href="content.html#3577-privacy-disclosure-audit-message">Privacy Disclosure Audit Message</a></li>
</ul>

<h3 id="3573-restful-activities">3:5.7.3 RESTful activities</h3>

<p>All but Delete follow a similar pattern of the initiator (client) of the RESTful interaction is identified as the Source Role ID, where the responder (server) is the Destination Role ID. This pattern is found in both DICOM and XDS.  It is possible to deviate from that pattern and use Application and Custodian. This deviation should be carefully considered.</p>

<p>When a FHIR RESTful interaction happens, the following AuditEvent patterns can be used. These AuditEvent patterns include a <code class="highlighter-rouge">user</code> slice that is minimally populated. These AuditEvent patterns can be combined with the Security Token Use pattern to record one AuditEvent that contains the details of the security context and the FHIR RESTful context.</p>

<p>There are two sets of profiles distinguished by <a href="volume-1.html#152416-patient-as-a-subject">Patient as a subject</a> being mandated to be populated.</p>

<table class="grid">
  <thead>
    <tr>
      <th>REST event</th>
      <th>basic profile</th>
      <th>with patient</th>
      <th>examples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Create (create)</td>
      <td><a href="StructureDefinition-IHE.BasicAudit.Create.html">Create</a></td>
      <td><a href="StructureDefinition-IHE.BasicAudit.PatientCreate.html">PatientCreate</a></td>
      <td><a href="StructureDefinition-IHE.BasicAudit.PatientCreate-examples.html">examples</a></td>
    </tr>
    <tr>
      <td>Read (read and vread)</td>
      <td><a href="StructureDefinition-IHE.BasicAudit.Read.html">Read</a></td>
      <td><a href="StructureDefinition-IHE.BasicAudit.PatientRead.html">PatientRead</a></td>
      <td><a href="StructureDefinition-IHE.BasicAudit.PatientRead-examples.html">examples</a></td>
    </tr>
    <tr>
      <td>Update (update, patch)</td>
      <td><a href="StructureDefinition-IHE.BasicAudit.Update.html">Update</a></td>
      <td><a href="StructureDefinition-IHE.BasicAudit.PatientUpdate.html">PatientUpdate</a></td>
      <td><a href="StructureDefinition-IHE.BasicAudit.PatientUpdate-examples.html">examples</a></td>
    </tr>
    <tr>
      <td>Delete (delete)</td>
      <td><a href="StructureDefinition-IHE.BasicAudit.Delete.html">Delete</a></td>
      <td><a href="StructureDefinition-IHE.BasicAudit.PatientDelete.html">PatientDelete</a></td>
      <td><a href="StructureDefinition-IHE.BasicAudit.PatientDelete-examples.html">examples</a></td>
    </tr>
    <tr>
      <td>Execute (search and query)</td>
      <td><a href="StructureDefinition-IHE.BasicAudit.Query.html">Query</a></td>
      <td><a href="StructureDefinition-IHE.BasicAudit.PatientQuery.html">PatientQuery</a></td>
      <td><a href="StructureDefinition-IHE.BasicAudit.PatientQuery-examples.html">examples</a></td>
    </tr>
  </tbody>
</table>

<p>An example of an auditable event being recorded by the client and server is represented by the Create examples.</p>

<h4 id="35731-x-request-id-header">3:5.7.3.1 X-Request-Id header</h4>

<p>Where it is known that a http RESTful transaction included a X-Request-Id, that value should be recorded in an .entity dedicated to X-Request-Id. This ID can be used to coorelated AuditEvents from client and server, and may aid with coorelation on further activitites recorded caused by the transaction. This means that the .entity holding the X-Request-Id may appear in AuditEvents beyond those defined here.</p>

<h3 id="3574-saml-security-token">3:5.7.4 SAML Security Token</h3>

<p>This section only applies to auditing agents that have access to the content of the SAML Security Token. This section is only concerned with the AuditEvent profiling to use when an event is attributable to an agent defined in a SAML Security Token. This does not cover how the SAML Token was created, acquired, authorized, or managed. See <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">IHE-XUA</a>.  This specification presumes that the interactions to obtain the “SAML Security Token” were themselves auditable events and properly recorded in the audit log.</p>

<p>In this section we use the term “SAML Security Token” in a general sense to refer to either (a) a XUA SAML token being used in an <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-40.html#3.40">ITI-40</a>, or (b) any other SAML token used to secure an Interoperability transaction.</p>

<p>There is documentation of the audit event details to be added to a grouped transaction audit event log in <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-40.html#3.40.4.2">XUA Security Considerations 2:3.40.4.2</a>, however this is not explaining how this should be recorded in a FHIR AuditEvent. There are two patterns defined here: minimal, and comprehensive. Where minimal presumes that when the audit log is used, the system using the AuditEvent has access to the security infrastructure registry and logs to lookup the identifiers, thus the details taht could be looked up later are not replicated in the AuditEvent. Comprehensive presumes that there is no access to lookup these details, thus preserving as much of the Security Token into the AuditEvent as is reasonable and useful.</p>

<h4 id="35741-saml---minimal-auditevent-record">3:5.7.4.1 SAML - Minimal AuditEvent record</h4>

<p>The Minimal AuditEvent pattern defined here is not the same as the one defined in <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>, mostly due to the more expressive and coded nature of the FHIR AuditEvent over the DICOM AuditMessage.</p>

<p>The Minimal AuditEvent pattern preserves the SAML ID, so that the contents of the SAML assertion can be retrieved from the SAML Identity Provider (IdP) when such access is available. The Minimal AuditEvent pattern preserves the Issuer and Subject NameID in the who.Identifier, and any purposeOfUse into the purposeOfUse element.</p>

<p>Note: that XUA recommends alias be filled with SPProvidedID which is not defined in XUA and is found to be deprecated in many SAML specifiations. So this specification does not record or refer to the SPProvidedId.</p>

<ul>
  <li><a href="StructureDefinition-IHE.BasicAudit.SAMLaccessTokenUse.Minimal.html">StructureDefinition profile of Basic AuditEvent pattern for when activity was authorized by an SAML access token</a>
    <ul>
      <li><a href="StructureDefinition-IHE.BasicAudit.SAMLaccessTokenUse.Minimal-examples.html">examples</a></li>
    </ul>
  </li>
</ul>

<h4 id="35742-saml---comprehensive-auditevent-record">3:5.7.4.2 SAML - Comprehensive AuditEvent record</h4>

<p>This pattern preserves most SAML attributes in the AuditEvent. Not all are preserved as some attributes are proven during the SAML token validation and thus carry no further informtion useful in an AuditEvent (e.g., not before).</p>

<p>Local policy may choose to record less than are defined here, or may choose to record more.</p>

<p>For those using SAML beyond XUA, there is no specific guidance here.</p>

<ul>
  <li><a href="StructureDefinition-IHE.BasicAudit.SAMLaccessTokenUse.Comprehensive.html">StructureDefinition profile of Basic AuditEvent pattern for SAML Comprehensive</a>
    <ul>
      <li><a href="StructureDefinition-IHE.BasicAudit.SAMLaccessTokenUse.Comprehensive-examples.html">examples</a></li>
    </ul>
  </li>
</ul>

<h4 id="35743-saml-mapping-to-auditevent">3:5.7.4.3 SAML mapping to AuditEvent</h4>

<p>The following table uses a short-hand for the SAML fields and FHIR AuditEvent elements to keep the table compact. It is presumed the reader can understand the SAML field and the FHIR AuditEvent element given. Note the <code class="highlighter-rouge">~</code> character represents attributes under the SAML <code class="highlighter-rouge">AttributeStatement</code>.</p>

<table class="grid">
  <thead>
    <tr>
      <th>SAML field</th>
      <th>Comprehensive AuditEvent</th>
      <th>Minimal AuditEvent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ID</td>
      <td>agent[user].policy</td>
      <td>agent[user].policy</td>
    </tr>
    <tr>
      <td>Issuer</td>
      <td>agent[user].who.identifier.system</td>
      <td>agent[user].who.identifier.system</td>
    </tr>
    <tr>
      <td>SignedInfo</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>KeyInfo</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>KeyValue</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>Subject.NameID</td>
      <td>agent[user].who.identifier.value</td>
      <td>agent[user].who.identifier.value</td>
    </tr>
    <tr>
      <td>SubjectConfirmation</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>NotBefore</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>NotOnOrAfter</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>AudienceRestrictions</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>ProxyRestrictions</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>OneTimeUser</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>AuthnContextClassRef</td>
      <td>agent[user].extension[assuranceLevel]</td>
      <td> </td>
    </tr>
    <tr>
      <td>AuthnContextDeclRef</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>~subject:subject-id</td>
      <td>agent[user].extension[otherId][subject-id].identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>~subject:npi</td>
      <td>agent[user].extension[otherId][npi].identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>~subject:provider-identifier</td>
      <td>agent[user].extension[otherId][provider-id].identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>~subject:organization</td>
      <td>agent[userorg].who.display</td>
      <td> </td>
    </tr>
    <tr>
      <td>~subject:organization-id</td>
      <td>agent[userorg].who.identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>~subject:role</td>
      <td>agent[user].role</td>
      <td>agent[user].role</td>
    </tr>
    <tr>
      <td>~subject:purposeofuse</td>
      <td>agent[user].purposeOfUse</td>
      <td>agent[user].purposeOfUse</td>
    </tr>
    <tr>
      <td>~bppc:2007:docid</td>
      <td>entity[consent].what.identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>~xua:2012:acp</td>
      <td>entity[consent].detail.valueString</td>
      <td> </td>
    </tr>
    <tr>
      <td>~resource:resource-id</td>
      <td>entity[consent-patient].what.identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>~homeCommunityId</td>
      <td>entity[consent].what.identifier.assigner.identifier.value</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>Other SAML attributes may be defined, but this specificaiton focuses on XUA attributes only.</p>

<h3 id="3575-oauth-security-token">3:5.7.5 OAuth Security Token</h3>

<p>This section is only concerned with the AuditEvent profiling to use when an event is attributable to an agent defined in an OAuth Security Token. This does not cover how the oAuth Token was created, acquired, authorized, or managed. See <a href="https://profiles.ihe.net/ITI/IUA/index.html">IUA</a>.  This specification presumes that the interactions to obtain the “Oauth Security Token” were themselves auditable events and properly recorded in the audit log.</p>

<p>In this section we use the term “OAuth Security Token” in a general sense to refer to either (a) an <a href="https://profiles.ihe.net/ITI/IUA/index.html">IUA</a> OAuth Access Token being used in an <a href="https://profiles.ihe.net/ITI/IUA/index.html#372-incorporate-access-token-iti-72">ITI-72</a>, or (b) any other OAuth Access Token used to secure an Interoperability transaction (e.g., <a href="https://hl7.org/fhir/uv/bulkdata/authorization/index.html#presenting-an-access-token-to-fhir-api">SMART Backend Services</a>, or <a href="http://hl7.org/fhir/smart-app-launch/index.html#step-4-app-accesses-clinical-data-via-fhir-api">SMART App Launch Framework</a>, or other).</p>

<p>There are three patterns defined: opaque, minimal, and comprehensive.</p>
<ul>
  <li>Where opaque is used when the client and/or server has only an opaque token (encrypted JWT) where no further details are known. There is still a need to include some evidence in the AuditEvent to tie this audit log entry with a specific token, but the whole token should not be recorded for security reasons. There are introspection functions often available, but often use of this impacts performance.</li>
  <li>Where minimal presumes that when the audit log is used, the system using the AuditEvent has access to the security infrastructure registry and logs to lookup the identifiers, thus the details that could be looked up later are not replicated in the AuditEvent.</li>
  <li>Comprehensive presumes that there is no access to lookup these details, thus preserving as much of the Security Token into the AuditEvent as is reasonable and useful.</li>
</ul>

<p>Given that IHE has the <a href="https://profiles.ihe.net/ITI/IUA/index.html">IUA Profile</a>, and has <a href="https://profiles.ihe.net/ITI/IUA/index.html#37251-security-audit-considerations">Security Audit Considerations</a>, the AuditEvent specification here will focus on IUA interactions. The profiling AuditEvent defined here is the AuditEvent that the Client and Server would record when using <a href="https://profiles.ihe.net/ITI/IUA/index.html">IUA</a> with the <a href="https://profiles.ihe.net/ITI/IUA/index.html#372-incorporate-access-token-iti-72">ITI TF-2: 3.72 Incorporate Access Token [ITI-72]</a> to secure some RESTful transaction. The RESTful transaction is not defined here, just the additional AuditEvent element details that would be added to the AuditEvent for the RESTful transaction being secured (see <a href="content.html#3573-restful-activities">RESTful activities</a> for general purpose logging).</p>

<p>The <a href="https://profiles.ihe.net/ITI/IUA/index.html">IUA</a> Profile is used here as a proxy for all oAuth specifications. <a href="https://profiles.ihe.net/ITI/IUA/index.html">IUA</a> is used here because IHE has direct access and has defined fields. The Minimal AuditEvent pattern defined here is not the same as the one defined in <a href="https://profiles.ihe.net/ITI/IUA/index.html">IUA</a>, mostly due to the more expressive and coded nature of the FHIR AuditEvent fs the DICOM AuditMessage.</p>

<p>The Client and Server are both encouraged to log an AuditEvent covering any security relevant event, and to enhance that AuditEvent with one of the following patterns when an oAuth token is associated with authorizing (or forbidding) the event.</p>

<h4 id="35751-oauth---opaque-auditevent-record">3:5.7.5.1 oAuth - Opaque AuditEvent record</h4>

<p>The Opaque AuditEvent profile would be used when the token is opaque (usually encrypted JWT). The token should be shortened to not more than 32 characters, and those characters should be from the end of the token to assure the most entropy. The presumption is that the many AuditEvent(s) can be coorelated to all be related to the same security token given this shortened token string.</p>

<p>Other elements may be recorded following the Minimal or Comprehensive pattern.</p>

<ul>
  <li><a href="StructureDefinition-IHE.BasicAudit.OAUTHaccessTokenUse.Opaque.html">StructureDefinition profile of Basic AuditEvent pattern for oAuth Opaque</a>
    <ul>
      <li><a href="StructureDefinition-IHE.BasicAudit.OAUTHaccessTokenUse.Opaque-examples.html">examples</a></li>
    </ul>
  </li>
</ul>

<h4 id="35752-oauth---minimal-auditevent-record">3:5.7.5.2 oAuth - Minimal AuditEvent record</h4>

<p>The Minimal AuditEvent pattern would be used when the JWT token is available at the time the AuditEvent is recorded.</p>

<p>The Minimal AuditEvent pattern defined here is not the same as the one defined in <a href="https://profiles.ihe.net/ITI/IUA/index.html#37251-security-audit-considerations">ITI-72 Security Audit Considerations</a>, mostly due to the more expressive and coded nature of the FHIR AuditEvent over the DICOM AuditMessage. This AuditEvent pattern is also recommended for both client and server to the extent possible.</p>

<p>The Minimal AuditEvent pattern preserves the oAuth JWT ID, so that the contents of the oAuth token can be retrieved from the oAuth Authority when such access is available. The Minimal AuditEvent pattern preserves the iss (JWT Issuer) and sub (JWT Subject) in the who.Identifier, the client_id in second agent, and any purposeOfUse into the purposeOfUse element.</p>

<ul>
  <li><a href="StructureDefinition-IHE.BasicAudit.OAUTHaccessTokenUse.Minimal.html">StructureDefinition profile of Basic AuditEvent pattern for when activity was authorized by an oAuth security token</a>
    <ul>
      <li><a href="StructureDefinition-IHE.BasicAudit.OAUTHaccessTokenUse.Minimal-examples.html">examples</a></li>
    </ul>
  </li>
</ul>

<h4 id="35753-oauth---comprehensive-auditevent-record">3:5.7.5.3 oAuth - Comprehensive AuditEvent record</h4>

<p>This pattern preserves most oAuth JWT fields in the AuditEvent. Not all are preserved as some attributes are proven during the oAuth token validation and thus carry no further informtion useful in an AuditEvent (e.g., not before).</p>

<p>Local policy may choose to record less than are defined here, or may choose to record more.</p>

<p>For those using oAuth beyond IUA, there is no specific guidance here.</p>

<ul>
  <li><a href="StructureDefinition-IHE.BasicAudit.OAUTHaccessTokenUse.Comprehensive.html">StructureDefinition profile of Basic AuditEvent pattern for oAuth Comprehensive</a>
    <ul>
      <li><a href="StructureDefinition-IHE.BasicAudit.OAUTHaccessTokenUse.Comprehensive-examples.html">examples</a></li>
    </ul>
  </li>
</ul>

<h4 id="35754-oauth-mapping-to-auditevent">3:5.7.5.4 oAuth mapping to AuditEvent</h4>

<p>The following table uses a short-hand for the oAuth fields and FHIR AuditEvent elements to keep the table compact. It is presumed the reader can understand the field and the FHIR AuditEvent element given. This also presumes that the one recording the AuditEvent has this level access to the oAuth fields. Note: Prefix with a “:” is the specification that defined that field (IHE-IUA, IHE-BPPC, etc.).</p>

<p>Note: Opaque is not shown in the table as it has no access to any oAuth Fields.</p>

<table class="grid">
  <thead>
    <tr>
      <th>oAuth field</th>
      <th>Comprehensive AuditEvent</th>
      <th>Minimal AuditEvent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>iss (JWT Issuer)</td>
      <td>agent[user].who.identifier.system</td>
      <td>agent[user].who.identifier.system</td>
    </tr>
    <tr>
      <td>sub (JWT Subject)</td>
      <td>agent[user].who.identifier.value</td>
      <td>agent[user].who.identifier.value</td>
    </tr>
    <tr>
      <td>aud (JWT Audience)</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>jti (JWT ID)</td>
      <td>agent[user].policy</td>
      <td>agent[user].policy</td>
    </tr>
    <tr>
      <td>exp (JWT Expiration Time)</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>nbf (JWT Not before)</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>iat (JWT Issued at)</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>client_id (OA2 client id)</td>
      <td>agent[client].who.identifier.value</td>
      <td>agent[client].who.identifier.value</td>
    </tr>
    <tr>
      <td>scope (OA2 token scope)</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>ihe_iua:subject_name</td>
      <td>agent[user].who.display</td>
      <td> </td>
    </tr>
    <tr>
      <td>ihe_iua:subject_organization</td>
      <td>agent[userorg].who.display</td>
      <td> </td>
    </tr>
    <tr>
      <td>ihe_iua:subject_organization_id</td>
      <td>agent[userorg].who.identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>ihe_iua:subject_role</td>
      <td>agent[user].role</td>
      <td>agent[user].role</td>
    </tr>
    <tr>
      <td>ihe_iua:purpose_of_use</td>
      <td>agent[user].purposeOfUse</td>
      <td>agent[user].purposeOfUse</td>
    </tr>
    <tr>
      <td>ihe_iua:home_community_id</td>
      <td>entity[consent].what.identifier.assigner.identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>ihe_iua:national_provider_identifier</td>
      <td>agent[user].extension[otherId][npi].identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>ihe_iua:person_id</td>
      <td>agent[user].extension[otherId][provider-id].identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>ihe_bppc:patient_id</td>
      <td>entity[consent-patient].what.identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>ihe_bppc:doc_id</td>
      <td>entity[consent].what.identifier.value</td>
      <td> </td>
    </tr>
    <tr>
      <td>ihe_bppc:acp</td>
      <td>entity[consent].detail.valueString</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="3576-consent-authorized-decision-audit-message">3:5.7.6 Consent Authorized Decision Audit Message</h3>

<p>This set of auditEvent messages would be recorded by an Authorization Service when an authorization decision is rendered that is based on a Consent. This AuditEvent is not specific to the authorization technolology (SAML/XACML, Oauth, other). This AuditEvent is specific to describing the Consent involved in the authorization decision. Success would indicate that a Permit is allowed, Failure would indicate that Deny was returned as the authorization decision.</p>

<ul>
  <li><a href="StructureDefinition-IHE.BasicAudit.AuthZconsent.html">Authorization Decision inclusive of Consent</a>
    <ul>
      <li><a href="StructureDefinition-IHE.BasicAudit.AuthZconsent-examples.html">examples</a></li>
    </ul>
  </li>
</ul>

<h3 id="3577-privacy-disclosure-audit-message">3:5.7.7 Privacy Disclosure Audit Message</h3>

<p>This is transformed from the content defined today in ATNA ITI-20 <a href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-20.html#3.20.8">2:3.20.8 Disclosure audit message</a>. It is replicated here for ease of understanding, and is presented here using the FHIR AuditEvent. There are some differences caused and enabled by the FHIR AuditEvent schema and profiling.</p>

<p>In some countries a Patient has the right to get an accounting of disclosures. This report includes disclosures of their data that meet regulatory criteria. Most audit events, including export events, must be post-analyzed to determine whether they describe an event that needs to be included in the accounting of disclosures. For example, in the USA these rules are defined in <a href="https://www.cdc.gov/phlp/publications/topic/hipaa.html">HIPAA</a>, and only a few kinds of export events meet the criteria to be included in an accounting of disclosures report. When it is known, at the time the event is recorded, that the event is indeed a disclosure, the disclosure audit message can be used to document the event.</p>

<p>The requirements of an accounting of disclosures are defined in <a href="https://www.astm.org/e2147-01.html">ASTM-2147</a>. A disclosure shall include the following, when the value is known:</p>

<ul>
  <li>Who did the disclosure (the releasing agent),</li>
  <li>When did the disclosure happen,</li>
  <li>Who was the data disclosed to (receiving agent machine and other parties, if known),</li>
  <li>What patient was involved (multiple patients would be done as multiple audit entries),</li>
  <li>What data was involved, and</li>
  <li>Why the disclosure was done</li>
</ul>

<p>There is some other information that may be available:</p>

<ul>
  <li>Who is the custodian of the data (the official organization responsible), and</li>
  <li>Who authorized the release such as a guardian or relative (authorizing agent)</li>
</ul>

<p>The following is the layout of the Disclosure audit event. This pattern will be extended and modified by applications when appropriate.</p>

<ul>
  <li><a href="StructureDefinition-IHE.BasicAudit.PrivacyDisclosure.Recipient.html">Disclosure reported by the Recipient</a>
    <ul>
      <li><a href="StructureDefinition-IHE.BasicAudit.PrivacyDisclosure.Recipient-examples.html">examples</a></li>
    </ul>
  </li>
  <li><a href="StructureDefinition-IHE.BasicAudit.PrivacyDisclosure.Source.html">Disclosure reported by the Source</a>
    <ul>
      <li><a href="StructureDefinition-IHE.BasicAudit.PrivacyDisclosure.Source-examples.html">examples</a></li>
    </ul>
  </li>
</ul>




</div>
        </div>  <!-- /inner-wrapper -->
      </div>  <!-- /row -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-content -->

  <script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

  <script type="text/javascript">
    $(document).ready(function(){
      if(window.location.hash != "") {
          $('a[href="' + window.location.hash + '"]').click()
      }
    });
  </script>
  <a name="bottom"> </a>
  <div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
    <div class="container">  <!-- container -->

      <div style="background-color:var(--footer-nav-bg-color)">
        <table style="width:100%">
          <tbody>
            <tr>
              <td style="text-align:left">&#xA0;

                <a href="volume-1.html">&lt;prev</a>

              </td>
              <td style="text-align:center">
                <a href="#top">top</a>
              </td>
              <td style="text-align:right">&#xA0;

                <a href="testplan.html">next&gt;</a>

              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="inner-wrapper">
        <p>
          IG &#169; 2022+ <a style="color:var(--footer-hyperlink-text-color)" href="https://www.ihe.net/ihe_domains/it_infrastructure/">IHE IT Infrastructure Technical Committee</a>.  Package ihe.iti.basicaudit#1.0.1 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Wed, Mar 2, 2022 07:55-0600">2022-03-02</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)"></span>
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                  | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/IHE/ITI.BasicAudit/issues/new/choose">New Issue</a> | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/IHE/ITI.BasicAudit/issues">Issues</a>
                
                 <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://profiles.ihe.net/ITI/basicaudit/history.html">Version History</a></a> |
                 <a style="color: var(--footer-hyperlink-text-color)" rel="license" href="http://hl7.org/fhir/R4/license.html"><img style="border-style: none;" alt="CC0" src="assets/images/cc-by.png" height="17"/></a> |
                <!-- <a style="color: var(--footer-hyperlink-text-color)" href="searchform.html">Search</a> | -->
                 <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://www.ihe.net/resources/public_comment/">Propose a change<img alt="external" style="vertical-align: baseline" src="external.png"/></a>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HLBNC861DJ');
</script>

          </span>
        </p>
      </div>  <!-- /inner-wrapper -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
    <div class="container">  <!-- container -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-post-footer -->
  
  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
  <script type="text/javascript" src="assets/js/respond.min.js"> </script>
  <script type="text/javascript" src="assets/js/anchor.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard-btn.js"> </script>
  <script>anchors.options.visible = 'hover'
anchors.add()</script>
  
<!-- feedback form - Google forms -->
<!-- v0.1, 2021-01-09 -->


  
    
  


  
    
  



<!-- / feedback form  -->

  <!-- Analytics Below
  ================================================== -->
  </body>
</html>

