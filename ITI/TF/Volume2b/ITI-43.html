<html xmlns="http://www.w3.org/1999/xhtml" lang="en_US">
  <head>
    <meta charset="utf-8" />
    <title>IHE_ITI_TF_Rev16-0_Vol2b_FT</title>
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body>
    <p>
      <img src="media/image1.jpeg" class="IHE logo" alt="IHE_LOGO_for_tf-docs" />
    </p>
    <p>IHE IT Infrastructure (ITI)</p>
    <p>Technical Framework - Volume2b</p>
    <p>Revision 16.0 – Final Text</p>
    <p>
      <hr />
    </p>
    <h2 class="list-paragraph" id="3.43">3.43 Retrieve Document Set [ITI-43]</h2>
    <p>This section corresponds to transaction [ITI-43] of the IHE Technical Framework. The Document Consumer, Document Repository, On-Demand Document Source, and Initiating Gateway Actors use transaction [ITI-43].</p>
    <table>
      <thead>
        <tr class="header">
          <th>Integration Profiles using this Transaction</th>
        </tr>
      </thead>
      <tbody>
        <tr class="odd">
          <td>Cross-Enterprise Document Sharing-b (XDS.b)</td>
        </tr>
        <tr class="even">
          <td>Cross-Community Access (XCA)</td>
        </tr>
      </tbody>
    </table>
    <p>Actors that support the Asynchronous Web Services Exchange Option shall support Asynchronous Web Services Exchange on all XDS.b transactions they implement. Refer to Section ITI TF-2x: V.3 Synchronous and Asynchronous (WS-Addressing based) Web Services Exchange for an explanation of Asynchronous Web Services Exchange.</p>
    <h3 class="list-paragraph" id="3.43.1">3.43.1 Scope</h3>
    <p>This transaction is used by the Document Consumer to retrieve a set of documents from the Document Repository, On-Demand Document Source, or Initiating Gateway. The Document Consumer has already obtained the XDSDocumentEntry uniqueId and the Document Repository repositoryUniqueId from the Document Registry/Initiating Gateway by means of the Registry Stored Query transaction.</p>
    <h3 class="list-paragraph" id="3.43.2">3.43.2 Use Case Roles</h3>
    <blockquote>
      <p>Actor: Document Consumer</p>
      <p>Role: Obtains document.</p>
      <p>Actor: Document Repository or Integrated Document Source/Repository</p>
      <p>Role: Provides documents.</p>
      <p>Actor: Initiating Gateway</p>
      <p>Role: An Initiating Gateway which implements the XDS Affinity Domain Option retrieves a set of documents by using the Cross Gateway Retrieve transaction and/or a Retrieve Document Set transaction.</p>
      <p>Actor: On-Demand Document Source</p>
      <p>Role: Creates documents in response to a request for retrieval of an on-demand document entry.</p>
    </blockquote>
    <p>Note: Within this transaction, the Document Repository and Integrated Document Source/Repository Actors can be used interchangeably.</p>
    <h3 class="list-paragraph" id="3.43.3">3.43.3 Referenced Standard</h3>
    <p>Implementors of this transaction shall comply with all requirements described in <a href="../Volume2x/ch-22.html#Appendix V">ITI TF-2x: Appendix V</a>: Web Services for IHE Transactions.</p>
    <table>
      <thead>
        <tr class="header">
          <th>ebRIM</th>
          <th>OASIS/ebXML Registry Information Model v3.0</th>
        </tr>
      </thead>
      <tbody>
        <tr class="odd">
          <td>ebRS</td>
          <td>OASIS/ebXML Registry Services Specifications v3.0</td>
        </tr>
        <tr class="even">
          <td><a href="../Volume3/ch-1.html#4">ITI TF-3:4</a></td>
          <td>Metadata in Document Sharing profiles</td>
        </tr>
        <tr class="odd">
          <td>MTOM</td>
          <td>
            SOAP Message Transmission Optimization Mechanism
            <a href="http://www.w3.org/TR/soap12-mtom/">http://www.w3.org/TR/soap12-mtom/</a>
          </td>
        </tr>
        <tr class="even">
          <td>XOP</td>
          <td>XML-binary Optimized Packaging http://www.w3.org/TR/2005/REC-xop10-20050125/</td>
        </tr>
      </tbody>
    </table>
    <h3 class="list-paragraph" id="3.43.4">3.43.4 Messages</h3>
    <p>Figure 3.43.4-1: Interaction Diagram</p>
    <h4 class="list-paragraph" id="3.43.4.1">3.43.4.1 Retrieve Document Set Request</h4>
    <h5 class="list-paragraph" id="3.43.4.1.1">3.43.4.1.1Trigger Events</h5>
    <p>The Document Consumer obtains document(s) uniqueId via the Registry Stored Query transaction. If the Registry Stored Query was sent to the Initiating Gateway the Document Consumer shall address the Retrieve Document Set to the Initiating Gateway. In this case no resolution of repositoryUniqueId is needed by the Document Consumer. The Document Consumer shall specify the homeCommunityId element in the Retrieve Document Set transaction if it was found in the entry containing the uniqueId of the document being retrieved. For more information regarding the homeCommunityId, see Section 3.38.4.1.2.</p>
    <p>Once the document(s) uniqueId have been obtained, the Document Consumer will start the Retrieve Document Set Request with the Document Repository.</p>
    <h5 class="list-paragraph" id="3.43.4.1.2">3.43.4.1.2 Message Semantics</h5>
    <p>The Retrieve Document Set Request shall carry the following information:</p>
    <ul>
      <li>
        <p>A required repositoryUniqueId that identifies the repository from which the document is to be retrieved. This value corresponds to XDSDocumentEntry.repositoryUniqueId.</p>
      </li>
      <li>
        <p>A required documentUniqueId that identifies the document within the repository. This value corresponds to the XDSDocumentEntry.uniqueId.</p>
      </li>
      <li>
        <p>If available, the homeCommunityId element that identifies the community holding the document. The homeCommunityId element shall be specified if the XDSDocumentEntry containing the uniqueId of the document contains the homeCommunityId attribute. See <a href="../Volume2a/ITI-18.html#3.18.4.1.2">ITI TF-2a: 3.18.4.1.2</a> for details.</p>
      </li>
    </ul>
    <p>The repositoryUniqueId associated to each document requested can be different therefore allowing a single request to identify multiple repositories.</p>
    <h5 class="list-paragraph" id="3.43.4.1.3">3.43.4.1.3 Expected Actions</h5>
    <p>When receiving a Retrieve Document Set Request, a Document Repository or an Initiating Gateway shall generate a Retrieve Document Set Response containing the requested documents or error codes if the documents could not be retrieved.</p>
    <p>An XCA Initiating Gateway receiving the Retrieve Document Set Request shall use the homeCommunityId to obtain the Web Services endpoint of the Responding Gateways or, in the case where homeCommunityId identifies the local community, use the repositoryUniqueId to obtain the Web Services endpoint of the Document Repositories. The process of obtaining the Web Services endpoint is not further specified in this transaction. The Initiating Gateway shall send Cross Gateway Retrieves/Retrieve Document Set transactions to each appropriate Responding Gateway/Document Repository, consolidate the results, and return them to the Document Consumer.</p>
    <h6 class="list-paragraph" id="3.43.4.1.3.1">3.43.4.1.3.1 Basic Patient Privacy Enforcement Option</h6>
    <p>If the Basic Patient Privacy Enforcement Option is implemented:</p>
    <ol type="1">
      <li>
        <p>The Document Consumer shall abide by the XDS Affinity Domain Policies represented by the confidentialityCode in the metadata associated with the document. The Document Consumer likely will have user access controls or business rule capabilities to determine the details of how confidentiality codes apply to query results. The details of this are product specific and not specified by IHE. These rules shall reduce the query results to only those that are appropriate to the current situation for that actor and user.</p>
      </li>
    </ol>
    <ol start="5" type="1">
      <li>
        <p>The Document Consumer shall be able to be configured with Patient Privacy Policies, Patient Privacy Policy Identifiers (OIDs) and associated information necessary to understand and enforce the XDS Affinity Domain Policy. The details of this are product specific and not specified by IHE.</p>
      </li>
    </ol>
    <h6 class="list-paragraph" id="3.43.4.1.3.2">3.43.4.1.3.2 Delayed Document Assembly Option</h6>
    <p>If an Integrated Document Source/Repository supports the Delayed Document Assembly Option and has registered the document being retrieved with</p>
    <ul>
      <li>
        <p>size = 0 (zero)</p>
      </li>
      <li>
        <p>hash = da39a3ee5e6b4b0d3255bfef95601890afd80709 (SHA1 hash of a zero length file)</p>
      </li>
    </ul>
    <p>then it shall:</p>
    <ul>
      <li>
        <p>Assemble into a complete document the content identified at the time the Integrated Document Source/Repository registered the associated Stable Document Entry in the Document Registry.</p>
      </li>
      <li>
        <p>Return the assembled document in response to the Retrieve Document Set Request</p>
      </li>
      <li>
        <p>Save the assembled document for future retrievals since all future retrievals shall return the identical content.</p>
      </li>
      <li>
        <p>Update the Stable Document Entry in the Document Registry with the size and hash values consistent with the assembled document. This update shall be accomplished by grouping with the Document Administrator in the XDS.b Profile and using the Update Document Set [ITI-57] transaction.</p>
      </li>
    </ul>
    <h4 class="list-paragraph" id="3.43.4.2">3.43.4.2 Retrieve Document Set Response</h4>
    <h5 class="list-paragraph" id="3.43.4.2.1">3.43.4.2.1 Trigger Events</h5>
    <p>This message will be triggered by a Retrieve Document Set Request Message</p>
    <h5 class="list-paragraph" id="3.43.4.2.2">3.43.4.2.2 Message Semantics</h5>
    <p>The Retrieve Document Set Response Message shall carry the following information, for each of the returned documents:</p>
    <ul>
      <li>
        <p>A homeCommunityId. This value shall be the same as the homeCommunityId value in the Retrieve Document Set Request Message. If the homeCommunityId value is not present in the Retrieve Document Set Request Message, this shall not be present.</p>
      </li>
      <li>
        <p>A required repositoryUniqueId that identifies the repository from which the document is to be retrieved. This value shall be the same as the value of the repositoryUniqueId in the original Retrieve Document Set Request Message. This value corresponds to XDSDocumentEntry.repositoryUniqueId.</p>
      </li>
      <li>
        <p>A required documentUniqueId that identifies the document within the repository. This value shall be the same as the documentUniqueId in the original Retrieve Document Set Request Message. This value corresponds to the XDSDocumentEntry.uniqueId.</p>
      </li>
      <li>
        <p>The retrieved document as a XOP Infoset</p>
      </li>
      <li>
        <p>The MIME type of the retrieved document</p>
      </li>
      <li>
        <p>Errors or warnings in case the document(s) could not be retrieved successfully</p>
      </li>
    </ul>
    <p>If the documentUniqueId is associated with an On-Demand Document Entry, the Retrieve Document Set Response Message shall contain a NewDocumentUniqueId element that identifies the document that is returned in the Retrieve Document Set Response. This identifier shall be different than the DocumentUniqueId element which identifies the On-Demand Document Entry. The Retrieve Document Set Response Message may also include a NewRepositoryUniqueId element that identifies the Document Repository which holds the document returned in the Retrieve Document Set Response. If this element is not included, the document returned in the response has not been persisted for later retrieval. If the On-Demand Document Source implements the Persistence of Retrieved Documents Option, this element shall be specified. If a future Retrieve Document Set Message for the same DocumentUniqueId returns the same NewDocumentUniqueId, the content of the document shall be identical to the prior returned content. On-Demand Document Source Actors are encouraged to re-use Document uniqueId’s whenever content has not changed in order to facilitate identification of new content by Document Consumers.</p>
    <h5 class="list-paragraph" id="3.43.4.2.3">3.43.4.2.3 Expected Actions</h5>
    <p>A Document Repository or On-Demand Document Source shall return the document(s) indicated in the request.</p>
    <p>The Document Repository shall return the document or an error code in case the document could not be return. The conditions of failure and possible error messages are given in the ebRS standard and detailed in <a href="../Volume3/ch-1.2.html#4.2.4">ITI TF-3: 4.2.4</a> Error Reporting.</p>
    <p>An On-Demand Document Source which supports the Persistence of Retrieved Documents Option shall save the document content returned in the retrieve response and issue a Register Document Set-b [ITI-42] transaction to register a Stable Document Entry which describes the saved document. The On-Demand Document Source shall complete the registration of the Stable Document Entry prior to responding to the Retrieve Document Set request. The registration of the new Stable Document Entry shall include:</p>
    <ul>
      <li>
        <p>A Submission Set</p>
      </li>
      <li>
        <p>A DocumentEntry representing the Stable DocumentEntry.</p>
      </li>
      <li>
        <p>A HasMember association linking DocumentEntry to SubmissionSet.</p>
      </li>
      <li>
        <p>An IsSnapshotOf Association which identifies the sourceObject as the new Stable Document Entry and the targetObject as the On-Demand Document Entry which contains the uniqueID used in the Retrieve Document Set request. See <a href="../Volume3/ch-1.2.html#4.2.2.2">ITI TF-3: 4.2.2.2</a> for information about the IsSnapshotOf Association.</p>
      </li>
    </ul>
    <p>If the On-Demand Document Source has previously registered a snapshot of the On-Demand DocumentEntry, the registration of the new Stable DocumentEntry may also include a RPLC association, identifying the new Stable DocumentEntry as a replacement of the previously-registered Stable DocumentEntry.</p>
    <p>If this is not the first request for this on-demand document and a prior document was replaced, a Replace Association which identifies the prior document.</p>
    <h6 class="list-paragraph" id="3.43.4.2.3.1">3.43.4.2.3.1 Compatibility of Options</h6>
    <p>If the Document Consumer does not support the On-Demand Documents Option it will never send a Retrieve Document Set request for an On-Demand Document entry. In this case, none of the new attributes will be included in the response.</p>
    <p>If the Document Consumer does support the On-Demand Documents Option, it will only direct requests for On-Demand Document Entries to responders which have specified their unique repositoryUniqueId in the On-Demand Document Entry from the registry. Thus, unless there is an error in the metadata, there are no compatibility concerns with this transaction.</p>
    <h6 class="list-paragraph" id="3.43.4.2.3.2">3.43.4.2.3.2 Delayed Document Assembly Option</h6>
    <p>If a Document Consumer supports the Delayed Document Assembly Option, it shall not use the size=0 and hash=SHA1 hash of a zero length file values to verify documents. If verification is desired the Document Consumer shall use an appropriate stored query from the Registry Stored Query [ITI-18] transaction to get the updated size and hash values.</p>
    <h3 class="list-paragraph" id="3.43.5">3.43.5 Protocol Requirements</h3>
    <p>Implementors of this transaction shall comply with all requirements described in <a href="../Volume2x/ch-22.html#Appendix V">ITI TF-2x: Appendix V</a>: Web Services for IHE Transactions.</p>
    <p>The Retrieve Document Set transaction shall use SOAP12 and MTOM with XOP encoding (labeled MTOM/XOP in this specification). See <a href="../Volume2x/ch-22.html#Appendix V.3">ITI TF-2x: Appendix V.3</a> for details.</p>
    <p>The Document Repository shall:</p>
    <ul>
      <li>
        <p>Accept the Retrieve Document Set Request message in MTOM/XOP format.</p>
      </li>
      <li>
        <p>Generate the Retrieve Document Set Response message in MTOM/XOP format</p>
      </li>
    </ul>
    <p>The Document Consumer shall:</p>
    <ul>
      <li>
        <p>Generate the Retrieve Document Set Request message in MTOM/XOP format.</p>
      </li>
      <li>
        <p>Accept the Retrieve Document Set Response message in MTOM/XOP format.</p>
      </li>
    </ul>
    <p>XML namespace prefixes are for informational purposes only and are documented in <a href="../Volume2x/ch-22.html#Appendix V">ITI TF-2x: Appendix V</a>, Table V.2.4-1.</p>
    <p>Document Repository: These are the requirements for the Retrieve Document Set transaction presented in the order in which they would appear in the Document Repository WSDL definition:</p>
    <ul>
      <li>
        <p>The following types shall be imported (xsd:import) in the /definitions/types section:</p>
      </li>
    </ul>
    <ul>
      <li>
        <p>namespace="urn:ihe:iti:xds-b:2007", schema="IHEXDS.xsd"</p>
      </li>
    </ul>
    <ul>
      <li>
        <p>The /definitions/message/part/@element attribute of the Retrieve Document Set Request message shall be defined as “ihe:RetrieveDocumentSetRequest”</p>
      </li>
      <li>
        <p>The /definitions/message/part/@element attribute of the Retrieve Document Set Response message shall be defined as “ihe:RetrieveDocumentSetResponse”</p>
      </li>
    </ul>
    <ul>
      <li>
        <p>Refer to Table 3.43.5.b below for additional attribute requirements</p>
      </li>
    </ul>
    <p>To support the WS-Addressing Asynchronous Web Services Exchange Option on the Document Consumer, the Document Repository shall support the use of a non-anonymous response EPR in the WS-Addressing replyTo header.</p>
    <p>Table 3.43.5.b: Additional Attribute Requirements</p>
    <table>
      <thead>
        <tr class="header">
          <th>Attribute</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr class="odd">
          <td>/definitions/portType/operation@name</td>
          <td>DocumentConsumer_RetrieveDocumentSet</td>
        </tr>
        <tr class="even">
          <td>/definitions/portType/operation/input/@wsaw:Action</td>
          <td>urn:ihe:iti:2007:RetrieveDocumentSet</td>
        </tr>
        <tr class="odd">
          <td>/definitions/portType/operation/output/@wsaw:Action</td>
          <td>urn:ihe:iti:2007:RetrieveDocumentSetResponse</td>
        </tr>
        <tr class="even">
          <td>/definitions/binding/operation/wsoap12:operation/@soapActionRequired</td>
          <td>false</td>
        </tr>
      </tbody>
    </table>
    <p>These are the requirements that affect the wire format of the SOAP message. The other WSDL properties are only used within the WSDL definition and do not affect interoperability. Full sample request and response messages are in Section 3.43.5.1 Sample SOAP Messages.</p>
    <p>For informative WSDL for the Document Repository see in <a href="../Volume2x/ch-23.html#Appendix W">ITI TF-2x: Appendix W</a>.</p>
    <p>The &lt;ihe:RetrieveDocumentSetRequest/&gt; element is defined as:</p>
    <ul>
      <li>
        <p>One or more &lt;ihe:DocumentRequest/&gt; elements, each one representing an individual document that the Document Consumer wants to retrieve from the Document Repository. Each &lt;ihe:DocumentRequest/&gt; element contains:</p>
      </li>
    </ul>
    <ul>
      <li>
        <p>A required &lt;ihe:RepositoryUniqueId/&gt; element that identifies the repository from which the document is to be retrieved. This value corresponds to XDSDocumentEntry.repositoryUniqueId.</p>
      </li>
      <li>
        <p>A required &lt;ihe:DocumentUniqueId/&gt; that identifies the document within the repository. This value corresponds to the XDSDocumentEntry.uniqueId.</p>
      </li>
      <li>
        <p>An optional &lt;ihe:HomeCommunityId/&gt; element that corresponds to the home attribute of the Identifiable class in ebRIM.</p>
      </li>
    </ul>
    <p>This allows the Document Consumer to specify one or more documents to retrieve from the Document Repository.</p>
    <p>The &lt;ihe:RetrieveDocumentResponse/&gt; element is defined as:</p>
    <ul>
      <li>
        <p>A required /ihe:RetrieveDocumentSetResponse/rs:RegistryResponse element</p>
      </li>
      <li>
        <p>An optional sequence of &lt;ihe:DocumentResponse/&gt; elements containing</p>
      </li>
    </ul>
    <ul>
      <li>
        <p>A &lt;ihe:HomeCommunityId/&gt; element. The value of this element shall be the same as the value of the /RetrieveDocumentSetRequest/DocumentRequest/HomeCommunityId element in the Retrieve Document Set Request Message. If the &lt;ihe:HomeCommunityId/&gt; element is not present in the Retrieve Document Set Request Message, this value shall not be present.</p>
      </li>
      <li>
        <p>A required &lt;ihe:RepositoryUniqueId/&gt; that identifies the repository from which the document is to be retrieved. The value of this element shall be the same as the value of the /RetrieveDocumentSetRequest/DocumentRequest/RepositoryUniqueId element in the original Retrieve Document Set Request Message. This value corresponds to XDSDocumentEntry.repositoryUniqueId.</p>
      </li>
      <li>
        <p>A required &lt;ihe:DocumentUniqueId/&gt; that identifies the document within the repository. The value of this element shall be the same as the value of the /RetrieveDocumentSetRequest/DocumentRequest/DocumentUniqueId element in the original Retrieve Document Set Request Message. This value corresponds to XDSDocumentEntry.uniqueId.</p>
      </li>
    </ul>
    <ul>
      <li>
        <blockquote>
          <p>A required &lt;ihe:Document/&gt; element that contains the retrieved document using the xsi:base64Binary data type. (Note: This is the logical representation of the document in the XML. The wire format may be different; see <a href="../Volume2x/ch-22.html#Appendix V.8">ITI TF-2x: Appendix V.8</a>.)</p>
        </blockquote>
      </li>
      <li>
        <blockquote>
          <p>A required &lt;ihe:mimeType/&gt; element that indicates the MIME type of the retrieved document</p>
        </blockquote>
      </li>
      <li>
        <blockquote>
          <p>An optional &lt;ihe:NewDocumentUniqueId/&gt; element that identifies the document returned in the request when retrieval is of an On-Demand Document. This is required when retrieval is of an On-Demand Document.</p>
        </blockquote>
      </li>
      <li>
        <blockquote>
          <p>An optional &lt;ihe:NewRepositoryUniqueId/&gt; element that identifies the Document Repository that will support retrieval of the document created as a result of retrieval of the On-Demand Document. This is required when the On-Demand Document Source supports the Persistence of Retrieved Documents Option.</p>
        </blockquote>
      </li>
    </ul>
    <p>The /RetrieveDocumentSetResponse/rs:RegistryResponse/@status attributes provides the overall status of the request: It shall contain one of the following values:</p>
    <p>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</p>
    <p>urn:ihe:iti:2007:ResponseStatusType:PartialSuccess</p>
    <p>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Failure</p>
    <p>See <a href="../Volume3/ch-1.2.html#4.2.4">ITI TF-3: 4.2.4</a> Error Reporting for the interpretation of these values.</p>
    <p>For each document requested in a /RetrieveDocumentSetRequest/DocumentRequest element:</p>
    <ul>
      <li>
        <p>If a warning is reported when retrieving the document, then a /RetrieveDocumentSetResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be returned with:</p>
      </li>
    </ul>
    <ul>
      <li>
        <p>@severity is urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Warning</p>
      </li>
      <li>
        <p>@errorCode is specified</p>
      </li>
      <li>
        <p>@codeContext contains the warning message</p>
      </li>
      <li>
        <p>@location contains the DocumentUniqueId of the document requested</p>
      </li>
    </ul>
    <ul>
      <li>
        <p>The document shall be returned in an instance of /RetrieveDocumentSetResponse/DocumentResponse/Document as a XOP Infoset. The returned document and warning are correlated via the DocumentUniqueId.</p>
      </li>
      <li>
        <p>If an error is reported when retrieving a document, then a /RetrieveDocumentSetResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be returned with:</p>
      </li>
    </ul>
    <ul>
      <li>
        <p>@severity is urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error</p>
      </li>
      <li>
        <p>@errorCode is specified</p>
      </li>
      <li>
        <p>@codeContext contains the error message</p>
      </li>
      <li>
        <p>@location contains the DocumentUniqueId of the document requested</p>
      </li>
    </ul>
    <ul>
      <li>
        <p>No corresponding RetrieveDocumentSetResponse/DocumentResponse element shall be returned</p>
      </li>
      <li>
        <p>If the document is successfully retrieved (without warning) then no /RetrieveDocumentSetResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be present and a /RetrieveDocumentSetResponse/DocumentResponse/Document element shall be returned containing the document as a XOP Infoset.</p>
      </li>
    </ul>
    <p>The /RetrieveDocumentSetResponse/rs:RegistryResponse/rs:ResponseSlotList element is not used in this transaction.</p>
    <p>The /RetrieveDocumentSetResponse/rs:RegistryResponse/@requestId attribute is not used in this transaction.</p>
    <p>A full XML Schema Document for the XDS.b types is available online on the IHE FTP site, see <a href="../Volume2x/ch-23.html#Appendix W">ITI TF-2x: Appendix W</a>.</p>
    <h4 class="list-paragraph" id="3.43.5.1">3.43.5.1 Sample SOAP Messages</h4>
    <p>The samples in the following two sections show a typical request and its relative response. The sample messages also show the WS-Addressing headers &lt;Action/&gt;, &lt;MessageID/&gt;, &lt;ReplyTo/&gt;…; these WS-Addressing headers are populated according to <a href="../Volume2x/ch-22.html#Appendix V">ITI TF-2x: Appendix V</a>: Web Services for IHE Transactions.</p>
    <h5 class="list-paragraph" id="3.43.5.1.1">3.43.5.1.1 Sample Retrieve Document Set SOAP Request</h5>
    <h6 class="list-paragraph" id="3.43.5.1.1.1">3.43.5.1.1.1 Synchronous Web Services Exchange</h6>
    <p>POST /tf6/services/xdsrepositoryb HTTP/1.1</p>
    <p>Content-Type: multipart/related;</p>
    <p>boundary=MIMEBoundaryurn_uuid_3448B7F8EA6E8B9DFC1289514997517;</p>
    <p>type="application/xop+xml";</p>
    <p>start="&lt;0.urn:uuid:3448B7F8EA6E8B9DFC1289514997518@apache.org&gt;";</p>
    <p>start-info="application/soap+xml"</p>
    <p>User-Agent: Axis2</p>
    <p>Host: ihexds.nist.gov:5000</p>
    <p>--MIMEBoundaryurn_uuid_3448B7F8EA6E8B9DFC1289514997517</p>
    <p>Content-Type: application/xop+xml; charset=UTF-8;</p>
    <p>type="application/soap+xml"</p>
    <p>Content-Transfer-Encoding: binary</p>
    <p>Content-ID: &lt;0.urn:uuid:3448B7F8EA6E8B9DFC1289514997518@apache.org&gt;</p>
    <p>&lt;?xml version='1.0' encoding='UTF-8'?&gt;</p>
    <p>&lt;soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope"&gt;</p>
    <p>&lt;soapenv:Header xmlns:wsa="http://www.w3.org/2005/08/addressing"&gt;</p>
    <p>&lt;wsa:To soapenv:mustUnderstand="1"</p>
    <p>&gt;http://localhost:5000/tf6/services/xdsrepositoryb&lt;/wsa:To&gt;</p>
    <p>&lt;wsa:MessageID soapenv:mustUnderstand="1"</p>
    <p>&gt;urn:uuid:3448B7F8EA6E8B9DFC1289514997508&lt;/wsa:MessageID&gt;</p>
    <p>&lt;wsa:Action soapenv:mustUnderstand="1"</p>
    <p>&gt;urn:ihe:iti:2007:RetrieveDocumentSet&lt;/wsa:Action&gt;</p>
    <p>&lt;/soapenv:Header&gt;</p>
    <p>&lt;soapenv:Body&gt;</p>
    <p>&lt;RetrieveDocumentSetRequest xmlns="urn:ihe:iti:xds-b:2007"&gt;</p>
    <p>&lt;DocumentRequest&gt;</p>
    <p>&lt;RepositoryUniqueId&gt;1.19.6.24.109.42.1.5&lt;/RepositoryUniqueId&gt;</p>
    <p>&lt;DocumentUniqueId&gt;1.42.20101110141555.15&lt;/DocumentUniqueId&gt;</p>
    <p>&lt;/DocumentRequest&gt;</p>
    <p>&lt;/RetrieveDocumentSetRequest&gt;</p>
    <p>&lt;/soapenv:Body&gt;</p>
    <p>&lt;/soapenv:Envelope&gt;</p>
    <p>--MIMEBoundaryurn_uuid_3448B7F8EA6E8B9DFC1289514997517--</p>
    <p>This request message is in MTOM/XOP format because request/response message pairs must always be in the same format (MTOM/XOP vs. SIMPLE SOAP) and the response requires MTOM/XOP: one part for descriptive metadata and a second part for document contents.</p>
    <h6 class="list-paragraph" id="3.43.5.1.1.2">3.43.5.1.1.2 Asynchronous Web Services Exchange</h6>
    <p>&lt;s:Envelope</p>
    <p>xmlns:s="http://www.w3.org/2003/05/soap-envelope"</p>
    <p>xmlns:a="http://www.w3.org/2005/08/addressing"&gt;</p>
    <p>&lt;s:Header&gt;</p>
    <p>&lt;a:Action s:mustUnderstand="1"&gt;urn:ihe:iti:2007:RetrieveDocumentSet&lt;/a:Action&gt;</p>
    <p>&lt;a:MessageID&gt;urn:uuid:0fbfdced-6c01-4d09-a110-2201afedaa02&lt;/a:MessageID&gt;</p>
    <p>&lt;a:ReplyTo&gt;</p>
    <p>&lt;a:Address&gt; http://192.168.2.4:9080/XdsService/DocumentConsumerReceiver.svc&lt;/a:Address&gt;</p>
    <p>&lt;/a:ReplyTo&gt;</p>
    <p>&lt;a:To s:mustUnderstand="1"&gt;http://localhost:2647/XdsService/DocumentRepositoryReceiver.svc&lt;/a:To&gt;</p>
    <p>&lt;/s:Header&gt;</p>
    <p>&lt;s:Body&gt;</p>
    <p>&lt;RetrieveDocumentSetRequest xmlns="urn:ihe:iti:xds-b:2007"&gt;</p>
    <p>&lt;DocumentRequest&gt;</p>
    <p>&lt;RepositoryUniqueId&gt;1.3.6.1.4...1000&lt;/RepositoryUniqueId&gt;</p>
    <p>&lt;DocumentUniqueId&gt;1.3.6.1.4...2300&lt;/DocumentUniqueId&gt;</p>
    <p>&lt;/DocumentRequest&gt;</p>
    <p>&lt;DocumentRequest&gt;</p>
    <p>&lt;RepositoryUniqueId&gt;1.3.6.1.4...1000&lt;/RepositoryUniqueId&gt;</p>
    <p>&lt;DocumentUniqueId&gt;1.3.6.1.4...2301&lt;/DocumentUniqueId&gt;</p>
    <p>&lt;/DocumentRequest&gt;</p>
    <p>&lt;/RetrieveDocumentSetRequest&gt;</p>
    <p>&lt;/s:Body&gt;</p>
    <p>&lt;/s:Envelope&gt;</p>
    <h5 class="list-paragraph" id="3.43.5.1.2">3.43.5.1.2 Sample Retrieve Document Set SOAP Response</h5>
    <h6 class="list-paragraph" id="3.43.5.1.2.1">3.43.5.1.2.1 Synchronous Web Services Exchange</h6>
    <p>In the following example, the HTTP header Transfer-Encoding: chunked and the corresponding chunk annotations were removed for readability.</p>
    <p>HTTP/1.1 200 OK</p>
    <p>Server: Apache-Coyote/1.1</p>
    <p>Content-Type: multipart/related;</p>
    <p>boundary=MIMEBoundaryurn_uuid_E910375860336E2B8F1289514978310;</p>
    <p>type="application/xop+xml";</p>
    <p>start="0.urn:uuid:E910375860336E2B8F1289514978311@apache.org";</p>
    <p>start-info="application/soap+xml";</p>
    <p>Date: Thu, 11 Nov 2010 22:36:15 GMT</p>
    <p>--MIMEBoundaryurn_uuid_E910375860336E2B8F1289514978310</p>
    <p>Content-Type: application/xop+xml; charset=UTF-8;</p>
    <p>type="application/soap+xml"</p>
    <p>Content-Transfer-Encoding: binary</p>
    <p>Content-ID: &lt;0.urn:uuid:E910375860336E2B8F1289514978311@apache.org&gt;</p>
    <p>&lt;?xml version='1.0' encoding='UTF-8'?&gt;</p>
    <p>&lt;soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope"</p>
    <p>xmlns:wsa="http://www.w3.org/2005/08/addressing"&gt;</p>
    <p>&lt;soapenv:Header&gt;</p>
    <p>&lt;wsa:Action soapenv:mustUnderstand="1"</p>
    <p>&gt;urn:ihe:iti:2007:RetrieveDocumentSetResponse&lt;/wsa:Action&gt;</p>
    <p>&lt;wsa:RelatesTo&gt;urn:uuid:3448B7F8EA6E8B9DFC1289514997508&lt;/wsa:RelatesTo&gt;</p>
    <p>&lt;/soapenv:Header&gt;</p>
    <p>&lt;soapenv:Body&gt;</p>
    <p>&lt;xdsb:RetrieveDocumentSetResponse xmlns:xdsb="urn:ihe:iti:xds-b:2007"&gt;</p>
    <p>&lt;rs:RegistryResponse xmlns:rs="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0"</p>
    <p>status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success"/&gt;</p>
    <p>&lt;xdsb:DocumentResponse&gt;</p>
    <p>&lt;xdsb:RepositoryUniqueId</p>
    <p>&gt;1.19.6.24.109.42.1.5&lt;/xdsb:RepositoryUniqueId&gt;</p>
    <p>&lt;xdsb:DocumentUniqueId</p>
    <p>&gt;1.42.20101110141555.15&lt;/xdsb:DocumentUniqueId&gt;</p>
    <p>&lt;xdsb:mimeType&gt;text/plain&lt;/xdsb:mimeType&gt;</p>
    <p>&lt;xdsb:Document&gt;</p>
    <p>&lt;xop:Include</p>
    <p>href="cid:1.urn:uuid:E910375860336E2B8F1289514978312@apache.org"</p>
    <p>xmlns:xop="http://www.w3.org/2004/08/xop/include"/&gt;</p>
    <p>&lt;/xdsb:Document&gt;</p>
    <p>&lt;/xdsb:DocumentResponse&gt;</p>
    <p>&lt;/xdsb:RetrieveDocumentSetResponse&gt;</p>
    <p>&lt;/soapenv:Body&gt;</p>
    <p>&lt;/soapenv:Envelope&gt;</p>
    <p>--MIMEBoundaryurn_uuid_E910375860336E2B8F1289514978310</p>
    <p>Content-Type: text/plain</p>
    <p>Content-Transfer-Encoding: binary</p>
    <p>Content-ID: &lt;1.urn:uuid:E910375860336E2B8F1289514978312@apache.org&gt;</p>
    <p>Four score and seven years ago our fathers brought forth on this continent a new nation, conceived in Liberty, and dedicated to the proposition that all men are created equal.</p>
    <p>--MIMEBoundaryurn_uuid_E910375860336E2B8F1289514978310--</p>
    <p>This example shows the ‘wire format’ for MTOM/XOP. The Document element contains a &lt;xop:Include&gt; element that points to the document contents as a separate attachment.</p>
    <p>Note: In some systems, the ‘in memory’ format replaces the &lt;xop:Include&gt; with the Base64 encoded contents of the document. This is done so the entire message contents fits into an XML parse tree.</p>
    <p>A second form of the response is possible, an un-optimized MTOM/XOP message. In this form the message is still formatted as a multipart but the document contents is not split out into a separate part of the multipart. Some popular Web Service toolkits generate this form for very small documents. The same response in this form looks like:</p>
    <p>HTTP/1.1 200 OK</p>
    <p>Server: Apache-Coyote/1.1</p>
    <p>Content-Type: multipart/related;</p>
    <p>boundary=MIMEBoundaryurn_uuid_E910375860336E2B8F1289514978310;</p>
    <p>type="application/xop+xml";</p>
    <p>start="0.urn:uuid:E910375860336E2B8F1289514978311@apache.org";</p>
    <p>start-info="application/soap+xml";</p>
    <p>Date: Thu, 11 Nov 2010 22:36:15 GMT</p>
    <p>--MIMEBoundaryurn_uuid_E910375860336E2B8F1289514978310</p>
    <p>Content-Type: application/xop+xml; charset=UTF-8;</p>
    <p>type="application/soap+xml"</p>
    <p>Content-Transfer-Encoding: binary</p>
    <p>Content-ID: &lt;0.urn:uuid:E910375860336E2B8F1289514978311@apache.org&gt;</p>
    <p>&lt;?xml version='1.0' encoding='UTF-8'?&gt;</p>
    <p>&lt;soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope"</p>
    <p>xmlns:wsa="http://www.w3.org/2005/08/addressing"&gt;</p>
    <p>&lt;soapenv:Header&gt;</p>
    <p>&lt;wsa:Action soapenv:mustUnderstand="1"</p>
    <p>&gt;urn:ihe:iti:2007:RetrieveDocumentSetResponse&lt;/wsa:Action&gt;</p>
    <p>&lt;wsa:RelatesTo&gt;urn:uuid:3448B7F8EA6E8B9DFC1289514997508&lt;/wsa:RelatesTo&gt;</p>
    <p>&lt;/soapenv:Header&gt;</p>
    <p>&lt;soapenv:Body&gt;</p>
    <p>&lt;xdsb:RetrieveDocumentSetResponse xmlns:xdsb="urn:ihe:iti:xds-b:2007"&gt;</p>
    <p>&lt;rs:RegistryResponse</p>
    <p>xmlns:rs="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0"</p>
    <p>status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success"/&gt;</p>
    <p>&lt;xdsb:DocumentResponse&gt;</p>
    <p>&lt;xdsb:RepositoryUniqueId</p>
    <p>&gt;1.19.6.24.109.42.1.5&lt;/xdsb:RepositoryUniqueId&gt;</p>
    <p>&lt;xdsb:DocumentUniqueId</p>
    <p>&gt;1.42.20101110141555.15&lt;/xdsb:DocumentUniqueId&gt;</p>
    <p>&lt;xdsb:mimeType&gt;text/plain&lt;/xdsb:mimeType&gt;</p>
    <p>&lt;xdsb:Document&gt;</p>
    <p>Base64 encoded contents of document go here</p>
    <p>&lt;/xdsb:Document&gt;</p>
    <p>&lt;/xdsb:DocumentResponse&gt;</p>
    <p>&lt;/xdsb:RetrieveDocumentSetResponse&gt;</p>
    <p>&lt;/soapenv:Body&gt;</p>
    <p>&lt;/soapenv:Envelope&gt;</p>
    <p>--MIMEBoundaryurn_uuid_E910375860336E2B8F1289514978310--</p>
    <h6 class="list-paragraph" id="3.43.5.1.2.2">3.43.5.1.2.2 Asynchronous Web Services Exchange</h6>
    <p>&lt;s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://www.w3.org/2005/08/addressing"&gt;</p>
    <p>&lt;s:Header&gt;</p>
    <p>&lt;a:Action s:mustUnderstand="1"&gt;urn:ihe:iti:2007:RetrieveDocumentSetResponse&lt;/a:Action&gt;</p>
    <blockquote>
      <p>&lt;a:MessageID&gt;urn:uuid:D6C21225-8E7B-454E-9750-821622C099DB&lt;/a:MessageID&gt;</p>
    </blockquote>
    <p>&lt;a:RelatesTo&gt;urn:uuid:0fbfdced-6c01-4d09-a110-2201afedaa02&lt;/a:RelatesTo&gt;</p>
    <p>&lt;a:To s:mustUnderstand="1"&gt;http://localhost:2647/XdsService/DocumentConsumerReceiver.svc&lt;/a:To&gt;</p>
    <p>&lt;/s:Header&gt;</p>
    <p>&lt;s:Body&gt;</p>
    <p>&lt;RetrieveDocumentSetResponse</p>
    <p>xmlns="urn:ihe:iti:xds-b:2007"</p>
    <p>xmlns:lcm="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0"</p>
    <p>xmlns:query="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0"</p>
    <p>xmlns:rim="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0"</p>
    <p>xmlns:rs="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0"&gt;</p>
    <p>&lt;rs:RegistryResponse status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success"/&gt;</p>
    <p>&lt;DocumentResponse&gt;</p>
    <p>&lt;RepositoryUniqueId&gt;1.3.6.1.4...1000&lt;/RepositoryUniqueId&gt;</p>
    <p>&lt;DocumentUniqueId&gt;1.3.6.1.4...2300&lt;/DocumentUniqueId&gt;</p>
    <p>&lt;mimeType&gt;text/xml&lt;/mimeType&gt;</p>
    <p>&lt;Document&gt;UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi&lt;/Document&gt;</p>
    <p>&lt;/DocumentResponse&gt;</p>
    <p>&lt;DocumentResponse&gt;</p>
    <p>&lt;RepositoryUniqueId&gt;1.3.6.1.4...1000&lt;/RepositoryUniqueId&gt;</p>
    <p>&lt;DocumentUniqueId&gt;1.3.6.1.4...2300&lt;/DocumentUniqueId&gt;</p>
    <p>&lt;mimeType&gt;text/xml&lt;/mimeType&gt;</p>
    <p>&lt;Document&gt;UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi&lt;/Document&gt;</p>
    <p>&lt;/DocumentResponse&gt;</p>
    <p>&lt;/RetrieveDocumentSetResponse&gt;</p>
    <p>&lt;/s:Body&gt;</p>
    <p>&lt;/s:Envelope&gt;</p>
    <h5 class="list-paragraph" id="3.43.5.1.3">3.43.5.1.3 Sample Retrieve Document Set Response from On-Demand Document Entry</h5>
    <p>The following example shows the response to retrieval of a dynamic document entry where the responder supports later retrieval of the document created.</p>
    <p>&lt;s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://www.w3.org/2005/08/addressing"&gt;</p>
    <p>&lt;s:Header&gt;</p>
    <p>&lt;a:Action s:mustUnderstand="1"&gt;urn:ihe:iti:2007:RetrieveDocumentSetResponse&lt;/a:Action&gt;</p>
    <p>&lt;a:RelatesTo&gt;urn:uuid:0fbfdced-6c01-4d09-a110-2201afedaa02&lt;/a:RelatesTo&gt;</p>
    <p>&lt;/s:Header&gt;</p>
    <p>&lt;s:Body&gt;</p>
    <p>&lt;RetrieveDocumentSetResponse</p>
    <p>xmlns="urn:ihe:iti:xds-b:2007"</p>
    <p>xmlns:lcm="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0"</p>
    <p>xmlns:query="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0"</p>
    <p>xmlns:rim="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0"</p>
    <p>xmlns:rs="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0"&gt;</p>
    <p>&lt;rs:RegistryResponse status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success"/&gt;</p>
    <p>&lt;DocumentResponse&gt;</p>
    <p>&lt;RepositoryUniqueId&gt;1.3.6.1.4...1000&lt;/RepositoryUniqueId&gt;</p>
    <p>&lt;DocumentUniqueId&gt;1.3.6.1.4...2300&lt;/DocumentUniqueId&gt;</p>
    <p>&lt;NewDocumentUniqueId&gt;1.3.6.1.4...2897&lt;/NewDocumentUniqueId&gt;</p>
    <p>&lt;NewRepositoryUniqueId&gt;1.3.6.1.4...1000&lt;/NewRepositoryUniqueId&gt;</p>
    <p>&lt;mimeType&gt;text/xml&lt;/mimeType&gt;</p>
    <p>&lt;Document&gt;UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi&lt;/Document&gt;</p>
    <p>&lt;/DocumentResponse&gt;</p>
    <p>&lt;DocumentResponse&gt;</p>
    <p>&lt;RepositoryUniqueId&gt;1.3.6.1.4...1000&lt;/RepositoryUniqueId&gt;</p>
    <p>&lt;DocumentUniqueId&gt;1.3.6.1.4...2300&lt;/DocumentUniqueId&gt;</p>
    <p>&lt;mimeType&gt;text/xml&lt;/mimeType&gt;</p>
    <p>&lt;Document&gt;UjBsR09EbGhjZ0dTQUxNQUFBUUNBRU1tQ1p0dU1GUXhEUzhi&lt;/Document&gt;</p>
    <p>&lt;/DocumentResponse&gt;</p>
    <p>&lt;/RetrieveDocumentSetResponse&gt;</p>
    <p>&lt;/s:Body&gt;</p>
    <p>&lt;/s:Envelope&gt;</p>
    <h3 class="list-paragraph" id="3.43.6">3.43.6 Security Considerations</h3>
    <p>Relevant XDS Affinity Domain Security background is discussed in the XDS Security Considerations Section (see <a href="../Volume1/ch-10.html#10.7">ITI TF-1: 10.7</a>).</p>
    <h4 class="list-paragraph" id="3.43.6.1">3.43.6.1 Audit Record Considerations</h4>
    <p>The Retrieve Document Set transaction is either a PHI-Import event or a PHI-Export event, depending on the actor, as defined in ITI TF-2a: Table 3.20.4.1.1.1-1, with the following exceptions.</p>
    <p>The Document Repository Actor, On-Demand Document Source, and Initiating Gateway shall generate an “Export” event. This may be an event for each Retrieve Document transaction, or multiple transactions for the same patient may be heuristically combined. The heuristics for this combination are not specified by IHE. It is intended to reduce the volume of audit records. Combination is permitted when the active participants and patient are the same, and the time difference is considered insignificant.</p>
    <p>The Document Consumer shall generate an “Import” event. This may be one event per transaction, or multiple transactions may be reported as a single event using a heuristic for combining transactions. Combination is permitted when the active participants and patient are the same, and the time difference is considered insignificant.</p>
    <p>If some documents were retrieved successfully and others were not, the Actors involved shall record a “success” audit event for those documents retrieved successfully and a “failure” audit event for those documents not retrieved successfully.</p>
    <h5 class="list-paragraph" id="3.43.6.1.1">3.43.6.1.1 Document Consumer audit message:</h5>
    <table>
      <tbody>
        <tr class="odd">
          <td />
          <td>Field Name</td>
          <td>Opt</td>
          <td>Value Constraints</td>
        </tr>
        <tr class="even">
          <td>
            <p>Event</p>
            <p>
              AuditMessage/
              <br />
              EventIdentification
            </p>
          </td>
          <td>EventID</td>
          <td>M</td>
          <td>EV(110107, DCM, “Import”)</td>
        </tr>
        <tr class="odd">
          <td />
          <td>EventActionCode</td>
          <td>M</td>
          <td>“C” (Create)</td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>EventDateTime</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>EventOutcomeIndicator</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>EventTypeCode</td>
          <td>M</td>
          <td>EV(“ITI-43”, “IHE Transactions”, “Retrieve Document Set”)</td>
        </tr>
        <tr class="odd">
          <td>Source (Document Repository) (1)</td>
          <td />
          <td />
          <td />
        </tr>
        <tr class="even">
          <td>Destination (Document Consumer) (1)</td>
          <td />
          <td />
          <td />
        </tr>
        <tr class="odd">
          <td>Human Requestor (0..n)</td>
          <td />
          <td />
          <td />
        </tr>
        <tr class="even">
          <td>Audit Source (Document Consumer) (1)</td>
          <td />
          <td />
          <td />
        </tr>
        <tr class="odd">
          <td>Patient (0..1)</td>
          <td />
          <td />
          <td />
        </tr>
        <tr class="even">
          <td>
            Document (1..n)
            <em>(see combining rules above)</em>
          </td>
          <td />
          <td />
          <td />
        </tr>
      </tbody>
    </table>
    <p>Where:</p>
    <table>
      <tbody>
        <tr class="odd">
          <td>
            <p>Source</p>
            <p>
              AuditMessage/
              <br />
              ActiveParticipant
            </p>
          </td>
          <td>UserID</td>
          <td>M</td>
          <td>SOAP endpoint URI</td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>AlternativeUserID</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>UserName</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>UserIsRequestor</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>“false”</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>RoleIDCode</td>
          <td>M</td>
          <td>EV(110153, DCM, “Source”)</td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>NetworkAccessPointTypeCode</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>“1” for machine (DNS) name, “2” for IP address</td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>NetworkAccessPointID</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>The machine name or IP address.</td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr class="odd">
          <td>
            <p>Destination</p>
            <p>
              AuditMessage/
              <br />
              ActiveParticipant
            </p>
          </td>
          <td>UserID</td>
          <td>M</td>
          <td>If Asynchronous Web Services Exchange is being used, the content of the &lt;wsa:ReplyTo/&gt; element. Otherwise, not specialized.</td>
        </tr>
        <tr class="even">
          <td />
          <td>AlternativeUserID</td>
          <td>M</td>
          <td>the process ID as used within the local operating system in the local system logs.</td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>UserName</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>UserIsRequestor</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>RoleIDCode</td>
          <td>M</td>
          <td>EV(110152, DCM, “Destination”)</td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>NetworkAccessPointTypeCode</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>“1” for machine (DNS) name, “2” for IP address</td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>NetworkAccessPointID</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>The machine name or IP address.</td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr class="odd">
          <td>
            <p>Human Requestor (if known)</p>
            <p>
              AuditMessage/
              <br />
              ActiveParticipant
            </p>
          </td>
          <td>UserID</td>
          <td>M</td>
          <td>Identity of the human that initiated the transaction.</td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>AlternativeUserID</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>UserName</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>UserIsRequestor</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>RoleIDCode</td>
          <td>U</td>
          <td>Access Control role(s) the user holds that allows this transaction.</td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>NetworkAccessPointTypeCode</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>NetworkAccessPointID</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr class="odd">
          <td>
            <p>Audit Source</p>
            <p>
              AuditMessage/
              <br />
              AuditSourceIdentification
            </p>
          </td>
          <td>
            <em>AuditSourceID</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>AuditEnterpriseSiteID</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>AuditSourceTypeCode</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr class="odd">
          <td>
            <p>Patient</p>
            <p>(if-known)</p>
            <p>
              (AuditMessage/
              <br />
              ParticipantObjectIdentification)
            </p>
          </td>
          <td>ParticipantObjectTypeCode</td>
          <td>M</td>
          <td>“1” (Person)</td>
        </tr>
        <tr class="even">
          <td />
          <td>ParticipantObjectTypeCodeRole</td>
          <td>M</td>
          <td>“1” (Patient)</td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>ParticipantObjectDataLifeCycle</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>ParticipantObjectIDTypeCode</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>ParticipantObjectSensitivity</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>ParticipantObjectID</td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>The patient ID in HL7 CX format.</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>ParticipantObjectName</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>ParticipantObjectQuery</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>ParticipantObjectDetail</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr class="odd">
          <td>
            <p>Document</p>
            <p>
              (AuditMessage/
              <br />
              ParticipantObjectIdentification)
            </p>
          </td>
          <td>ParticipantObjectTypeCode</td>
          <td>M</td>
          <td>“2” (System)</td>
        </tr>
        <tr class="even">
          <td />
          <td>ParticipantObjectTypeCodeRole</td>
          <td>M</td>
          <td>“3” (report)</td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>ParticipantObjectDataLifeCycle</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>ParticipantObjectIDTypeCode</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>ParticipantObjectSensitivity</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>ParticipantObjectID</td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>The value of &lt;ihe:DocumentUniqueId/&gt;</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>ParticipantObjectName</em>
          </td>
          <td>C</td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>ParticipantObjectQuery</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>ParticipantObjectDetail</td>
          <td>
            <em>M</em>
          </td>
          <td>
            <p>The ParticipantObjectDetail element may occur more than once.</p>
            <p>
              <em>In one element, the value of &lt;ihe:RepositoryUniqueId/&gt; in value attribute, “Repository Unique Id” in type attribute</em>
            </p>
            <p>
              In another element, the value of “ihe:homeCommunityID” as the value of the attribute
              <em>type</em>
              and the value of the homeCommunityID as the value of the attribute
              <em>value</em>
            </p>
          </td>
        </tr>
      </tbody>
    </table>
    <h5 class="list-paragraph" id="3.43.6.1.2">3.43.6.1.2 Document Repository, On-Demand Document Source, and Initiating Gateway audit message:</h5>
    <table>
      <tbody>
        <tr class="odd">
          <td />
          <td>Field Name</td>
          <td>Opt</td>
          <td>Value Constraints</td>
        </tr>
        <tr class="even">
          <td>
            <p>Event</p>
            <p>
              AuditMessage/
              <br />
              EventIdentification
            </p>
          </td>
          <td>EventID</td>
          <td>M</td>
          <td>EV(110106, DCM, “Export”)</td>
        </tr>
        <tr class="odd">
          <td />
          <td>EventActionCode</td>
          <td>M</td>
          <td>“R” (Read)</td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>EventDateTime</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>EventOutcomeIndicator</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>EventTypeCode</td>
          <td>M</td>
          <td>EV(“ITI-43”, “IHE Transactions”, “Retrieve Document Set”)</td>
        </tr>
        <tr class="odd">
          <td>Source (Document Repository) (1)</td>
          <td />
          <td />
          <td />
        </tr>
        <tr class="even">
          <td>Destination (Document Consumer) (1)</td>
          <td />
          <td />
          <td />
        </tr>
        <tr class="odd">
          <td>Audit Source (Document Repository) (1)</td>
          <td />
          <td />
          <td />
        </tr>
        <tr class="even">
          <td>
            Document (1..n)
            <em>(see combining rules above)</em>
          </td>
          <td />
          <td />
          <td />
        </tr>
      </tbody>
    </table>
    <p>Where:</p>
    <table>
      <tbody>
        <tr class="odd">
          <td>
            <p>Source</p>
            <p>
              AuditMessage/
              <br />
              ActiveParticipant
            </p>
          </td>
          <td>UserID</td>
          <td>M</td>
          <td>SOAP endpoint URI</td>
        </tr>
        <tr class="even">
          <td />
          <td>AlternativeUserID</td>
          <td>M</td>
          <td>the process ID as used within the local operating system in the local system logs.</td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>UserName</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>UserIsRequestor</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>“false”</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>RoleIDCode</td>
          <td>M</td>
          <td>EV(110153, DCM, “Source”)</td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>NetworkAccessPointTypeCode</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>“1” for machine (DNS) name, “2” for IP address</td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>NetworkAccessPointID</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>The machine name or IP address.</td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr class="odd">
          <td>
            <p>Destination</p>
            <p>
              AuditMessage/
              <br />
              ActiveParticipant
            </p>
          </td>
          <td>UserID</td>
          <td>M</td>
          <td>If Asynchronous Web Services Exchange is being used, the content of the &lt;wsa:ReplyTo/&gt; element. Otherwise, not specialized.</td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>AlternativeUserID</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>UserName</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>UserIsRequestor</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>RoleIDCode</td>
          <td>M</td>
          <td>EV(110152, DCM, “Destination”)</td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>NetworkAccessPointTypeCode</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>“1” for machine (DNS) name, “2” for IP address</td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>NetworkAccessPointID</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>The machine name or IP address.</td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr class="odd">
          <td>
            <p>Audit Source</p>
            <p>
              AuditMessage/
              <br />
              AuditSourceIdentification
            </p>
          </td>
          <td>
            <em>AuditSourceID</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>AuditEnterpriseSiteID</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>AuditSourceTypeCode</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr class="odd">
          <td>
            <p>Document URI</p>
            <p>
              (AuditMessage/
              <br />
              ParticipantObjectIdentification)
            </p>
          </td>
          <td>ParticipantObjectTypeCode</td>
          <td>M</td>
          <td>“2” (System)</td>
        </tr>
        <tr class="even">
          <td />
          <td>ParticipantObjectTypeCodeRole</td>
          <td>M</td>
          <td>“3” (report)</td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>ParticipantObjectDataLifeCycle</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>ParticipantObjectIDTypeCode</em>
          </td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>ParticipantObjectSensitivity</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>ParticipantObjectID</td>
          <td>
            <em>M</em>
          </td>
          <td>
            <em>The value of &lt;ihe:DocumentUniqueId/&gt;</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>
            <em>ParticipantObjectName</em>
          </td>
          <td>C</td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="even">
          <td />
          <td>
            <em>ParticipantObjectQuery</em>
          </td>
          <td>
            <em>U</em>
          </td>
          <td>
            <em>not specialized</em>
          </td>
        </tr>
        <tr class="odd">
          <td />
          <td>ParticipantObjectDetail</td>
          <td>M</td>
          <td>
            <p>The ParticipantObjectDetail element may occur more than once.</p>
            <p>
              <em>In one element, the value of &lt;ihe:RepositoryUniqueId/&gt; in value attribute, “Repository Unique Id” in type attribute</em>
            </p>
            <p>
              In another element, the value of “ihe:homeCommunityID” as the value of the attribute
              <em>type</em>
              and the value of the homeCommunityID as the value of the attribute
              <em>value</em>
            </p>
          </td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
