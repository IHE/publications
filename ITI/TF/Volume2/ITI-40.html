<html xmlns="http://www.w3.org/1999/xhtml" lang="en_US">

<head>
  <meta xmlns="" charset="utf-8" />
  <title xmlns="">IHE ITI TF Rev17 Vol2</title>
  <link xmlns="" rel="stylesheet" href="../css/styles.css" />
</head>

<body xmlns="">
  <header>
    <p>
      <img src="../../../IHE_INTERNATIONAL.png" class="IHE logo" alt="IHE logo" />
    </p>
    <p>IHE IT Infrastructure (ITI) Technical Framework, Volume 2</p>
    <p class="trialImplementation">Trial Implementation</p>
    <a href="..\index.html">up</a>
    <p>
      <hr />
    </p>
  </header>
  <main>
    <h2 id="3.40">3.40 Provide X-User Assertion [ITI-40]</h2>
    <p>This section corresponds to transaction [ITI-40] of the IHE IT Infrastructure Technical Framework.</p>
    <h3 id="3.40.1">3.40.1 Scope</h3>
    <p>Transaction [ITI-40] is used by the <b>X-Service User</b> to pass a claimed identity assertion to the <b>X-Service Provider</b>.
      The <b>X-Service User</b> and <b>X-Service Provider</b> use the <b>X-Assertion Provider</b> as the third party issuer of the
      claimed identity assertion.
    </p>
    <h3 id="3.40.2">3.40.2 Use Case Roles</h3>
    <!--      <img src="media/ai8zh-w242m.031.jpeg" width="297" height="239" alt="XUA_UseCaseRoles_03" />  -->
    <p>
      <b>   Actor:</b> X-Service User
    </p>
    <p>
      <b>   Role:</b> User of a transaction that requires a Cross-Enterprise User Assertion
    </p>
    <p>
      <b>   Actor:</b> X-Service Provider
    </p>
    <p>
      <b>   Role:</b> Service provider on a transaction that requires a Cross-Enterprise User Assertion
    </p>
    <h3 id="3.40.3">3.40.3 Referenced Standards</h3>
    <h4 id="3.40.3.1">3.40.3.1 Normative -- required to use this transaction</h4>
    <ul>
      <li class="bullet-list1">
        <span>OASIS</span>
        <a href="http://www.oasis-open.org/committees/security/">http://www.oasis-open.org/committees/security/</a>
        <span>.</span>
      </li>
      <li class="bullet-list1">
        <a href="http://docs.oasis-open.org/security/saml/v2.0/saml-core-2.0-os.pdf">SAMLCore</a>
        <span>SAML V2.0 Core standard</span>
      </li>
      <li class="bullet-list1">
        <a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">WSS10</a>
        <span>OASIS Standard, "OASIS Web Services Security: SOAP Message Security 1.0 (WS-Security 2004)", March 2004.</span>
      </li>
      <li class="bullet-list1">
        <a href="http://www.oasis-open.org/committees/download.php/16790/wss-v1.1-spec-os-SOAPMessageSecurity.pdf">WSS11</a>
        <span>OASIS Standard, "OASIS Web Services Security: SOAP Message Security 1.1 (WS-Security 2004)", February 2006.</span>
      </li>
      <li class="bullet-list1">
        <a href="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0.pdf">WSS:SAMLTokenProfile1.0</a>
        <span>OASIS Standard, “Web Services Security: SAML Token Profile”, December 2004</span>
      </li>
      <li class="bullet-list1">
        <a href="http://www.oasis-open.org/committees/download.php/16768/wss-v1.1-spec-os-SAMLTokenProfile.pdf">WSS:SAMLTokenProfile1.1</a>
        <span>OASIS Standard, “Web Services Security: SAML Token Profile 1.1”, February 2006</span>
      </li>
      <li class="bullet-list1">XSPA-SAMLv1.0 OASIS Standard, “Cross-Enterprise Security and Privacy Authorization (XSPA) Profile of the Security Assertion Markup Language (SAML) for Healthcare v1.0” , November 2009</li>
      <li class="bullet-list1">SAML 2.0 Profile For XACML 2.0 OASIS Standard, February 2005</li>
    </ul>
    <h4 id="3.40.3.2">3.40.3.2 Informative -- assist with understanding or implementing this transaction</h4>
    <ul>
      <li class="bullet-list1">IHE Profiles</li>
    </ul>
    <ul>
      <li class="bullet-list2">
        <a href="../Volume1/ch-11.html">Personnel White Pages</a>
        <span>Profile</span>
      </li>
      <li class="bullet-list2">
        <a href="../Volume1/ch-4.html">Enterprise User Authentication</a>
        <span>Profile</span>
      </li>
      <li class="bullet-list2">
        <a href="../Volume1/ch-19.html">Basic Patient Privacy Consents</a>
        <span>Profile</span>
      </li>
    </ul>
    <ul>
      <li class="bullet-list1">OASIS</li>
    </ul>
    <ul>
      <li class="bullet-list2">SAML V2.0 Standards http://www.oasis-open.org/committees/security/.</li>
      <li class="bullet-list2">SAML V2.0 Technical Overview</li>
      <li class="bullet-list2">SAML Executive Overview</li>
      <li class="bullet-list2">SAML Tutorial presentation by Eve Maler of Sun Microsystems</li>
      <li class="bullet-list2">SAML Specifications</li>
      <li class="bullet-list2">WS-Trust - OASIS Web Services Secure Exchange (WS-SX) TC</li>
      <li class="bullet-list2">XSPA-XACMLv1.0 OASIS Standard, “Cross-Enterprise Security and Privacy Authorization (XSPA) Profile of XACML v2.0 for Healthcare v1.0” , November 2009</li>
    </ul>
    <h3 id="3.40.4">3.40.4 Messages</h3>
    <img src="media/ai8zh-w242m.032.jpeg" width="624" height="332" alt="800px-XUA_InteractionDiagram_03" />
    <p class="figureTitle">Figure 3.40.4-1: X-User Assertion Messages</p>
    <h4 id="3.40.4.1">3.40.4.1 Provide X-User Assertion</h4>
    <p>The Provide X-User Assertion is profiled to assure interoperability between an X-Service User and an X-Service Provider that need an Assertion about the entity requesting the service. There are many ways to provide an Assertion that are all
      acceptable and may be used by parties that have agreed to their use.</p>
    <p>The Provide X-User Assertion transaction sets some minimal interoperability profiling for this use-case. The Provide X-User Assertion transaction shall be used when there is no other agreed upon policy that would assure User Assertion
      interoperability (e.g., WS-SecurityPolicy).</p>
    <h5 id="3.40.4.1.1">3.40.4.1.1 Trigger</h5>
    <p>Configuration of the X-Service Provider and X-Service User indicates when the X-User Assertion transaction is necessary.</p>
    <h5 id="3.40.4.1.2">3.40.4.1.2 Message Semantics</h5>
    <p>The X-User Assertion must be protected at all times against confidentiality exposure, malicious modification, and trust relationship between those communicating it. The IHE actors that are grouped with XUA may already require the ATNA Profile
      and thus TLS Mutual-Authentication, Integrity, and Confidentiality.</p>
    <p>The X-Service User shall include the OASIS Web Services Security (WSS) Header, and shall include a SAML 2.0 Assertion as the security token.</p>
    <p>Any ATNA Audit Messages that the X-Service User records in relationship to a transaction protected by the XUA (e.g., XDS.b Registry Stored Query, and XDS.b Retrieve Document Set), shall have the user identity recorded according to the XUA
      specific ATNA encoding rules (see Section 3.40.4.2 ATNA Audit encoding). This assures that the X-Service User and X-Service Provider ATNA Audit messages can be correlated at the ATNA Audit Record Repository.</p>
    <p>Any ATNA Audit Messages recorded by actor grouped with the X-Service User Actor, shall have the user identity recorded according to the XUA specific ATNA encoding rules (see Section 3.40.4.2 ATNA Audit encoding). For example: The XDS.b
      Document Consumer records the Query event, this event record will include the identity provided in the XUA Identity Assertion. This assures that the X-Service User and X-Service Provider ATNA Audit messages can be correlated at the ATNA Audit
      Record Repository.</p>
    <p>The SAML 2.0 Assertion is profiled as follows : </p>
    <ul>
      <li class="bullet-list1">The Assertion shall contain a <span class="XMLname">Subject</span>. The Subject contains the logical identifier of the principal performing the original service request (person, application, etc.) and remains unchanged
        through operations acting on the assertion (e.g., proxying the Assertion).
      </li>
    </ul>
    <ul>
      <li class="bullet-list2">
        <span>The</span>
        <span class="XMLname">Subject</span>
        <span>shall contain a</span>
        <span class="XMLname">SubjectConfirmation</span>
        <span>element. The bearer confirmation method shall be supported; the holder-of-key method may be supported. These methods are defined in the SAML 2.0 Profile specification, Section 3.</span>
      </li>
    </ul>
    <ul>
      <li class="bullet-list1">
        <span>The SAML Assertion</span>
        <span class="XMLname">Conditions</span>
        <span>are profiled as:</span>
      </li>
    </ul>
    <ul>
      <li class="bullet-list2">
        <span class="XMLname">NotBefore</span>
        <span>shall be populated with the issue instant of the Assertion</span>
      </li>
      <li class="bullet-list2">
        <span class="XMLname">NotOnOrAfter</span>
        <span>is not specified by XUA because reasonable time limits are not clear at the IHE Profile level. The Expiration is provided by the X-Assertion Provider and would be variable on an Affinity Domain and/or System level.</span>
      </li>
      <li class="bullet-list2">
        <span>The assertion shall contain an</span>
        <span class="XMLname">AudienceRestriction</span>
        <span>containing an</span>
        <span class="XMLname">Audience</span>
        <span>whose value is a URI identifying the X-Service Provider (e.g., XDS Registry, XDS Repository). It may contain an Audience whose value is a URI identifying the Affinity Domain.</span>
      </li>
      <li class="bullet-list2">
        <span>The Assertion may contain</span>
        <span class="XMLname">ProxyRestriction</span>
        <span>and</span>
        <span class="XMLname">OneTimeUser</span>
        <span>conditions but XUA actors may ignore these conditions.</span>
      </li>
    </ul>
    <ul>
      <li class="bullet-list1">The Assertion shall contain an AuthnStatement specify the AuthnContextClassRef or AuthnContextDeclRef</li>
      <li class="bullet-list1">The Assertion may contain other statements (e.g., Attributes). The SAML specification allows for multiple AttributeStatements, and multiple Attributes within each AttributeStatement. Repetition at both levels is
        allowed; recipients shall support repetition at both levels. The AttributeStatement element describes a statement by the SAML authority asserting that the requesting user is associated with the specified attributes. All Attributes defined in
        this transaction can have multiple values within an Assertion, unless otherwise noted. Multiple values shall be represented in their own AttributeValue element. Multiple values should be repeated within a single Attribute element, but may be
        encoded using multiple Attributes and/or AttributeStatements. When Local Policy requires that the following attributes are carried in the SAML assertion then they should be encoded as follows:
      </li>
      <li class="bullet-list2">Subject ID : The value on the Subject ID attribute shall be a plain text description of the user's name (not user ID).</li>
      <li class="bullet-list3">This &lt;Attribute&gt; element shall have the Name attribute set to “urn:oasis:names:tc:xspa:1.0:subject:subject-id”. (Note: This value for the Name attribute is historic and is no longer in the underlying XSPA
        specification.) The name of the user shall be placed in the value of the &lt;AttributeValue&gt; element. (Keep in mind that the term “subject” in SAML and XACML refers to the individual making the request; in this specification, the term
        “User” is generally used with the same meaning, but when referring to attributes defined in SAML or XACML, the naming convention of the standard is retained.)
        <div class="codeBox">
          <p class="XMLname">
            <span> &lt;saml:Attribute Name="urn:oasis:names:tc:xspa:1.0:subject:subject-id"&gt;</span><br />
            <span>   &lt;saml:AttributeValue&gt;Walter H.Brattain IV&lt;/saml:AttributeValue&gt;</span><br />
            <span> &lt;/saml:Attribute&gt;</span><br />
          </p>
        </div>
      </li>
      <li class="bullet-list2">Subject Organization : The value on Subject Organization attribute shall be a plain text description of the organization.</li>
      <li class="bullet-list3">This &lt;Attribute&gt; element shall have the Name attribute set to “urn:oasis:names:tc:xspa:1.0:subject:organization”. In plain text, the organization that the user belongs to shall be placed in the value of the
        &lt;AttributeValue&gt; element.
        <div class="codeBox">
          <p class="XMLname">
            <span>&lt;saml:Attribute Name="urn:oasis:names:tc:xspa:1.0:subject:organization"&gt;</span><br />
            <span>  &lt;saml:AttributeValue&gt;Family Medical Clinic&lt;/saml:AttributeValue&gt;</span><br />
            <span>&lt;/saml:Attribute&gt;</span><br />
          </p>
        </div>
      </li>
      <li class="bullet-list2">Subject Organization ID Attribute</li>
      <li class="bullet-list3">This &lt;Attribute&gt; element shall have the Name attribute set to “urn:oasis:names:tc:xspa:1.0:subject:organization-id” A unique identifier for the organization that the user is representing in performing this
        transaction shall be placed in the value of the &lt;AttributeValue&gt; element. This organization ID shall be consistent with the plain-text name of the organization provided in the User Organization Attribute. The organization ID may be an
        Object Identifier (OID), using the urn format (that is, “urn:oid:” appended with the OID); or it may be a URL assigned to that organization.
        <div class="codeBox">
          <p class="XMLname">
            <span>&lt;saml:Attribute Name="urn:oasis:names:tc:xspa:1.0:subject:organization-id"&gt;</span><br />
            <span>  &lt;saml:AttributeValue&gt;http://familymedicalclinic.org&lt;/saml:AttributeValue&gt;</span><br />
            <span>&lt;/saml:Attribute&gt;</span><br />
          </p>
        </div>
      </li>
      <li class="bullet-list2">Home Community ID Attribute</li>
      <li class="bullet-list3">This &lt;Attribute&gt; element shall have the Name attribute set to “urn:ihe:iti:xca:2010:homeCommunityId”. The value shall be the Home Community ID (an Object Identifier) assigned to the Community that is initiating
        the request, using the urn format (that is, “urn:oid:” appended with the OID).
        <div class="codeBox">
          <p class="XMLname">
            <span>&lt;saml:Attribute Name="urn:ihe:iti:xca:2010:homeCommunityId"&gt;</span><br />
            <span>  &lt;saml:AttributeValue&gt;urn:oid:2.16.840.1.113883.3.190&lt;/saml:AttributeValue&gt;</span><br />
            <span>&lt;/saml:Attribute&gt; </span><br />
          </p>
        </div>
      </li>
      <li class="bullet-list2">National Provider Identifier (NPI) Attribute</li>
      <li class="bullet-list3">A National Provider Identifier (NPI) is a unique identifier issued to health care providers by their national authority. (e.g., in the United States this is a 10-digit number assigned by the Centers for Medicare and
        Medicaid Services (CMS)). This attribute provides the ability to specify an NPI value as part of the SAML assertion that accompanies a message. When a simple string is used there needs to be a mutually agreed upon assigning authority. The
        Other Provider Identifier Attribute can be used to explicitly show the assigning authority (see use in the Other Provider Identifier Attribute below).
        <p class="note">Note: Usage of a HL7 CE type in this attribute is permitted for backward compatibility.</p>
      <li class="bullet-list3">This &lt;Attribute&gt; element SHALL have the Name attribute set to “urn:oasis:names:tc:xspa:1.0:subject:npi”. An example of the syntax of this element follows:
        <div class="codeBox">
          <p class="XMLname">
            <span>&lt;saml:Attribute Name="urn:oasis:names:tc:xspa:1.0:subject:npi"&gt;</span><br />
            <span>  &lt;saml:AttributeValue&gt;1234567890&lt;/saml:AttributeValue&gt;</span><br />
            <span>&lt;/saml:Attribute&gt;</span><br />
          </p>
        </div>
      </li>
      <li class="bullet-list2">Other Provider Identifier Attribute</li>
      <li class="bullet-list3">A unique identifier issued to health care providers by a named authority. This &lt;Attribute&gt; may be repeated.</li>
      <li class="bullet-list3">This &lt;Attribute&gt; element SHALL have the Name attribute set to “urn:ihe:iti:xua:2017:subject:provider-identifier”. The value of the &lt;AttributeValue&gt; element is a child element, “id”, in the namespace
        “urn:hl7-org:v3”, whose content is defined by the “II” (instance identifier) data type from the HL7 version 3 abstract data type specification. The “id” element must contain a “root” attribute and an “extension” attribute. It may also
        contain an “assigningAuthorityName” attribute and a “displayable” attribute. The “root” attribute shall contain an OID identifying the authority issuing the provider identifier. The “extension” attribute shall contain the provider identifier
        itself. The “assigningAuthorityName” attribute may be used to include a human readable name for the assigning authority identified by the “root” attribute. The “displayable” attribute may be included to signal that the identifier is human
        readable (if set to “true”) or intended for machine reading (if set to “false”). An example of the syntax of this element follows:
        <div class="codeBox">
          <p class="XMLname">
            <span>&lt;saml:Attribute Name="urn:ihe:iti:xua:2017:subject:provider-identifier"&gt;</span><br />
            <span>  &lt;saml:AttributeValue&gt;</span><br />
            <span>    &lt;id xmlns="urn:hl7-org:v3" xsi:type="II" extension="1234567890" root="2.999.1.2.3.4.5" assigningAuthorityName="Example Authority" displayable="true"/&gt;</span><br />
            <span>  &lt;/saml:AttributeValue&gt;</span><br />
            <span>&lt;/saml:Attribute&gt;</span><br />
          </p>
        </div>
      </li>
      <li class="bullet-list1">The Assertion may contain other statements (e.g., Attributes)</li>
      <li class="bullet-list1">The Assertion shall be signed by the X-Assertion Provider as defined in SAML Core.</li>
    </ul>
    <p>The interface between the X-Service User and the X-Assertion Provider is not specified by XUA. This interface needs to be protected against risks (e.g., exposure of the SAML Token to interception for malicious use). Assertions need to be
      carefully managed in the X-Service User to ensure they are not exposed in the application code or any subsequent use of the Assertion.</p>
    <h6 id="3.40.4.1.2.1">3.40.4.1.2.1 Subject-Role Option</h6>
    <p>When the Subject-Role Option is used the X-Service User shall encode the relevant user subject roles from a locally defined Code-Set into subject role &lt;Attribute&gt; element(s). The Subject-Role values communicated are assertions from the
      X-Service User perspective.</p>
    <p>The subject role &lt;Attribute&gt; element shall have the Name attribute set to “urn:oasis:names:tc:xacml:2.0:subject:role”. The value of the &lt;AttributeValue&gt; element is a child element, “Role”, in the namespace “urn:hl7-org:v3”, whose
      content is defined by the “CE” (coded with equivalents) data type from the HL7 version 3 specification. The code attribute shall contain the role code from the identified Value-Set that represents the role that the XUA user is playing when
      making the request. The displayName attribute may be used to include a human readable representation of the role code. The codeSystem attribute shall contain the OID of the coding system that the role code was taken from. The codeSystemName
      attribute shall identify the name of the coding system. No other parts of the CE data type shall be used. The following is an example of the syntax of this element:</p>
    <div class="codeBox">
      <p class="XMLname">
        <span>&lt;saml:Attribute Name="urn:oasis:names:tc:xacml:2.0:subject:role"&gt;</span><br />
        <span>&lt;saml:AttributeValue&gt;</span><br />
        <span>  &lt;Role xmlns="urn:hl7-org:v3" xsi:type="CE" code="46255001"</span><br />
        <span>   codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED_CT"</span><br />
        <span>   displayName="Pharmacist"/&gt;</span><br />
        <span>&lt;/saml:AttributeValue&gt;</span><br />
        <span>&lt;/saml:Attribute&gt;</span><br />
      </p>
    </div>
    <h6 id="3.40.4.1.2.2">3.40.4.1.2.2 Authz-Consent Option</h6>
    <p>When the Authz-Consent Option is supported and a policy identifier needs to be sent, the X-Service User shall include the document unique ID of the
      <i>Patient Privacy Policy Acknowledgement Document</i>
      or include the Patient Privacy Policy Identifier for a policy that has been previously published encoded as SAML attributes.
    </p>
    <p>A
      <i>Patient Privacy Policy Acknowledgement Document</i> unique ID shall be encoded as a SAML attribute in the IHE ITI namespace, “urn:ihe:iti:bppc:2007:docid”, with name format “urn:oasis:names:tc:SAML:2.0:attrname-format:uri”. Access to the
      content is not specified. Access through an XDS/XCA/XDR/XDM mechanism is a potential approach. Similarly, this option does not specify how the policy documents should be used to make access control decisions. A sample attribute fragment is
      given in Figure 3.40.4.1.2.2-1.
    </p>
    <div class="codeBox">
      <p class="XMLname">
        <span>&lt;saml2:Attribute FriendlyName="Patient Privacy Policy Acknowledgement Document"</span><br />
        <span>     Name="urn:ihe:iti:bppc:2007:docid"</span><br />
        <span>     NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:uri"&gt;</span><br />
        <span>      &lt;saml2:AttributeValue xmlns:xs="http://www.w3.org/2001/XMLSchema" </span><br />
        <span>       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br />
        <span>       xsi:type="xs:anyURI"&gt;urn:oid:1.2.3.xxx&lt;/saml2:AttributeValue&gt;</span><br />
        <span>&lt;/saml2:Attribute&gt;</span><br />
      </p>
    </div>
    <p class="figureTitle">Figure: 3.40.4.1.2.2-1: Sample attribute holding a reference to patient acknowledgement</p>
    <p>A Patient Privacy Policy Identifier shall be encoded as a SAML attribute in the IHE ITI namespace, “urn:ihe:iti:xua:2012:acp”, with name format ``urn:oasis:names:tc:SAML:2.0:attrname-format:uri’’. The policy identifier shall be expressed
      using the xs:anyURI data type. The referenced policy identifier is the OID of a published policy. Access to this policy is not specified further. A sample is given in Figure 3.40.4.1.2.2-2.</p>
    <div class="codeBox">
      <p class="XMLname">
        <span>&lt;saml2:Attribute FriendlyName="Patient Privacy Policy Identifier"</span><br />
        <span>     Name="urn:ihe:iti:xua:2012:acp"</span><br />
        <span>     NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:uri"&gt;</span><br />
        <span>      &lt;saml2:AttributeValue xmlns:xs="http://www.w3.org/2001/XMLSchema" </span><br />
        <span>       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"   xsi:type="xs:anyURI"&gt;urn:oid:1.2.3.yyyy&lt;/saml2:AttributeValue&gt;</span><br />
        <span>&lt;/saml2:Attribute&gt;</span><br />
      </p>
    </div>
    <p class="figureTitle">Figure 3.40.4.1.2.2-2: Sample attribute holding a reference to a privacy policy</p>
    <p class="heading7" id="3.40.4.1.2.2.1">3.40.4.1.2.2.1 Patient Identifier Attribute</p>
    <p>This attribute is <i>optional,</i> as it may not be needed for cases in which the data being exchanged does not pertain to a specific patient (e.g., population health data). The value of the Patient Identifier attribute is recommended when
      the InstanceAccessConsentPolicy attribute is specified in an Authorization Decision Statement.
    </p>
    <p>This &lt;Attribute&gt; element shall have the Name attribute set to:</p>
    <p>“urn:oasis:names:tc:xacml:2.0:resource:resource-id”.</p>
    <p>The patient identifier of the requesting organization shall be placed in the value of the &lt;AttributeValue&gt; element. The patient identifier shall consist of two parts; the OID for the assigning authority and the identifier of the patient
      within that assigning authority. The value shall be formatted using the CX syntax. As an example, a patient identifier of 543797436 for an assigning authority with an OID of 1.2.840.113619.6.197, has been encoded into the follow SAML assertion
      snippet. Please note that the '&amp;' character has been properly encoded in the XML content in the following example.</p>
    <div class="codeBox">
      <p class="XMLname">
        <span>&lt;saml:Attribute Name="urn:oasis:names:tc:xacml:2.0:resource:resource-id"&gt;</span><br />
        <span>  &lt;saml:AttributeValue&gt;543797436^^^&amp;amp;1.2.840.113619.6.197&amp;amp;ISO&lt;/saml:AttributeValue&gt;</span><br />
        <span>&lt;/saml:Attribute&gt;</span><br />
      </p>
    </div>
    <h6 id="3.40.4.1.2.3">3.40.4.1.2.3 PurposeOfUse Option</h6>
    <p>The PurposeOfUse &lt;Attribute&gt; element shall have the Name attribute set to “urn:oasis:names:tc:xspa:1.0:subject:purposeofuse”. The value of the &lt;AttributeValue&gt; element is a child element, “PurposeOfUse”, in the namespace
      “urn:hl7-org:v3”, whose content is defined by the “CE” (coded element) data type from the HL7 version 3 specification.</p>
    <p>The PurposeOfUse element shall contain the coded representation of the Purpose for Use that is in effect for the request.</p>
    <p>An example of the syntax of this element is as follows:</p>
    <div class="codeBox">
      <p class="XMLname">
        <span>&lt;saml:Attribute Name="urn:oasis:names:tc:xspa:1.0:subject:purposeofuse"&gt;</span><br />
        <span>  &lt;saml:AttributeValue&gt;</span><br />
        <span>    &lt;PurposeOfUse xmlns="urn:hl7-org:v3" xsi:type="CE" code="12" </span><br />
        <span>        codeSystem="1.0.14265.1"</span><br />
        <span>codeSystemName="ISO 14265 Classification of Purposes for processing personal health information" </span><br />
        <span>        displayName="Law Enforcement"/&gt;</span><br />
        <span>  &lt;/saml:AttributeValue&gt;</span><br />
        <span>&lt;/saml:Attribute&gt;</span><br />
      </p>
    </div>
    <p>Codes are assigned by the local Security Domain and a Code-Set needs to be managed. A good source Vocabulary for PurposeOfUse is ISO 14265 – Health Informatics – Classification of purposes for processing personal health information. The
      Value-Set used may include local codes or codes drawn from formal vocabulary.</p>
    <p>The value of the Purpose of Use attribute shall be a urn:hl7-org:v3:CE element, specifying the coded value representing the user's purpose in issuing the request, choosing from the value set given by local Policy. The codeSystem attribute of
      this element must be present, and must specify the OID of the "Purpose of Use" code system.</p>
    <p class="heading7" id="3.40.4.1.2.3.1">3.40.4.1.2.3.1 ATNA encoding of PurposeOfUse</p>
    <p>
      When the PurposeOfUse Option is used the X-Service User and X-Service Provider SHALL place the PurposeOfUse value into the ATNA Audit Message associated with the transaction according to the Record Audit Event [ITI-20] transaction (see
      <a href="../Volume2/ITI-20.html#3.20.7.1.2">ITI TF-2a: 3.20.7.1.2</a>
      ).
    </p>
    <h5 id="3.40.4.1.3">3.40.4.1.3 Expected Actions</h5>
    <p>The X-Service Provider shall validate the Identity Assertion by processing the Web-Services Security header in accordance with the Web-Services Security Standard, and SAML 2.0 Standard processing rules (e.g., check the digital signature is
      valid and chains to an X-Identity Provider that is configured as trusted). If this validation fails, then the grouped Actor’s associated transaction shall return with an error code as described in WS-Security core specification Section 12
      (Error Handling, using the SOAP Fault mechanism), and the ATNA Audit event for Authentication Failure shall be recorded according to ATNA rules.</p>
    <p>Any ATNA Audit Messages recorded by actor grouped with the X-Service Provider Actor, shall have the user identity recorded according to the XUA specific ATNA encoding rules (see Section 3.40.4.2 ATNA Audit encoding). For example: The XDS.b
      Document Consumer performing a Registry Stored Query records the Query event; this event record will include the identity provided in the XUA Identity Assertion. This assures that the X-Service User and X-Service Provider ATNA Audit messages
      can be correlated at the ATNA Audit Record Repository.</p>
    <p>The X-Service Provider may use standards transactions to communicate with the X-Assertion Provider (e.g., WS-Trust, SAML 2.0 Protocol) to obtain information not included in the assertion provided (e.g., Attributes that might be related to
      structural roles).</p>
    <p>The X-Service Provider may utilize the identity in access control decisions. Appropriate error messages, not defined here, shall be returned. The X-Service Provider may ignore any other statements (e.g., Attributes).</p>
    <p>The X-Service Provider may use the authentication class references to determine the method that was used to authenticate the user. For example the X-Service Provider may have a configurable list of authentication class references that it is
      willing to recognize as authentication methods that are acceptable, thus treating other authentication class references as not authorized.</p>
    <p>Assertions need to be carefully managed inside the X-Service Provider to ensure they are not exposed in the application code or any subsequent use of the Assertion.</p>
    <h6 id="3.40.4.1.3.1">3.40.4.1.3.1 Subject-Role Option</h6>
    <p>When the Subject-Role Option is used, the X-Service Provider may utilize the Subject-Role values in local policy for access control decision making.</p>
    <p>The X-Service Provider may need to bridge the Subject-Role values into local role vocabulary.</p>
    <p>The Subject-Role may be used to populate the ATNA Audit Message.</p>
    <h6 id="3.40.4.1.3.2">3.40.4.1.3.2 Authz-Consent Option</h6>
    <p>When the Authz-Consent Option is used, the X-Service Provider may utilize the Authz-Consent values in local policy for access control decision making. The Authz-Consent values are offered by the X-Service User as an indicator of the specific
      consent or authorization that the X-Service User has determined authorizes the transaction. The values are informative to the X-Service Provider which may choose to ignore the values.</p>
    <p>This may require the X-Service Provider to lookup the metadata by reference to the values given, and may require the X-Service Provider to retrieve the consent documents.</p>
    <p>The Authz-Consent value may be used to populate the ATNA Audit Message.</p>
    <h6 id="3.40.4.1.3.3">3.40.4.1.3.3 PurposeOfUse Option</h6>
    <p>When the PurposeOfUse Option is used the X-Service Provider SHALL place the PurposeOfUse into the ATNA Audit Message associated with the transaction (see Section 3.40.4.1.2.3.1). This PurposeOfUse in the audit log can be used at the Audit
      Record Repository to inform reporting such as Accounting of Disclosures or Breach Notifications. The X-Service Provider MAY use the PurposeOfUse value in Access Control decisions.</p>
    <h4 id="3.40.4.2">3.40.4.2 ATNA Audit encoding</h4>
    <p>
      <span>When an ATNA Audit message needs to be generated and the user is authenticated by way of an X-User Assertion, the ATNA Audit message</span>
      <span class="XMLname">UserName</span>
      <span>element shall record the X-User Assertion using the following encoding:</span>
    </p>
    <p>
      <span class="XMLname">alias&lt;user@issuer&gt;</span>
    </p>
    <p>where:</p>
    <ul>
      <li class="bullet-list1">
        <span class="XMLname">alias</span>
        <span>is the optional string within the SAML Assertion's Subject element SPProvidedID attribute</span>
      </li>
      <li class="bullet-list1">
        <span class="XMLname">user</span>
        <span>is the required content of the SAML Assertion's Subject element</span>
      </li>
      <li class="bullet-list1">
        <span class="XMLname">issuer</span>
        <span>is the X-Assertion Provider entity ID contained with the content of SAML Assertion's Issuer element</span>
      </li>
      <li class="bullet-list1">The “&lt;” and “&gt;” represent XML control characters</li>
    </ul>
    <p>Example: JD&lt;John.Doe@example.com&gt;</p>
    <h4 id="3.40.4.3">3.40.4.3 Informative Material on WS-Trust</h4>
    <p>If the X-Service Provider uses WS-Trust in order to obtain a SAML assertion from an X-Identity Provider, it is suggested to use the version 1.3 of the WS-Trust specification, as described in [WS-Trust].</p>
  </main>
  <footer>
    <p>
      <hr />
    </p>
    <p class="copyright">Copyright © 2020: IHE International, Inc.</p>
  </footer>
</body>

</html>
