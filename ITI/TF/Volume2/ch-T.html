<html xmlns="http://www.w3.org/1999/xhtml" lang="en_US">
  <head>
    <meta xmlns="" charset="utf-8" />
    <title xmlns="">IHE ITI TF Rev17 Vol2x</title>
    <link xmlns="" rel="stylesheet" href="../css/styles.css" />
  </head>
  <body xmlns="">
    <header>
      <p>
        <img src="../../../IHE_INTERNATIONAL.png" class="IHE logo" alt="IHE logo" />
      </p>
      <p>IHE IT Infrastructure (ITI) Technical Framework, Volume 2</p>
      <p>Revision 17.0 – Final Text</p>
      <p>
        <hr />
      </p>
    </header>
    <main>
      <h1 id="Appendix T">Appendix T: Use of eMail (Informative)</h1>
      <p>The off-line mode protocol uses the classical email exchange, based on SMTP server(s) as well as a POP3 server storing the recipient mailbox. The different steps of the exchange are described below, depending on the success or failure status of the exchange. The mechanism may be similar and use the evolution of these protocols (ESMTP, EMAP4). The Document Source and the Document Recipient shall at least support SMTP and POP3, but they may also support ESMTP and EMAP or similar. The example may also apply for a Document Repository when the off-line protocol binding is used.</p>
      <p>In case the message cannot reach the Document Recipient POP3 server, the diagram is the following:</p>
      <img src="media/Figure_T-1.png" alt="" />
      <p class="figureTitle">Figure T-1: Exchange diagram when the message is sent with error</p>
      <p>Where the steps are:</p>
      <ol>
        <li class="numbered-list1">Initial message sent by the Document Source to its SMTP server</li>
        <li class="numbered-list1">Transfer of this message to the Document Recipient POP3 server, potentially through a number of other SMTP servers acting as relays, but with a problem arising (which could be also at the POP3 Server level as “user email unknown” or “over quota exceeded in the destination mailbox”). An error message “Delivery Status Notification” (DSN) is generated by the server where the problem occurs, and sent back to the sender (using its “reply to” address if present, its “from” address otherwise)</li>
        <li class="numbered-list1">Reception of the negative DSN message by the Document Source POP3 server</li>
        <li class="numbered-list1">Store of the received message by the POP3 server in the mail box dedicated to the Document Source</li>
        <li class="numbered-list1">Query and retrieve of the message by the Document Source from its mailbox (and normally deletion of this message).</li>
      </ol>
      <p>In case the message reaches the Document Recipient POP3 server, the diagram is the following:</p>
      <img src="media/Figure_T-2.png" alt="" />
      <p class="figureTitle">Figure T-2: Exchange diagram when the message is successfully sent</p>
      <p>Where the steps are:</p>
      <ol>
        <li class="numbered-list1">Initial message sent by the Document Source to its SMTP server</li>
        <li class="numbered-list1">Transfer of this message to the Document Recipient POP3 server, potentially through a number of other SMTP servers acting as relays</li>
        <li class="numbered-list1">Store of the received message by the POP3 server in the mail box dedicated to the Document Recipient</li>
        <li class="numbered-list1">Query and retrieve of the message by the Document Recipient from its mailbox (and normally deletion of this message).</li>
        <li class="numbered-list1">Local confirmation of the success (or failure) when it “processes” the message inside the Document Recipient (which could be that the user has read the message or at least that it has been correctly imported in the EHR)</li>
        <li class="numbered-list1">Generation by the Document Recipient of a “Message Delivery Notification” message, that can be positive (respectively negative with the status)</li>
        <li class="numbered-list1">Reception of the positive MDN message by the Document Source POP3 server</li>
        <li class="numbered-list1">Store of the received message by the POP3 server in the mailbox dedicated to the Document Source</li>
        <li class="numbered-list1">Query and retrieve of the message by the Document Source from its mailbox (and normally deletion of this message).</li>
      </ol>
      <img src="media/Figure_T-3.png" alt="" />
      <p class="figureTitle">Figure T-3: Sequence diagram of a secured message exchange</p>
    </main>
    <footer>
      <p>
        <hr />
      </p>
      <p class="copyright">Copyright © 2020: IHE International, Inc.</p>
    </footer>
  </body>
</html>
