<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta xmlns="" charset="utf-8" />
    <title>IUA</title>
    <link xmlns="" rel="stylesheet" href="../../css/styles.css" />
    <style type="text/css">
        code{white-space: pre-wrap;}
        span.smallcaps{font-variant: small-caps;}
        span.underline{text-decoration: underline;}
        div.column{display: inline-block; vertical-align: top; width: 50%;}
    </style>
    <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style>
  <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-HLBNC861DJ" async> </script> 
  </head>
  <body>

    <header>
      <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
        <button class="menu-icon" type="button" data-toggle="responsive-menu"></button>
        <div class="title-bar-title">IUA</div>
      </div>
      <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
        <button class="menu-icon" type="button" data-toggle="responsive-menu"></button>
        <div class="title-bar-title">IUA</div>
      </div>
      <div class="top-bar" id="responsive-menu">
        <div class="top-bar-left">
          <img src="../../IHE_INTERNATIONAL.png" class="IHE logo hide-for-small-only" alt="IHE logo" />
          <ul id="tf-small-menu" class="menu vertical show-for-small-only">
              <li><a class="ihe-purple" href="https://ihe.net" target="_blank">About IHE</a></li>
              <li class="menu-text">Sections
                <ul id="tf-small-menu-list" class="nested vertical menu">
                </ul>
              </li>
            </ul>
          </div>
        <div class="top-bar-right hide-for-small-only">
          <ul class="menu">
            <li class="menu-text tf-version">IHE HIE Whitepaper</li>
          </ul>
          <ul class="menu align-right">
            <li><input id="ihe-search-field" type="search" placeholder="Search"></li>
            <li><button id="ihe-search-button" type="button" class="button search">Search</button></li>
          </ul>
        </div>
      </div>
    </header>
    <div class="scroll-top-wrapper ">
      <span class="scroll-top-inner">
        <i class="size-icon-lg fi-arrow-up"></i>
      </span>
    </div>

    <div class="grid-container fluid">
      <main>
        <div class="grid-x grid-margin-x align-center">
          <div class="hide-for-small-only cell medium-2 large-2" data-sticky-container>
            <div id="section-menu" class="sticky" data-sticky data-anchor="main-top">
            </div>
          </div>
          <div id="main-top" class="cell medium-10 large-10">

            <p><strong>Integrating the Healthcare
            Enterprise</strong></p>
            <p><img src="media/IHE-logo.jpeg"
            alt="IHE_LOGO_for_tf-docs" /></p>
            <p><strong><a href="https://profiles.ihe.net/ITI">IHE
            ITI</a></strong></p>
            <p><strong>Technical Framework Supplement</strong></p>
            <p><strong>Internet User Authorization (IUA)</strong></p>
            <p><strong>Revision 2.2 - Trial Implementation</strong></p>
            <p>Date: June 17, 2022</p>
            <p>Author: ITI Technical Committee</p>
            <p>Email: <a href="mailto:iti@ihe.net">iti@ihe.net</a></p>
            <p><strong>Please verify you have the most recent version of
            this document.</strong> See <a
            href="http://profiles.ihe.net/ITI">here</a> for Trial
            Implementation and Final Text versions and <a
            href="https://profiles.ihe.net/ITI/#1.3">here</a> for Public
            Comment versions.</p>
            <p><strong>Foreword</strong></p>
            <p>This is a supplement to the IHE IT Infrastructure
            Technical Framework. Each supplement undergoes a process of
            public comment and trial implementation before being
            incorporated into the volumes of the Technical
            Frameworks.</p>
            <p>This supplement is published on June 17, 2022 for trial
            implementation and may be available for testing at
            subsequent IHE Connectathons. The supplement may be amended
            based on the results of testing. Following successful
            testing it will be incorporated into the IT Infrastructure
            Technical Framework. Comments are invited and can be
            submitted using the <a
            href="http://www.ihe.net/ITI_Public_Comments/">ITI Public
            Comment form</a> or by creating a <a
            href="https://github.com/IHE/ITI.IUA/issues/new?assignees=&amp;labels=&amp;template=public-comment-issue-template.md&amp;title=">GitHub
            Issue</a>.</p>
            <p>This supplement describes changes to the existing
            technical framework documents.</p>
            <p>"Boxed" instructions like the sample below indicate to
            the Volume Editor how to integrate the relevant section(s)
            into the relevant Technical Framework volume.</p>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please amend Section X.X by the
            following</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <p>Where the amendment adds text, make the added text
            <strong><ins>bold underline</ins></strong>. Where the
            amendment removes text, make the removed text
            <strong><del>bold strikethrough</del></strong>. When entire
            new sections are added, introduce with editor's instructions
            to "add new text" or similar, which for readability are not
            bolded or underlined.</p>
            <p>General information about IHE can be found at <a
            href="http://www.ihe.net"><a
            href="http://www.ihe.net">http://www.ihe.net</a></a>.</p>
            <p>Information about the IHE IT Infrastructure domain can be
            found at <a href="https://www.ihe.net/IHE_Domains/"><a
            href="https://www.ihe.net/IHE_Domains">https://www.ihe.net/IHE_Domains</a></a>.</p>
            <p>Information about the organization of IHE Technical
            Frameworks and Supplements and the process used to create
            them can be found at <a
            href="https://www.ihe.net/about_ihe/ihe_process/"><a
            href="https://www.ihe.net/about_ihe/ihe_process">https://www.ihe.net/about_ihe/ihe_process</a></a>
            and <a href="https://www.ihe.net/resources/profiles/"><a
            href="https://www.ihe.net/resources/profiles">https://www.ihe.net/resources/profiles</a></a>.</p>
            <p>The current version of the IHE Technical Framework can be
            found at <a href="https://profiles.ihe.net/"><a
            href="https://profiles.ihe.net/">https://profiles.ihe.net/</a></a>.</p>
            <p><strong>CONTENTS</strong></p>
            <!-- TOC depthFrom:1 depthTo:2 -->

            <ul>
            <li><a href="#introduction-to-this-supplement">Introduction
            to this Supplement</a></li>
            <li><a href="#open-issues-and-question">Open Issues and
            Question</a></li>
            <li><a href="#closed-issues">Closed Issues</a></li>
            <li><a
            href="#ihe-technical-frameworks-general-introduction">IHE
            Technical Frameworks General Introduction</a>
            <ul>
            <li><a href="#9-copyright-licenses">9 Copyright
            Licenses</a></li>
            </ul></li>
            <li><a
            href="#ihe-technical-frameworks-general-introduction-appendices">IHE
            Technical Frameworks General Introduction Appendices</a>
            <ul>
            <li><a
            href="#appendix-a---actor-summary-definitions">Appendix A -
            Actor Summary Definitions</a></li>
            <li><a
            href="#appendix-b---transaction-summary-definitions">Appendix
            B - Transaction Summary Definitions</a></li>
            <li><a href="#appendix-d---glossary">Appendix D -
            Glossary</a></li>
            </ul></li>
            <li><a href="#volume-1---profiles">Volume 1 -
            Profiles</a></li>
            <li><a href="#34-iua-profile">34 IUA Profile</a>
            <ul>
            <li><a
            href="#341-iua-actors-transactions-and-content-modules">34.1
            IUA Actors, Transactions, and Content Modules</a></li>
            <li><a href="#342-iua-actor-options">34.2 IUA Actor
            Options</a></li>
            <li><a href="#343-iua-required-actor-groupings">34.3 IUA
            Required Actor Groupings</a></li>
            <li><a href="#344-iua-overview">34.4 IUA Overview</a></li>
            <li><a href="#345-iua-security-considerations">34.5 IUA
            Security Considerations</a></li>
            <li><a href="#346-iua-cross-profile-considerations">34.6 IUA
            Cross Profile Considerations</a></li>
            </ul></li>
            <li><a href="#volume-2---transactions">Volume 2 -
            Transactions</a>
            <ul>
            <li><a href="#371-get-access-token-iti-71">3.71 Get Access
            Token [ITI-71]</a></li>
            <li><a href="#372-incorporate-access-token-iti-72">3.72
            Incorporate Access Token [ITI-72]</a></li>
            <li><a href="#3102-introspect-token-iti-102">3.102
            Introspect Token [ITI-102]</a></li>
            <li><a
            href="#3103-get-authorization-server-metadata-iti-103">3.103
            Get Authorization Server Metadata [ITI-103]</a></li>
            </ul></li>
            <li><a href="#33-mhd-profile">33 MHD Profile</a></li>
            <li><a href="#9-atna-profile">9 ATNA Profile</a></li>
            </ul>
            <!-- /TOC -->

            <h1 id="introduction-to-this-supplement">Introduction to
            this Supplement</h1>
            <h2 id="problem-statement">Problem Statement</h2>
            <p>This profile is motivated by customer requirements for
            authorizing network transactions when using HTTP RESTful
            transports. IHE has authorization profiles for the Web
            Services and SOAP based transactions, and this profile
            provides an authorization profile for the HTTP RESTful
            transactions.</p>
            <p>Being authorized means that the user, patient, or
            provider has legitimate access to this HTTP RESTful service.
            The authorization includes identifying the user and the
            application that is making the request to the HTTP RESTful
            server, so that server can make further access control
            decisions.</p>
            <p>The HTTP RESTful transport is being used by many
            healthcare applications and smart devices. These share a
            common set of issues. A typical use case example is:</p>
            <ul>
            <li>The patient installs an application onto his
            tablet.</li>
            <li>The application will need to retrieve and update health
            related data that is stored on a Resource Server. It uses
            HTTP RESTful transactions for both retrieve and update
            because HTTP support is integrated into the platform
            services.</li>
            <li>The patient wants to configure the application to have
            access to his data without needing the IT staff at the
            application vendor and resource vendor to set things
            up.</li>
            </ul>
            <p>The HTTP RESTful services may include user-driven browser
            activity, downloaded applications, automatic devices, and IT
            systems. The existing IHE ITI <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">Cross-Enterprise
            User Assertion (XUA)</a> Profile fills these needs for the
            SOAP transport based transactions. The existing IHE ITI <a
            href="https://profiles.ihe.net/ITI/TF/Volume1/ch-4.html">Enterprise
            User Authentication (EUA)</a> Profile fills these needs for
            various different transports within a single enterprise
            environment, including HTTP RESTful transports.</p>
            <p>The <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-19.html">Basic
            Patient Privacy Consent (BPPC)</a> Profile is associated
            with this profile and these other existing profiles. <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-19.html">BPPC</a>
            covers the legal and administrative needs for consent
            documentation and associating the patient consent with
            policy documentation. The <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-19.html">BPPC</a>
            Profile includes the ability to associate the electronic
            authorizations with the patient agreements and
            organizational policies.</p>
            <p>IUA is not a substitute for the administrative activities
            such as withdrawing consent, policy setting, and other
            activities that <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-19.html">BPPC</a>
            documents provide. The current scope of IUA is the basic
            authorization activities. Future scope may include greater
            integration of this authorization with third party
            authorization and consent documentation profiles, such as
            those found in the IHE <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-19.html">BPPC</a>
            Profile.</p>
            <p>The administrative actions needed to establish an
            Authorization Server for IUA are not covered by this
            profile. These activities depend upon the operational needs,
            and organizational and privacy policies that apply to a
            particular deployment.</p>
            <h2 id="background-on-the-problem-environment">Background on
            the problem environment</h2>
            <p>The application interacts with the user and the
            Authorization Server to support the granting of an access
            token. The application then uses the access token to
            retrieve and update health related data.</p>
            <p>The key issues include:</p>
            <ul>
            <li>Making reliable and accurate authorization decisions as
            part of an overall privacy protecting and security
            environment.</li>
            <li>Application developers expecting one common method for
            obtaining and using access tokens.</li>
            <li>Resource Servers expecting one common method for
            receiving access tokens as part of HTTP RESTful
            transactions, and one common method for processing these
            tokens.</li>
            <li>Users, patients, and providers, expecting to be in
            control, do not want to depend on support staff to set up
            their applications, and want to minimize the interference
            from authorization requirements.</li>
            </ul>
            <p>Additional issues:</p>
            <ul>
            <li>In-house application distribution needing to provide
            authorization for applications used within the
            facility.</li>
            <li>IT administrators preferring a common method to
            authorize use of in-house web applications and access to
            in-house resources.</li>
            <li>Providers and Specialists having authorization needs to
            deal with other organizations and with many resource
            services.</li>
            <li>Granting subset access to specialized provider. For
            example, granting a physical therapy organization read
            access to a patient's cardiac information but forbidding
            access to other sensitive health data.</li>
            </ul>
            <p>There are also environmental assumptions made by this
            profile.</p>
            <p>IUA assumes that there will many systems working together
            to build the access control environment, where IUA provides
            one part only. For example, a glucose monitor may be
            authorized to have access to a patient's medical record. The
            expectation is that this will mean access to all of the
            glucose-related information, which will include a variety of
            measurements and prescriptions. But, it is expected that if
            the device requests other sensitive health data about the
            patient, it will be rejected.</p>
            <p>IUA also assumes that this profile is operating in an
            environment where access consents are managed by <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-19.html">BPPC</a>
            or other mechanisms. For example, there will be a documented
            consent agreement between a patient and a provider that the
            provider will provide medical records to a healthcare proxy
            that is identified and authorized by the patient. <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-19.html">BPPC</a>
            is one way to document that agreement. IUA is not a
            substitute for documenting, establishing, and modifying
            these legal agreements.</p>
            <h2 id="relation-to-smart-on-fhir">Relation to
            SMART-on-FHIR</h2>
            <p>IUA is not based on SMART-on-FHIR, but does strive to not
            conflict with that standard.</p>
            <p>Concerns about SMART were raised surrounding the tight
            dependency between Resource and Authorization Server, the
            inclusion of launch/view context in the authorization flow,
            and the dependency on FHIR. The IHE IT Infrastructure Domain
            believes that IUA provides the following advantages over
            SMART:</p>
            <ul>
            <li>IUA promotes a loose coupling of Resource Server and
            Authorization Servers. This allows for deployments with
            multiple Resource Servers per Authorization Server as well
            as deployments with several or even no Authorization
            Servers.</li>
            <li>IUA supports a wide range of use-cases ranging from
            mobile application access to data, cross-enterprise data
            exchange to complex system integration scenarios.</li>
            <li>IUA is base-standard agnostic and can be combined with
            any HTTP RESTful transaction.</li>
            <li>IUA provides explicit means of obtaining access token
            claims from an access token by a resource server (with and
            without the involvement of an Authorization Server).</li>
            <li>IUA specifies additional authorization context claims
            such as BPPC consents and a user's organizational
            context.</li>
            <li>IUA provides explicit compatibility with IHE XUA.</li>
            </ul>
            <p>That said, it is recognized that SMART-on-FHIR is
            evolving and adoption rates are increasing. Therefore, as
            indicated in Issue 13 below, IHE ITI welcomes community
            feedback on the harmonization of IUA and SMART.</p>
            <h1 id="open-issues-and-questions">Open Issues and
            Questions</h1>
            <ul>
            <li><p><strong>Issue 11</strong>: IUA does not define scopes
            at all; therefore, IUA is not in conflict with
            SMART-on-FHIR. However, this supplement includes updates to
            <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-33.html">MHD</a>
            and does define a Scope for use with <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-33.html">MHD</a>
            transactions. That Scope for <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-33.html">MHD</a>
            does not use a SMART pattern, but it does not forbid SMART
            scopes. IHE requests comments on the IUA, MHD, and
            SMART-on-FHIR Scope harmonization.</p></li>
            <li><p><strong>Issue 12</strong>: Given that the IUA
            Resource Server is grouped with some other IHE-defined
            actor, and that actor has audit logging requirements, IUA
            does not need to give a defined audit event for success. IUA
            does require adding an AuditEvent.entity to the AuditEvent
            defined in the other profile. IHE requests comments on a
            need to define in IUA an AuditEvent specific to a Resource
            Server that is enforcing a DENY. This AuditEvent would be
            used when the Resource Server prevented the transaction from
            reaching the grouped Profile/Actor (e.g., <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-33.html">MHD</a>
            Document Responder). This AuditEvent would cover reasons for
            DENY that are not specific to the content of the grouped
            transaction, e.g., reasons such as: Missing Token, Token
            validation failure, Token expiration, Scope mismatch, IUA
            required attributes missing, etc. The expectation is that we
            can leverage some codes from OAuth.</p></li>
            <li><p><strong>Issue 13</strong>: The SMART-on-FHIR standard
            is gaining world-wide adoption and increases in importance.
            IUA does not utilize SMART-on-FHIR as base-standard, but
            refers to OAuth2.1 and FHIR directly. It is recognized that
            IUA and SMART-on-FHIR do have a (partial) overlap in the
            supported use-cases. IHE requests comments on IUA and
            SMART-on-FHIR flow harmonization.</p></li>
            <li><p><strong>Issue 14</strong>: The IETF OAuth Working
            group developed an extension to the OAuth framework that
            specifies an option to convey more fine grained claims with
            the authorization request. The OAuth 2.0 Rich Authorization
            Requests (draft-ietf-oauth-rar-03) specification introduces
            a new parameter "authorization_details" in authorization
            requests that allows clients to specify fine-grained scope
            claims in a JSON data structure. IUA currently does not
            define scopes at all and therefore does not mandate the way
            to convey more fine-grained scope claims in authorization
            requests. The committee will watch the acceptance and the
            development of the draft and future versions may rely on
            rich authorization requests.</p></li>
            </ul>
            <h1 id="closed-issues">Closed Issues</h1>
            <ul>
            <li><p><strong>Issue 1</strong>: At this time, the method
            for assignment of client identifiers is not included in the
            profile. Registration of clients is a significant
            operational and security problem that is being postponed
            until there is more experience with problems in the field
            and reasonable solutions. In the field there are a variety
            of methods being tried. Many depend upon physical
            distribution methods or out of band communications to manage
            the authentication problems.</p></li>
            <li><p><strong>Issue 2</strong>: This profile does support
            access token in JWT format and SAML 2.0 Assertions compliant
            with the <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>
            profile requirements. An operational environment must
            ensure, that access tokens are understood by the
            authorization and Resource Servers. The Bearer Token Option
            of earlier versions of the profile has been removed, since
            it does not specify the access token format and attributes
            used and was thus not interoperable by design.</p></li>
            <li><p><strong>Issue 3</strong>: Audit messages are only
            defined for clients that are also Secure Applications. There
            is no defined auditing for other clients.</p></li>
            <li><p><strong>Issue 4</strong>: This profile does not
            require client grouping with Secure Node or Secure
            Application because it is using the OAuth client
            authentication methods. It assumes that the client
            authentication method will deal with security considerations
            in a manner similar to the certificate management
            assumptions made for TLS and other certificate
            users.</p></li>
            <li><p><strong>Issue 8</strong>: This profile uses the
            Authorization header only for conveying the authorization
            information. The parameter form is not prohibited but is not
            compliant with the profile.</p></li>
            <li><p><strong>Issue 9</strong>: This profile does not
            explain the ways that some Resource Servers utilize HTTP
            redirects to automate some kinds of authorization
            activities. The actual HTTP transactions used for Obtain
            Access Token and Authorized RESTful Transaction are as
            defined within this profile. The other transactions are
            under the control of the Resource Server and its
            design.</p></li>
            <li><p><strong>Issue 10</strong>: The selected standards
            are: The OAuth 2.1 Framework, JWT Token, with defined
            extensions, SAML Token, using the <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>
            extensions.</p></li>
            </ul>
            <h1 id="ihe-technical-frameworks-general-introduction">IHE
            Technical Frameworks General Introduction</h1>
            <p>The <a href="https://profiles.ihe.net/GeneralIntro/">IHE
            Technical Framework General Introduction</a> is shared by
            all of the IHE domain technical frameworks. Each technical
            framework volume contains links to this document where
            appropriate.</p>
            <h2 id="9-copyright-licenses">9 Copyright Licenses</h2>
            <p>IHE technical documents refer to, and make use of, a
            number of standards developed and published by several
            standards development organizations. Please refer to the IHE
            Technical Frameworks General Introduction, Chapter 9 - <a
            href="https://profiles.ihe.net/GeneralIntro/ch-9.html">Copyright
            Licenses</a> for copyright license information for
            frequently referenced base standards.</p>
            <h1
            id="ihe-technical-frameworks-general-introduction-appendices">IHE
            Technical Frameworks General Introduction Appendices</h1>
            <p>The <a href="https://profiles.ihe.net/GeneralIntro/">IHE
            Technical Framework General Introduction Appendices</a> are
            components shared by all of the IHE domain technical
            frameworks. Each technical framework volume contains links
            to these documents where appropriate.</p>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please update the following appendices
            to the General Introduction as indicated below. Note that
            these are not appendices to this domain's Technical
            Framework but rather, they are appendices to the IHE
            Technical Frameworks General Introduction.</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h2 id="appendix-a---actor-summary-definitions">Appendix A -
            Actor Summary Definitions</h2>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following new or modified
            actors to the IHE Technical Frameworks General Introduction
            Appendix A:</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <p> </p>
            <table>
            <thead>
            <tr class="header">
            <th>Actor</th>
            <th>Definition</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>Authorization Client</td>
            <td>A client that retrieves access tokens and presents them
            as part of transactions.</td>
            </tr>
            <tr class="even">
            <td>Authorization Server</td>
            <td>A server that issues access tokens to requesting
            clients.</td>
            </tr>
            <tr class="odd">
            <td>Resource Server</td>
            <td>A server that provides services that need
            authorization.</td>
            </tr>
            </tbody>
            </table>
            <h2
            id="appendix-b---transaction-summary-definitions">Appendix B
            - Transaction Summary Definitions</h2>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following new or modified
            transactions to the IHE Technical Frameworks General
            Introduction Appendix B:</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <p> </p>
            <table>
            <thead>
            <tr class="header">
            <th>Transaction</th>
            <th>Definition</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>Get Access Token [ITI-71]</td>
            <td>Request and obtain an access token for use in authorized
            transactions.</td>
            </tr>
            <tr class="even">
            <td>Incorporate Access Token [ITI-72]</td>
            <td>Add an access token to a transaction.</td>
            </tr>
            <tr class="odd">
            <td>Introspect Token [ITI-102]</td>
            <td>Obtain the state and claims associated with an access
            token.</td>
            </tr>
            <tr class="even">
            <td>Get Authorization Server Metadata [ITI-103]</td>
            <td>Obtain metadata about a Authorization Server.</td>
            </tr>
            </tbody>
            </table>
            <h2 id="appendix-d---glossary">Appendix D - Glossary</h2>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following new or modified
            terms to the IHE Technical Frameworks General Introduction
            Appendix D:</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <p> </p>
            <table>
            <thead>
            <tr class="header">
            <th>Term</th>
            <th>Definition</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>No new terms</td>
            <td></td>
            </tr>
            </tbody>
            </table>
            <p> </p>
            <h1 id="volume-1---profiles">Volume 1 - Profiles</h1>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following Section 34 to
            Volume 1</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h1 id="34-internet-user-authorization-iua-profile">34
            Internet User Authorization (IUA) Profile</h1>
            <p>The IUA Profile adds authorization information to HTTP
            RESTful transactions. The IUA actors and behavior can be
            added to other profiles and transactions that need
            authorization.</p>
            <p>The actors in the IUA Profile manage the access tokens
            used for authorization of access to HTTP RESTful services
            based on the flows and transactions defined in the OAuth 2.1
            Authorization Framework [OAuth 2.1]. Authorization Clients
            interact with the Authorization Server to retrieve access
            tokens and incorporate them into HTTP RESTful transactions
            to authorize access to resources on the Resource
            Servers.</p>
            <p>The OAuth 2.1 Authorization Framework requires client
            identification, which may be based on a <em>client_id</em>
            parameter [OAuth 2.1, Section 2.2]. Depending on the grant
            type, the use of the <em>client_id</em> may be required. For
            example, the <em>Authorization Code</em> grant type requires
            the use of the <em>client_id</em> for client identification
            [OAuth 2.1, Section 4.1], while the <em>Client
            Credential</em> grant type does not [OAuth 2.1, Section
            4.2].</p>
            <p>The OAuth 2.1 Authorization Framework also requires
            client authentication for confidential and credential
            clients [OAuth 2.1, Section 2.3]. It recommends the use of
            asymmetric (public-key based) methods for client
            authentication [OAuth 2.1, Section 9.1], but allows other
            suitable HTTP-based authentication schemes matching the
            security policy of the Authorization Server [OAuth 2.1,
            Section 2.3.2].</p>
            <p>This profile requires the capability of a
            <em>client_id</em> for client identification and a
            <em>client_secret</em> used with the HTTP Basic
            Authentication scheme for client authentication of
            confidential and credentialed clients. Other methods for
            identification and authentication are allowed.</p>
            <p>Depending on the grant type, the OAuth 2.1 Framework also
            requires user authentication. For example, the
            <em>Authorization Code</em> grant type covered by this
            profile requires user authentication [OAuth 2.1, Section
            4.1], while the <em>Client Credential</em> grant type does
            not [OAuth 2.1, Section 4.2]. The methods used by the
            Authorization Server to authenticate the user (e.g.,
            username and password login, session cookies, delegation to
            Authentication Server) are not scoped in the OAuth 2.1
            Authorization Framework [OAuth 2.1, Section 3.1].</p>
            <p>Since user authentication methods chosen depend on the
            projects or national security policies, they are not
            constrained in the IUA Profile and shall be defined in the
            specific implementation projects or national extensions of
            this profile. If the user authentication is not implemented
            in the Authorization Server, the use of OpenID Connect with
            the Authorization Grant or Hybrid flow is recommended.</p>
            <p>It is the responsibility of the Resource Server to
            enforce the access policies based on the transaction
            performed and the information provided in the access token.
            Therefore, the Resource Server must be able to rely upon the
            decisions made by the Authorization Server (e.g., client
            identification, user authentication) which requires that a
            trust relation between the Resource Server and the
            Authorization Server was established beforehand.</p>
            <p>The Resource Server may delegate the access policy
            enforcement to actors it is grouped with by providing the
            information from the access token and transaction data, or
            to other actors (e.g., by implementing the Authorization
            Decisions Verifier of the <a
            href="https://profiles.ihe.net/ITI/TF/Volume1/ch-39.html">Secure
            Retrieve (SeR)</a> Profile).</p>
            <p><em>Note:</em> An analogy of the segregation of duties
            for access control between the Authorization Server and the
            Resource Server is given in a textbook (<em>Solving Identity
            Management in Modern Applications</em>, <em>APress 2019</em>
            by Yvonne Wilson and Abhishek Hingnikar) comparing the
            authorization and policy enforcement with a ticketing and
            entrance control to events (e.g., opera, cinema). In this
            analogy, the Authorization Server provides the ticket which
            authorizes participation, while additional checks are
            performed to finally participate in the event.</p>
            <p>The IUA Profile relies on the OAuth 2.1 Authorization
            Framework. Since the original publication of OAuth 2.0 in
            2012, several new RFCs have been published that add or
            remove functionality from the core specification. Version
            2.1 of the OAuth Authorization Framework consolidates and
            simplifies the most commonly used features and best
            practices of OAuth 2.0.</p>
            <h2
            id="341-iua-actors-transactions-and-content-modules">34.1
            IUA Actors, Transactions, and Content Modules</h2>
            <p>This section defines the actors, transactions, and/or
            content modules in this profile. General definitions of
            actors are given in the Technical Frameworks General
            Introduction Appendix A. IHE Transactions can be found in
            the Technical Frameworks General Introduction Appendix B.
            Both appendices are located at <a
            href="http://ihe.net/Technical_Frameworks/#GenIntro">http://ihe.net/Technical_Frameworks/#GenIntro</a>.</p>
            <p>Figure 34.1-1 shows the actors directly involved in the
            IUA Profile and the relevant transactions between them. If
            needed for context, other actors that may be indirectly
            involved due to their participation in other related
            profiles are shown in dotted lines. Actors which have a
            required grouping are shown in conjoined boxes (see <a
            href="#343-iua-required-actor-groupings">ITI TF-1: 34.3 IUA
            Required Actor Groupings</a>).</p>
            <p><img src="media/1.2_IUA-actor-diagram.png"
            alt="IUA Actor Diagram" /></p>
            <p><strong>Figure 34.1-1: IUA Actor Diagram</strong></p>
            <p>Table 34.1-1 lists the transactions for each actor
            directly involved in the IUA Profile. To claim compliance
            with this profile, an actor shall support all required
            transactions (labeled "R") and may support the optional
            transactions (labeled "O").</p>
            <p><strong>Table 34.1-1: IUA Profile - Actors and
            Transactions</strong></p>
            <table>
            <thead>
            <tr class="header">
            <th>Actors</th>
            <th>Transactions</th>
            <th>Optionality</th>
            <th>Reference</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>Authorization Client</td>
            <td>Get Access Token</td>
            <td>R</td>
            <td><a href="#371-get-access-token-iti-71">ITI TF-2:
            3.71</a></td>
            </tr>
            <tr class="even">
            <td></td>
            <td>Incorporate Access Token</td>
            <td>R</td>
            <td><a href="#372-incorporate-access-token-iti-72">ITI TF-2:
            3.72</a></td>
            </tr>
            <tr class="odd">
            <td></td>
            <td>Get Authorization Server Metadata</td>
            <td>O</td>
            <td><a
            href="#3103-get-authorization-server-metadata-iti-103">ITI
            TF-2: 3.103</a></td>
            </tr>
            <tr class="even">
            <td>Authorization Server</td>
            <td>Get Access Token</td>
            <td>R</td>
            <td><a href="#371-get-access-token-iti-71">ITI TF-2:
            3.71</a></td>
            </tr>
            <tr class="odd">
            <td></td>
            <td>Introspect Token</td>
            <td>O (Note 1)</td>
            <td><a href="#3102-introspect-token-iti-102">ITI TF-2:
            3.102</a></td>
            </tr>
            <tr class="even">
            <td></td>
            <td>Get Authorization Server Metadata</td>
            <td>O</td>
            <td><a
            href="#3103-get-authorization-server-metadata-iti-103">ITI
            TF-2: 3.103</a></td>
            </tr>
            <tr class="odd">
            <td>Resource Server</td>
            <td>Incorporate Access Token</td>
            <td>R</td>
            <td><a href="#372-incorporate-access-token-iti-72">ITI TF-2:
            3.72</a></td>
            </tr>
            <tr class="even">
            <td></td>
            <td>Introspect Token</td>
            <td>O (Note 1)</td>
            <td><a href="#3102-introspect-token-iti-102">ITI TF-2:
            3.102</a></td>
            </tr>
            <tr class="odd">
            <td></td>
            <td>Get Authorization Server Metadata</td>
            <td>O</td>
            <td><a
            href="#3103-get-authorization-server-metadata-iti-103">ITI
            TF-2: 3.103</a></td>
            </tr>
            </tbody>
            </table>
            <p><em>Note 1:</em> Optionality of this transaction is "R"
            for an actor that supports the Token Introspection
            Option.</p>
            <h3
            id="3411-actor-descriptions-and-actor-profile-requirements">34.1.1
            Actor Descriptions and Actor Profile Requirements</h3>
            <p>Most requirements are documented in ITI TF-2
            transactions. This section documents any additional
            requirements on this profile's actors.</p>
            <h4 id="34111-authorization-client">34.1.1.1 Authorization
            Client</h4>
            <p>The Authorization Client performs the network
            transactions and user interactions needed to obtain an
            access token and to attach that token to transactions to
            indicate that the transactions are authorized.</p>
            <p>When Incorporate Access Token [ITI-72] is used with a
            FHIR server, an Authorization Client should query the <a
            href="http://hl7.org/fhir/R4/http.html#capabilities">capabilities</a>
            endpoint on the Resource Server to determine if the Resource
            Server supports IUA. The Resource Server indicates IUA
            support with the element <a
            href="http://hl7.org/fhir/R4/capabilitystatement.html"><strong>CapabilityStatement.rest.security.service</strong></a>
            and the code <code>IUA</code> at system canonical URL
            <code>http://profiles.ihe.net/fhir/ihe.securityTypes/CodeSystem/securityTypes</code>.
            The CodeSystem can be retrieved from the IHE FHIR GitHub
            repository, <a
            href="https://github.com/IHE/fhir/blob/master/CodeSystem/codesystem-IHE_securitytypes.xml">codesystem-IHE_securitytypes.xml</a>.</p>
            <p>Note that the Authorization Client may choose to publish
            a CapabilityStatement, if a CapabilityStatement is provided
            then the <code>IUA</code> code should also be indicated to
            show the capability of the Authorization Client.</p>
            <p>The Get Access Token [ITI-71] transaction is scoped to
            the <em>Authorization Code</em> and <em>Client
            Credential</em> grant types (see <a
            href="#34411-authorization-grant-types">ITI TF-1: 34.4.1.1
            Authorization Grant Types</a>). The Authorization Client
            shall support at least one of the following grant types:</p>
            <ul>
            <li><p><em>Authorization Code</em></p></li>
            <li><p><em>Client Credential</em></p></li>
            </ul>
            <p>The Authorization Client may support other grant types
            (see <a href="#34411-authorization-grant-types">ITI TF-1:
            34.4.1.1 Authorization Grant Types</a>).</p>
            <h4 id="34112-authorization-server">34.1.1.2 Authorization
            Server</h4>
            <p>The Authorization Server provides access tokens to
            requesting clients. In IUA, the Authorization Server uses an
            authenticated user identity, the requested HTTP RESTful
            service URL to the Resource Server, and/or other information
            to determine whether HTTP RESTful transactions are
            authorized. If authorized, the Authorization Server provides
            an access token which authorizes the client to retrieve data
            and documents from the Resource Server.</p>
            <p>The Get Access Token [ITI-71] transaction is scoped to
            the <em>Authorization Code</em> and <em>Client
            Credential</em> grant types (see <a
            href="#34411-authorization-grant-types">ITI TF-1: 34.4.1.1
            Authorization Grant Types</a>). The Authorization Server
            shall support the following grant types:</p>
            <ul>
            <li><p><em>Authorization Code</em></p></li>
            <li><p><em>Client Credential</em></p></li>
            </ul>
            <p>The Authorization Server may support other grant types
            (see <a href="#34411-authorization-grant-types">ITI TF-1:
            34.4.1.1 Authorization Grant Types</a>).</p>
            <h4 id="34113-resource-server">34.1.1.3 Resource Server</h4>
            <p>The Resource Server provides services to access protected
            resources that need authorization. In IUA, the Resource
            Server accepts an HTTP RESTful transaction request with an
            incorporated access token. It evaluates the access token to
            verify that the Authorization Server has authorized the
            transaction. The Resource Server shall enforce this
            authorization and may perform additional authorization
            decisions that are specific to the requested service. The
            Resource Server may then allow the transaction to proceed,
            subject to access control constraints that may be in
            place.</p>
            <p>In general, Resource Servers perform additional access
            control decisions and may restrict responses even for
            transactions authorized by the Authorization Server.</p>
            <p>When the Incorporate Access Token [ITI-72] transaction is
            used with a FHIR server, the Resource Server shall declare
            support for IUA in the <a
            href="http://hl7.org/fhir/R4/http.html#capabilities">capabilities</a>
            endpoint using the element <a
            href="http://hl7.org/fhir/R4/capabilitystatement.html"><strong>CapabilityStatement.rest.security.service</strong></a>
            and the code <code>IUA</code> at system canonical URL
            <code>http://profiles.ihe.net/fhir/ihe.securityTypes/CodeSystem/securityTypes</code>.
            The CodeSystem can be retrieved from the IHE FHIR GitHub
            repository, <a
            href="https://github.com/IHE/fhir/blob/master/CodeSystem/codesystem-IHE_securitytypes.xml">codesystem-IHE_securitytypes.xml</a>.</p>
            <p>The Resource Servers and Authorization Servers may be
            grouped into an integrated product together with user
            authentication, access control, and other services.</p>
            <h2 id="342-iua-actor-options">34.2 IUA Actor Options</h2>
            <p>Options that may be selected for each actor in this
            profile are listed in the Table 34.2-1. Dependencies between
            options, when applicable, are specified in notes.</p>
            <p><strong>Table 34.2-1: IUA - Actors and
            Options</strong></p>
            <table>
            <thead>
            <tr class="header">
            <th>IUA Actor</th>
            <th>Option</th>
            <th>Reference</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>Authorization Client</td>
            <td>Authorization Server Metadata</td>
            <td>Section 34.2.1</td>
            </tr>
            <tr class="even">
            <td>Authorization Server</td>
            <td>JWT Token (Note 1)</td>
            <td>Section 34.2.2</td>
            </tr>
            <tr class="odd">
            <td></td>
            <td>SAML Token (Note 1)</td>
            <td>Section 34.2.3</td>
            </tr>
            <tr class="even">
            <td></td>
            <td>Token Introspection (Note 1)</td>
            <td>Section 34.2.4</td>
            </tr>
            <tr class="odd">
            <td></td>
            <td>Authorization Server Metadata</td>
            <td>Section 34.2.1</td>
            </tr>
            <tr class="even">
            <td>Resource Server</td>
            <td>JWT Token (Note 1)</td>
            <td>Section 34.2.2</td>
            </tr>
            <tr class="odd">
            <td></td>
            <td>SAML Token (Note 1)</td>
            <td>Section 34.2.3</td>
            </tr>
            <tr class="even">
            <td></td>
            <td>Token Introspection (Note 1)</td>
            <td>Section 34.2.4</td>
            </tr>
            <tr class="odd">
            <td></td>
            <td>Authorization Server Metadata</td>
            <td>Section 34.2.1</td>
            </tr>
            </tbody>
            </table>
            <p><em>Note 1:</em> Authorization Server or Resource Server
            Actors shall support at least one of the following options:
            JWT Token, SAML, or Token Introspection. The Authorization
            Client is not and does not need to be aware of the token
            processing options.</p>
            <h3 id="3421-authorization-server-metadata-option">34.2.1
            Authorization Server Metadata Option</h3>
            <p>This option enables automated configuration of Resource
            Servers and Authorization Clients by enabling them to pull
            configuration metadata directly from the Authorization
            Server.</p>
            <p>An Authorization Client that supports this option shall
            have the means to be configured to interact with an
            Authorization Server metadata endpoint to retrieve
            configuration information (see <a
            href="#3103423-expected-actions">ITI TF-2:
            3.103.4.2.3</a>).</p>
            <p>Authorization Servers supporting the Authorization Server
            Metadata Option shall provide a metadata endpoint that
            provides configuration information to Authorization Client
            and Resource Servers. This information includes endpoint
            locations, supported authentication grants and signing key
            materials (see <a href="#3103423-expected-actions">ITI TF-2:
            3.103.4.2.3</a>).</p>
            <p>Resource Servers supporting the Authorization Server
            Metadata Option shall have the means to be configured to
            interact with an Authorization Server metadata endpoint to
            retrieve configuration information (see <a
            href="#3103423-expected-actions">ITI TF-2:
            3.103.4.2.3</a>).</p>
            <p>See <a
            href="#3103-get-authorization-server-metadata-iti-103">ITI
            TF-2: 3.103</a> for transaction requirements.</p>
            <h3 id="3422-jwt-token-option">34.2.2 JWT Token Option</h3>
            <p>This option uses JSON Web Token encoding as access token
            issued by the Authorization Server. The JSON Web Token
            constraints are defined in <a
            href="#3714221-json-web-token-option">ITI TF-2:
            3.71.4.2.2.1</a>.</p>
            <p>An Authorization Server that supports this option shall
            provide an endpoint to retrieve JWT access tokens to be
            incorporated in RESTful requests to Resource Servers (see <a
            href="#371413-expected-actions">ITI TF-2:
            3.71.4.1.3</a>).</p>
            <p>A Resource Server that supports this option shall be able
            to accept JWT access tokens in RESTful requests, to extract
            and validate the information provided in the JWT access
            token, and to enforce access policies based on it (see <a
            href="#37243-expected-actions">ITI TF-2: 3.72.4.3</a>).</p>
            <p>See <a href="#3714221-json-web-token-option">ITI TF-2:
            3.71.4.2.2.1</a> for transaction requirements.</p>
            <h3 id="3423-saml-token-option">34.2.3 SAML Token
            Option</h3>
            <p>This option enables integration of environments that use
            both the <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>-compatible
            SAML access token and the OAuth authorization
            infrastructure.</p>
            <p>An Authorization Server that supports this option shall
            provide an endpoint to retrieve <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>-compliant
            SAML 2.0 access tokens to be incorporated in RESTful
            requests to Resource Servers (see <a
            href="#371413-expected-actions">ITI TF-2:
            3.71.4.1.3</a>).</p>
            <p>A Resource Server that supports this option shall be able
            to accept <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>-compliant
            access tokens in RESTful requests, to extract and validate
            the information provided in the token, and to enforce access
            policies based on it (see <a
            href="#37243-expected-actions">ITI TF-2: 3.72.4.3</a>).</p>
            <p>See <a href="#3714222-saml-token-option">ITI TF-2:
            3.71.4.2.2.2</a> for transaction requirements.</p>
            <h3 id="3424-token-introspection-option">34.2.4 Token
            Introspection Option</h3>
            <p>Actors that support this option use the <a
            href="#3102-introspect-token-iti-102">Token Introspection
            [ITI-102]</a> transaction to validate and obtain the claims
            associated with an access token. Introspection allows for
            custom token formats and re-evaluation of tokens after
            commission (enabling features like token revocation), at the
            cost of introspection calls to the Authorization Server.</p>
            <p>An Authorization Server that supports the Token
            Introspection option shall provide an endpoint that Resource
            Servers will use to validate and evaluate the access token.
            With this option, the Authorization Server may provide token
            formats other than JWT or SAML. Using this option, the token
            can be treated as an opaque data construct for Resource
            Servers. When Token Introspection option is used, the
            Authorization Server shall provide the <a
            href="#3102-introspect-token-iti-102">Token Introspection
            [ITI-102]</a> transaction service.</p>
            <p>A Resource Server that supports the Token Introspection
            Option shall have the ability to use the <a
            href="#3102-introspect-token-iti-102">Token Introspection
            [ITI-102]</a> transaction to obtain the details of the token
            from the Authorization Server. This transaction can be used
            by the Resource Server when it is uncertain about the format
            of the token (JWT, SAML, or opaque), or when it wants to
            re-evaluate the authorization policy. To be able to invoke
            the introspection endpoint, the Resource Server must
            authenticate itself. It may obtain an access token of its
            own from the Authorization Server for this purpose.</p>
            <p>See <a href="#3102-introspect-token-iti-102">ITI TF-2:
            3.102 Introspect Token</a> for transaction requirements.</p>
            <h2 id="343-iua-required-actor-groupings">34.3 IUA Required
            Actor Groupings</h2>
            <p>An actor from this profile shall implement the required
            transactions and/or content modules in this profile
            <em><strong>in addition to</strong></em> all of the
            transactions required for the grouped actor (Column 2).</p>
            <p><strong>Table 34.3-1: Required Actor
            Groupings</strong></p>
            <table>
            <thead>
            <tr class="header">
            <th>IUA Actor</th>
            <th>Actor to be grouped with</th>
            <th>Reference</th>
            <th>Content Bindings Reference</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>Authorization Server</td>
            <td>CT / Time Client</td>
            <td><a
            href="https://profiles.ihe.net/ITI/TF/Volume1/ch-7.html">ITI
            TF-1:7 Consistent Time</a></td>
            <td>---</td>
            </tr>
            <tr class="even">
            <td>Resource Server</td>
            <td>CT / Time Client</td>
            <td><a
            href="https://profiles.ihe.net/ITI/TF/Volume1/ch-7.html">ITI
            TF-1:7 Consistent Time</a></td>
            <td>---</td>
            </tr>
            <tr class="odd">
            <td>Authorization Client</td>
            <td>---</td>
            <td>---</td>
            <td>---</td>
            </tr>
            </tbody>
            </table>
            <p>The IUA actors are expected to be grouped with other
            actors that perform HTTP RESTful transaction:</p>
            <ul>
            <li><p>Grouping an Authorization Client with another actor
            means that this other actor will provide an access token as
            part of the HTTP transaction to a HTTP RESTful server. It
            may perform the Get Access Token transaction to obtain the
            access token.</p></li>
            <li><p>The corresponding HTTP RESTful server should be
            grouped with the Resource Server to indicate that the server
            can perform access control.</p></li>
            </ul>
            <h2 id="344-iua-overview">34.4 IUA Overview</h2>
            <h3 id="3441-concepts">34.4.1 Concepts</h3>
            <p>The term "authorization" and "access control" are used
            colloquially for a variety of related activities. All of the
            concepts listed below are sometimes called "authorization"
            or "access control". See the IHE <a
            href="https://www.ihe.net/Technical_Framework/upload/IHE_ITI_TF_WhitePaper_AccessControl_2009-09-28.pdf">ITI
            Access Control</a> white paper for a detailed discussion of
            Access Control concepts. This profile will use more specific
            terms for each of these activities. These are:</p>
            <ul>
            <li><p>Provisioning -- Setting up the initial rules and
            updating them when the situation changes. The administrator
            may say "Authorize Dr. X to have access". The steps taken to
            make this happen are called provisioning.</p></li>
            <li><p>Delegation -- Adding, transferring, and revoking
            authorization from one person to another. This is closely
            related to provisioning. It differs in that it can only
            transfer authority that has already been provisioned, and it
            may track changes to provisioned access for the original
            person.</p></li>
            <li><p>Authentication -- Determining that the actual user
            (at the moment of authentication) is the claimed
            identity.</p></li>
            <li><p>Authorization -- Determining that the authenticated
            user is authorized to have access to a resource (at the
            moment of authorization). The profile describes how to
            convey authorization decisions. It is not defining how the
            decision is made.</p></li>
            <li><p>Access Control -- A system of provisioning,
            delegation, authentication, and authorization. It is normal
            to have multiple nested levels of access control. This
            profile is concerned with whether access is allowed to make
            the HTTP transaction requests to the specified resources.
            There are likely also building access controls, Resource
            Server access controls, and other access controls
            involved.</p></li>
            </ul>
            <h4 id="34411-authorization-grant-types">34.4.1.1
            Authorization Grant Types</h4>
            <p>The OAuth 2.1 Authorization Framework [OAuth 2.1, Section
            4] defines the following authorization grant types:</p>
            <ul>
            <li><p><em>Authorization Code Grant</em> [OAuth 2.1, Section
            4.1]. This grant type is optimized for confidential clients
            who make use of User Agents (e.g., web browsers).</p></li>
            <li><p><em>Client Credentials Grant</em> [OAuth 2.1, Section
            4.2]. This grant type is optimized for clients requesting
            access tokens using only its client credentials and is
            restricted to confidential clients (e.g., medical devices,
            back end applications).</p></li>
            </ul>
            <p>The OAuth 2.1 Authorization Framework further defines
            extension points to implement extension grant types [OAuth
            2.1, Section 4.3], specifically:</p>
            <ul>
            <li><p><em>Device Authorization</em> [RFC8628]: This grant
            type is optimized for devices that cannot use a browser to
            perform a user-agent-based authorization or don't provide
            interfaces for the user to input text required for
            authorization and authentication (e.g., medical devices,
            mobile health sensors).</p></li>
            <li><p><em>SAML Client or User Assertions</em> [RFC7522]: To
            use a SAML Assertion as a credential for client or user
            authentication, the Authorization Client shall perform the
            access token request in conformance with the <em>SAML 2.0
            Profile for OAuth 2.0 Client Authentication and
            Authorization Grants</em>. This type of grant may be used to
            exchange a <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>
            Compliant SAML 2.0 assertion to a token format preferred by
            the Authorization Server.</p></li>
            <li><p><em>JSON Web Token (JWT) grants</em> [RFC7523]: To
            use a JWT Token as credential for client or user
            authentication, the Authorization Client shall perform the
            access token request in conformance with the <em>JSON Web
            Token (JWT) Profile for OAuth 2.0 Client Authentication and
            Authorization Grants</em>. This type of grant provides
            better security properties than the client credential flow
            as it allows for asymmetric keys to be used for client and
            user authentication.</p></li>
            </ul>
            <p>The SAML and JWT grants from RFC7522 and RFC7523 may be
            used in federation scenarios where an Authorization Server
            will accept tokens from another Authorization Server as
            credentials for issuing access tokens. Both the RFC7522 and
            RFC7523 require the existence of a public key
            infrastructure. The operational aspects of such
            infrastructure are beyond the scope of this
            specification.</p>
            <p>This profile specifies the use of the Authorization Code
            and Client Credential grant types. Actors of this profile
            may support other grant types as well.</p>
            <h4 id="34412-terminology">34.4.1.2 Terminology</h4>
            <p>The IUA Profile uses the terms "access token", "refresh
            token", "bearer token", "Authorization Server", "Resource
            Server", "authorization endpoint", "authorization request",
            "authorization response", "token endpoint", "grant type",
            "access token request", and "access token response" as
            defined by The OAuth 2.1 Authorization Framework [OAuth
            2.1].</p>
            <p>This profile also uses the terms "token introspection",
            "introspection endpoint", "introspection request", and
            "introspection response" as defined by the OAuth2 Token
            Introspection specification [RFC7662].</p>
            <p>In accordance with the definitions in the OAuth 2.1
            Authorization Framework [OAuth 2.1], this profile
            distinguishes confidential clients, credentialed clients,
            and public clients as follows:</p>
            <ul>
            <li><p><em>confidential client</em> - a client which stores
            the client authentication data (e.g., client_id and
            client_secret) in a way that the user has no access to it
            (e.g., a server hosted web application)</p></li>
            <li><p><em>credentialed client</em> - a client which has
            credentials, but their identity has been not been confirmed
            by the Authorization Server</p></li>
            <li><p><em>public client</em> - a client where the user (in
            principle) has access to the client code and client data.
            Public clients cannot store client authentication data in a
            confidential way (e.g., single page web applications, native
            mobile apps on a device, if no additional features are
            implemented to make the client authentication data
            unavailable for the user)</p></li>
            </ul>
            <p><em>Note:</em> A public client classification does not
            automatically mean the client is insecure. Public clients
            typically are under the full control of the user (e.g., a
            native app on the user's device) and secured against
            malicious attacks. Public clients just cannot hide
            authentication data from the user, making client
            authentication useless.</p>
            <h3 id="3442-use-cases">34.4.2 Use Cases</h3>
            <h4 id="34421-authorization-use-cases">34.4.2.1
            Authorization Use Cases</h4>
            <p>The IUA Profile applies to use cases where a user
            authorizes a client application to access health data on
            behalf of the user using OAuth, including:</p>
            <ul>
            <li><p>A healthcare professional uses a server hosted web
            application to access a patient's electronic health record
            (EHR) using RESTful transactions. The web application has
            been registered beforehand at the Authorization Server with
            client identifier and client authentication method (e.g.,
            client secret) by a system administrator. When accessing a
            view on the EHR, the browser is redirected to the EHR's
            Authorization Server. The Authorization Server authenticates
            the healthcare professional either by enabling the user to
            enter the authentication factors (e.g., username, password
            and 2nd factor) or by redirecting to an Identity Provider
            (IdP). This step may be omitted if the browser already has
            an authenticated session (e.g., session cookie). After user
            authentication, the Authorization Server performs the
            necessary steps to authorize the web application access to
            the EHR data with application specific scope, either by
            contract or by explicit consent given by the healthcare
            professional. When authorized, the web application retrieves
            an access token which authorizes it to request and retrieve,
            on behalf of the healthcare professional the EHR data from
            the Resource Server(s) with an application-specific
            scope.</p></li>
            <li><p>A healthcare professional uses a single page web
            application to access a patient's electronic health record
            (EHR) using RESTful transactions. At initial startup, the
            app registers with the Authorization Server using a dynamic
            client registration protocol. When accessing a view on the
            EHR, the steps follow the same steps as in the web
            application use case above.</p></li>
            <li><p>A clinical monitor managed by the hospital system
            administrators access a patients EHR using RESTful
            transactions in the hospital LAN. At installation time,
            clinical monitor has been registered at the Authorization
            Server with client identifier and client authentication
            method (e.g., client secret) by the system administrator and
            contracts (policies) have been deposited at the
            Authorization Server and Resource Server(s) authorizing
            access to the EHR with application specific scope. Before
            accessing patient EHR data, the clinical monitor requests an
            access token from the Authorization Server (e.g., using the
            client credential grant type). The clinical monitor
            incorporates the access token to the RESTful transactions to
            access EHR data and documents stored in the EHR Resource
            Server(s) with an application specific scope.</p></li>
            <li><p>A patient uses a native app on her mobile device to
            access data from her electronic health record (EHR) using
            RESTful transactions via the Internet. At first startup, the
            app registers with the Authorization Server using a dynamic
            client registration protocol. When accessing a view on the
            EHR, the native app is redirected to the EHR Authorization
            Server, which authenticates the patient either by presenting
            the views to enter the authentication factors (e.g.,
            username, password and 2nd factor) or by delegating to an
            Identity Provider (IdP). After user authentication, the
            Authorization Server performs the necessary steps to
            authorize the native app to access to the EHR data with
            application-specific scope by explicit user consent. When
            authorized, the native app retrieves an access token which
            authorizes the app to request and retrieve the EHR data from
            the Resource Server(s) with an application specific scope on
            behalf of the patient.</p></li>
            </ul>
            <p>The limitation of the scope is common to all use cases
            and one of the key concepts of OAuth to ensure data privacy
            protection by user consent. While the need for restricting
            the scope might be less obvious for primary system
            applications, it is apparent for mobile or web applications
            that provide specific services for patients or healthcare
            professionals, e.g., for medication or vaccinations or other
            specific use cases. Therefore, in general, an Authorization
            Server will present a form to the user to consent to an
            application specific and limited scope, e.g., to specific
            transactions, document types or classes, or subject-specific
            data the application is authorized to access.</p>
            <h4 id="34422-process-flow">34.4.2.2 Process Flow</h4>
            <p>Figure 34.4.2.2-1 shows the basis flow of information
            exchange common to IUA use cases.</p>
            <p><img src="media/basic-flow.png"
            alt="ITI-71 Flow Diagram" /></p>
            <p><strong>Figure 34.4.2.2-1: Basic Process of the Access
            Token Request and Incorporate Access Token
            Transaction</strong></p>
            <pre class="plantuml"><code>@startuml basic-flow

participant &quot;Authorization Client&quot; as Client
participant &quot;Authorization Server&quot; as AS
participant &quot;Resource Server&quot; as RS

autonumber 0 1 &quot;&lt;b&gt;[00]&lt;/b&gt;&quot;
autoactivate on

group (optional) Get Authorization Server Metadata (ITI-103)

    Client-&gt; AS : Authorization Server Metadata Request (ITI-103)
    AS --&gt; Client: Authorization Server Metadata Response

    RS-&gt; AS : Authorization Server Metadata Request (ITI-103)
    AS --&gt; RS: Authorization Server Metadata Response

end

group Get Access Token (ITI-71)
    Client -&gt; AS: Get Access Token Request
    Client &lt;-- AS: Get Access Token Response
end

group Incorporate Access Token (ITI-72)

Client -&gt; RS : Resource Request + Incorporate Access Token

alt JWT or SAML token
  RS -&gt; RS: validate token
  deactivate RS

else introspect token

  group Introspect Token (ITI-102)
        RS -&gt; AS : Introspect Token Request
        AS -&gt; AS : validate token
        deactivate AS
        AS --&gt; RS: Introspect Token Response
  end
end

Client &lt;-- RS : Resource Response  
end

@enduml
</code></pre>
            <p><strong>Process Flow:</strong></p>
            <ol type="1">
            <li><p>(Optional) The Authorization Client fetches the
            metadata document from the Authorization Server to detect
            the relevant authorization endpoints, and supported grant
            types.</p></li>
            <li><p>(Optional) The Resource Server fetches the metadata
            document from the Authorization Server to detect the
            supported token format, relevant introspection endpoints,
            and signature verification key material.</p></li>
            <li><p>The Authorization Client authenticates to the
            Authorization Server and (optionally) provides claims
            related to the intended request to access protected
            resources of a Resource Server.</p></li>
            <li><p>The Authorization Server authenticates the client,
            validates the claims against any policy rules (such as user
            consent) and returns an access token that authorizes the
            Authorization Client to request the protected resources from
            Resource Servers. This may entail interaction with the user
            to establish user authentication and/or consent.</p></li>
            <li><p>The Authorization Client incorporates the access
            token to the requests of the protected resources to Resource
            Servers.</p></li>
            <li><p>The Resource Server obtains the claims associated
            with the access token. This may involve local validation of
            structured tokens or validation through an additional token
            introspection request towards the Authorization
            Server.</p></li>
            <li><p>The Resource Server evaluates the claims and the
            request against a configured access policy and determines
            whether the client has access to the requested resources. If
            permitted, the Resource Server will return the requested
            resources.</p></li>
            </ol>
            <h2 id="345-iua-security-considerations">34.5 IUA Security
            Considerations</h2>
            <p>IUA uses OAuth 2.1 which contains references to security
            analyses. There are also a variety of analyses available in
            the public literature. The IUA Profile does not introduce
            new considerations to those analyses and has not identified
            any new issues specific to healthcare.</p>
            <p>For confidential clients, this profile requires client
            authentication using client_id and client_secret, if no
            other reliable client authentication method is used, and the
            client registration with a fixed redirect_uri.</p>
            <p>IUA does not address issues around issuing and revoking
            client_ids. OAuth 2.1 relies upon the client_id for client
            identification and authorization. OAuth 2.1 does not further
            define how client_ids are managed.</p>
            <p>Usually an Authorization Server publishes web forms where
            system administrators and users can apply for a client_id.
            OAuth 2.1 defines a mechanism for dynamically registering
            clients with Authorization Servers, by defining a set of
            desired client metadata values to be made available to the
            Authorization Servers [OAuth 2.1, Section 2].</p>
            <p>The Authorization Server will have an
            administratively-managed list of approved client_ids for
            accepted clients. This list will be updated as new clients
            are approved or existing clients are removed. An access
            token will not be issued for unapproved clients. This
            assumes that the client_id management will deal with these
            security considerations in a manner similar to the
            certificate management assumptions made for secure
            communication transactions.</p>
            <p>The Authorization Server will typically have an
            administratively-managed list of approved Resource Servers.
            The list of Resource Servers is used in access control
            decisions to determine if a client has access to a Resource
            Server. These access control decisions take place when an
            access token is created, are associated with the access
            token, and may be re-evaluated when an access token is
            introspected. Introspection is initiated by a Resource
            Server just prior to servicing a client request.
            Introspection can therefore be used to signal token
            revocation, or to provide Resource Server-specific
            authorization results (such as a limited view on the
            authorized scopes).</p>
            <h2 id="346-iua-cross-profile-considerations">34.6 IUA Cross
            Profile Considerations</h2>
            <p>The Cross-Enterprise User Assertion (<a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>)
            Profile provides equivalent functionality as IUA, but for
            SOAP-based transactions. Both <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>
            and IUA define a transaction to incorporate a token into
            other IHE transactions accessing protected data. These
            profiles have much in common, but also some remarkable
            differences:</p>
            <ul>
            <li><p>The <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>
            Profile defines the Provide X-User Assertion [ITI-40]
            transaction to retrieve an SAML 2 assertion for
            authorization, but does not profile the transaction, leaving
            the details to national extensions and project-specific
            implementations. In contrast, the IUA Profile specifies the
            analog Get Access Token [ITI-71] for OAuth 2.1-compliant
            access token.</p></li>
            <li><p>While both IUA and XUA profiles rely on the <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-9.html">ATNA</a>
            Authenticate Node [ITI-19] transaction to provide a secure
            communication and server side authentication; the <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>
            would use the "STX: TLS 1.0 Floor with AES", "STX: TLS 1.0
            Floor with BCP195", "STX: TLS 1.2 Floor using BCP195"
            Options or the "STX WS-Security" Option to authenticate the
            client (or client network node); and IUA uses the "STX:
            HTTPS IUA" Option to leverage IUA to authenticate client
            applications.</p></li>
            <li><p>While <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>
            supports SAML 2 Assertions only, the IUA Profile supports
            access token in JWT, SAML 2.0 Assertion or custom formats
            (in case the Token Introspection Option is
            implemented).</p></li>
            </ul>
            <p>The SAML Token Option in IUA enables an Authorization
            Client to incorporate access token originally retrieved and
            issued from a <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>
            X-Assertion Provider and use it in the Incorporate Access
            Token [ITI-72] transaction, when accessing protected data
            from a Resource Server via RESTful transactions.</p>
            <h1 id="volume-2---transactions">Volume 2 -
            Transactions</h1>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add Section 3.71</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h2 id="371-get-access-token-iti-71">3.71 Get Access Token
            [ITI-71]</h2>
            <h3 id="3711-scope">3.71.1 Scope</h3>
            <p>This transaction is used by an Authorization Client to
            retrieve an OAuth 2.1-compliant access token.</p>
            <h3 id="3712-actor-roles">3.71.2 Actor Roles</h3>
            <p>This transaction defines the following actors and
            roles:</p>
            <p><strong>Table 3.71.2-1: Actor Roles</strong></p>
            <table>
            <thead>
            <tr class="header">
            <th>Actor</th>
            <th>Role</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>Authorization Client</td>
            <td>Client requesting an access token to authorize RESTful
            transactions</td>
            </tr>
            <tr class="even">
            <td>Authorization Server</td>
            <td>Server that grants access tokens.</td>
            </tr>
            </tbody>
            </table>
            <h3 id="3713-referenced-standards">3.71.3 Referenced
            Standards</h3>
            <p>This transaction relies on standards defined in the
            following documents and the references therein:</p>
            <ul>
            <li><p><em>OAuth 2.1</em>: The OAuth 2.1 Authorization
            Framework, published as draft-ietf-oauth-v2-1-01, 1 February
            2021.</p></li>
            <li><p><em>JWT Access Token</em>: JSON Web Token (JWT)
            Profile for OAuth 2.0 Access Tokens, published as
            draft-ietf-oauth-access-token-jwt-10, September
            2020.</p></li>
            <li><p><em>RFC7519</em>: JSON Web Token (JWT), May
            2015.</p></li>
            <li><p><em>RFC7522</em>: Security Assertion Markup Language
            (SAML) 2.0 Profile for OAuth 2.0 Client Authentication and
            Authorization Grants, May 2015.</p></li>
            <li><p><em>RFC7515</em>: JSON Web Signature (JWS), May
            2015.</p></li>
            <li><p><em>RFC7518</em>: JSON Web Algorithms (JWA), May
            2015.</p></li>
            <li><p><em>RFC4648</em>: The Base16, Base32, and Base64 Data
            Encodings, October 2006</p></li>
            </ul>
            <h3 id="3714-messages">3.71.4 Messages</h3>
            <h4 id="37141-get-access-token-request">3.71.4.1 Get Access
            Token Request</h4>
            <h5 id="371411-trigger-events">3.71.4.1.1 Trigger
            Events</h5>
            <p>The Get Access Token Request is performed by an
            Authorization Client to obtain an access token to be used in
            further communication. The sequence of HTTP(S) requests to
            perform a Get Access Token transaction depends on the grant
            type (type of credentials) chosen.</p>
            <h5 id="371412-message-semantics">3.71.4.1.2 Message
            Semantics</h5>
            <p>This transaction supports two distinct grants for
            obtaining an access token. These grants require their own
            variation in message sequences as depicted in the following
            sections:</p>
            <ul>
            <li>Client Credential grant type - see <a
            href="#3714121-client-credential-grant-type">ITI TF-2:
            3.71.4.1.2.1</a> and <a
            href="#3714131-client-credential-grant-type">3.71.4.1.3.1</a></li>
            <li>Authorization Code grant type - see <a
            href="#3714122-authorization-code-grant-type">ITI TF-2:
            3.71.4.1.2.2</a> and <a
            href="#3714132-authorization-code-grant-type">3.71.4.1.3.2</a></li>
            </ul>
            <h5 id="3714121-client-credential-grant-type">3.71.4.1.2.1
            Client Credential grant type</h5>
            <p><img src="media/client-credential-grant.png"
            alt="ITI-71 Client Credential" /></p>
            <p><strong>Figure 3.71.4.1.2.1-1: Sequence of HTTP requests
            in the client credential grant type.</strong></p>
            <pre class="plantuml"><code>@startuml client-credential-grant

participant &quot;Authorization Client&quot; as Client
participant &quot;Authorization Server&quot; as AuthzServer

autonumber 0 1 &quot;&lt;b&gt;[00]&lt;/b&gt;&quot;

group Get Access Token (ITI-71) [Client Credentials Grant]
Client -&gt; AuthzServer: Get Access Token Request
AuthzServer --&gt; Client: Get Access Token Response
end

autonumber stop

@enduml</code></pre>
            <p>The Authorization Client requests an access token using
            client credentials (or other supported means of
            authentication). This grant type shall be used by
            confidential clients only [OAuth 2.1, Section 4.2].</p>
            <p>The Authorization Client makes a HTTP(s) POST request to
            the token endpoint with the following parameters in the HTTP
            request entity-body [OAuth 2.1, Section 4.2.2]:</p>
            <ul>
            <li><p><em>grant_type</em> (required): The value of the
            parameter shall be <em>client_credentials</em>.</p></li>
            <li><p><em>resource</em> (optional): Single valued
            identifier of the Resource Server api endpoint to be
            accessed [JWT Access Token, Section 3].</p></li>
            <li><p><em>scope</em> (optional): The scope claimed by the
            Authorization Client.</p></li>
            </ul>
            <p>The request shall use the
            <em>application/x-www-form-urlencoded</em> format with a
            character encoding of UTF-8 [OAuth 2.1, Section 4.2.2].</p>
            <p>The Authorization Client shall present its
            <em>client_id</em> and <em>client_secret</em> in a HTTP
            Basic Authentication Header to the Authorization Server.</p>
            <p>Figure 3.71.4.1.2.1-2 is a non-normative example of the
            access token request with client authentication using the
            <em>client_id</em> and <em>client_secret</em> in the HTTP
            Authorization header:</p>
            <pre class="http"><code>POST /token HTTP/1.1
Host: server.example.com
Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials
&amp;scope=scope_1 scope_2 ... scope_N
&amp;resource=https://rs.example.com/</code></pre>
            <p><strong>Figure 3.71.4.1.2.1-2: Example Access Token
            Request</strong></p>
            <p>An Authorization Client that supports the Get
            Authorization Server Metadata Option shall use the
            <em>token_endpoint</em> URL from the Authorization Server
            Metadata Document to obtain the access token (see <a
            href="#3103-get-authorization-server-metadata-iti-103">ITI
            TF-2: 3.103 Get Authorization Server Metadata</a>).</p>
            <h5 id="3714122-authorization-code-grant-type">3.71.4.1.2.2
            Authorization Code grant type</h5>
            <p><img src="media/authorization-code-grant.png"
            alt="ITI-71 Authorization Code" /></p>
            <p><strong>Figure 3.71.4.1.2.2-1: Sequence of HTTP requests
            in the client authorization code grant type</strong></p>
            <pre class="plantuml"><code>@startuml authorization-code-grant

actor User

participant &quot;User Agent&quot; as UserAgent
participant &quot;Authorization Client&quot; as Client
participant &quot;Authorization Server&quot; as AuthzServer

autonumber 0 1 &quot;&lt;b&gt;[00]&lt;/b&gt;&quot;

group Get Access Token (ITI-71) [Authorization Code Grant]
Client -&gt; UserAgent: Redirect to Authorization Server \n(authorization request incl requested scopes, resource, etc.)
UserAgent -&gt; AuthzServer: authorization request

note over User, AuthzServer
  Authorization Server determines access based on
  user authentication, consent and/or other policies.
end note

AuthzServer -&gt; UserAgent: Redirect to Client \n(authorization response with Authorization Code)
UserAgent -&gt; Client: authorization response

Client -&gt; AuthzServer: Get Access Token Request \n(client credentials + Authorization Code)
AuthzServer --&gt; Client: Get Access Token Response (access token)
end

@enduml</code></pre>
            <p>This grant type shall be used by confidential, credential
            and public clients, if the explicit consent of the user is
            required to authorize the Authorization Client to access
            data on behalf of the user.</p>
            <p>An Authorization Client that supports the Authorization
            Server Metadata Option shall use the
            "authorization_endpoint" URL from the Authorization Server
            Metadata Document to redirect the User-Agent.</p>
            <p>The Authorization Client directs the user-agent to make a
            HTTP GET request to the authorization endpoint with the
            following parameters using the
            "application/x-www-form-urlencoded" format [OAuth 2.1,
            Section 4.1.1.3]:</p>
            <ul>
            <li><p><em>response_type</em> (required): The value must be
            <em>code</em>.</p></li>
            <li><p><em>client_id</em> (required, if known): The
            identifier the Authorization Client is registered at the
            Authorization Server.</p></li>
            <li><p><em>state</em> (required): An unguessable value used
            by the client to track the state between the authorization
            request and the callback to the redirect URI. While this
            parameter is optional in the OAuth 2.1 Authorization
            Framework [OAuth 2.1, Section 4.1.1.3] it is required in
            this profile for security reasons.</p></li>
            <li><p><em>resource</em> (optional): Single valued
            identifier of the Resource Server endpoint to be accessed
            [JWT Access Token, Section 3].</p></li>
            <li><p><em>code_challenge</em> (required): A challenge
            derived from the client generated code verifier used to
            correlate the authorization request to the token request
            [OAuth 2.1, Section 4.1.1 and references therein].</p></li>
            <li><p><em>code_challenge_method</em> (optional): Indicator
            used for the code challenge transformation method. Its value
            may be <em>S256</em> [OAuth 2.1, Section 9.8].</p></li>
            <li><p><em>redirect_uri</em> (optional): The absolute URI of
            the Authorization Client callback endpoint to which the
            Authorization Server will send the user agent back once
            access is granted (or denied). This parameter is required if
            the Authorization Client is registered at the Authorization
            Server with multiple redirect URI, optional otherwise [OAuth
            2.1, Section 3.1.2.3].</p></li>
            <li><p><em>scope</em> (optional): The scope claimed by the
            Authorization Client.</p></li>
            </ul>
            <p>Figure 3.71.4.1.2.2-2 is a non-normative example of the
            authorization request:</p>
            <pre class="http"><code>GET /authorize?
  response_type=code
  &amp;client\_id=s6BhdRkqt3
  &amp;state=xyz
  &amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
  &amp;code_challenge=6fdkQaPm51l13DSukcAH3Mdx7_ntecHYd1vi3n0hMZY
  &amp;code_challenge_method=S256
  &amp;resource=https%3A%2F%2Frs.example.com%2F
  &amp;scope=scope_1%20scope_2%20scope_N
  HTTP/1.1
Host: server.example.com</code></pre>
            <p><strong>Figure 3.71.4.1.2.2-2: Example Authorization
            Request</strong></p>
            <p>If the access request is granted (by the user or some
            other access policy), the Authorization Server issues an
            authorization code.</p>
            <p>The Authorization Server shall redirect the user agent to
            the Authorization Client's redirect URI with the
            authorization response parameter in the
            <em>application/x-www-form-urlencoded</em> format. The
            response parameter shall be as follows:</p>
            <ul>
            <li><p><em>code</em> (required): The authorization code
            generated by the Authorization Server.</p></li>
            <li><p><em>state</em> (required): An unguessable value used
            by the client to track the state between the authorization
            request and the callback.</p></li>
            </ul>
            <pre class="http"><code>HTTP/1.1 302 Found
Location: https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA&amp;state=xyz</code></pre>
            <p>The Authorization Client shall use the <em>authorization
            code</em> in an access token request to retrieve an access
            token and token metadata from the Authorization Server.</p>
            <p>An Authorization Client that supports the Get
            Authorization Server Metadata Option shall use the
            "token_endpoint" URL from the Authorization Server Metadata
            Document to obtain the access token.</p>
            <p>The Authorization Client makes a HTTP POST request to the
            token endpoint with the following parameters in the HTTP
            request entity-body [OAuth 2.1, Section 4.1.3]:</p>
            <ul>
            <li><p><em>grant_type</em> (required): The value shall be
            "authorization_code".</p></li>
            <li><p><em>code</em> (required): The authorization code
            received from the Authorization Server in the authorization
            response.</p></li>
            <li><p><em>redirect_uri</em> (required): The redirect URI of
            the Authorization Client callback. The value shall match the
            redirect URI the Authorization Client is registered at the
            Authorization Server and the value of the
            <em>redirect_uri</em>, if presented in the authorization
            request.</p></li>
            <li><p><em>client_id</em> (conditional): The client
            identifier the Authorization Client is registered with at
            the Authorization Server. The <em>client_id</em> may be
            omitted in the request entity-body when the
            <em>client_id</em> can be derived from the client
            authentication (e.g., from the HTTP Authorization
            header).</p></li>
            <li><p><em>code_verifier</em>: The original code verifier
            string. Required, if the "code_challenge" parameter was used
            in the authorization request. Shall not be used
            otherwise.</p></li>
            </ul>
            <p>These parameters are specified in OAuth 2.1, Section
            4.1.3. Please refer there for additional behavioral
            requirements.</p>
            <p>Figure 3.71.4.1.2.2-3 shows a non-normative example of
            the access token request with client authentication using
            the <em>client_id</em> and <em>client_secret</em> in the
            HTTP Authorization header:</p>
            <pre class="http"><code>POST /token HTTP/1.1
Host: server.example.com
Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code
&amp;code=SplxlOBeZQQYbYS6WxSbIA
&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
&amp;code_verifier=3641a2d12d66101249cdf7a79c000c1f8c05d2aafcf14bf146497bed</code></pre>
            <p><strong>Figure 3.71.4.1.2.2-3: Example Access Token
            Request</strong></p>
            <h5 id="371413-expected-actions">3.71.4.1.3 Expected
            Actions</h5>
            <p>The Authorization Server, upon receiving a Get Access
            Token Request, validates all request parameters.</p>
            <p>The scope parameter incorporated in the token requests
            shall be used to restrict authorization grants to specific
            actions (e.g., restrict authorization to specific resources
            to read-only) and to convey claims, which at runtime are
            known to the Authorization Client only (e.g., if the user
            claims a breaking-the-glass access in a emergency
            situation). The Authorization Server may refuse token
            requests that mention scope values that are unknown to the
            Authorization Server.</p>
            <p>The Authorization Client is recommended to provide a
            resource value to limit usability of the requested token to
            the intended Resource Server. If provided, the Authorization
            Server should evaluate any resource values provided as part
            of the token request procedure. The Authorization Server
            should execute policies to detect whether the client has
            access to the indicated resource. If the Authorization
            Client presented a resource value in the token request, the
            Authorization Server shall limit the list of Resource Server
            identifiers in the audience claim to only those that are
            essential to interact with the specified resource (typically
            only the Resource Server itself).</p>
            <p>If the request is valid and all access policy criteria
            are met, the Authorization Server shall respond with the
            access token response as outlined <a
            href="#37142-get-access-token-response">ITI TF-2: 3.71.4.2
            Get Access Token Response</a>.</p>
            <p>If the authorization request is invalid, the
            Authorization Server shall react as defined in [OAuth 2.1,
            Section 4.1.2.1].</p>
            <h6 id="3714131-client-credential-grant-type">3.71.4.1.3.1
            Client Credential grant type</h6>
            <p>The Authorization Server shall authenticate the
            Authorization Client using its client identifier and secret
            as communicated in the HTTP Authorization header.</p>
            <p>The Authorization Server shall verify the access token
            request as described in [OAuth 2.1, Section 4.2.2].</p>
            <h6 id="3714132-authorization-code-grant-type">3.71.4.1.3.2
            Authorization Code grant type</h6>
            <p>The Authorization Server shall authenticate confidential
            and credential clients using the <em>client_id</em> and
            <em>client_secret</em>, or by other reliable client
            authentication method. In the latter case, the Authorization
            Server shall resolve the client authentication to a
            <em>client_id</em> which was registered beforehand.</p>
            <p>The Authorization Server shall verify that all required
            parameters of the authorization request are present and
            valid. If valid, the Authorization Server shall authenticate
            the user and obtain the user consent (by presenting the user
            a form to authorize specific scopes or by establishing
            approval via other means). When the user consent is
            established, the Authorization Server shall issue an
            authorization code to the client redirect URI conveying the
            authorization code and client state value.</p>
            <p>The Authorization Client shall use the authorization code
            to request the access token from the Authorization Server.
            The Authorization Server shall verify the access token
            request as described in [OAuth 2.1, Section 4.1.3].</p>
            <h4 id="37142-get-access-token-response">3.71.4.2 Get Access
            Token Response</h4>
            <h5 id="371421-trigger-event">3.71.4.2.1 Trigger Event</h5>
            <p>The Get Access Token Response is returned by an
            Authorization Server upon request from an Authorization
            Client to obtain an access token to be used in further
            communication.</p>
            <h5 id="371422-message-semantics">3.71.4.2.2 Message
            Semantics</h5>
            <p>If the request does not match the requirements or is not
            understood, the Authorization Server shall respond with an
            error response as defined in the OAuth 2.1 Authorization
            Framework [OAuth 2.1, Section 5.2].</p>
            <p>If the access token request is valid and authorized, the
            Authorization Server responds with the access token response
            message in JSON format with the following attributes [OAuth
            2.1, Section 4.2.3]:</p>
            <ul>
            <li><p><em>token_type</em> (required): The value of the
            parameter shall be <em>Bearer</em>.</p></li>
            <li><p><em>access_token</em> (required): A JSON string
            containing the access token. The format of the access token
            string depends on the supported JWT Token, SAML Token or
            Introspect Token Options.</p></li>
            <li><p><em>scope</em> (required): The scope granted by the
            Authorization Server.</p></li>
            <li><p><em>expires_in</em> (optional): This parameter may be
            used to inform the Authorization Client how long the access
            token is valid.</p></li>
            <li><p><em>refresh_token</em> (optional): A token provided
            by the Authorization Server which can be used by the
            Authorization Client to obtain new access tokens using the
            same authorization grant.</p></li>
            </ul>
            <p>The access token response may contain other parameter or
            extensions depending on the implementation details of the
            Authorization Server [OAuth 2.1, Section 4.2.3].</p>
            <p>The Authorization Server shall include the HTTP
            <em>Cache-Control</em> response header field with value
            <em>no-store</em> and the <em>Pragma</em> response header
            field value <em>no-cache</em> to the access token response
            [OAuth 2.1, Section 4.2.3].</p>
            <p>Figure 3.71.4.2.2-1 is non-normative example of the
            access token response:</p>
            <pre class="http"><code>HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store
Pragma: no-cache
{
  &quot;token_type&quot;: &quot;Bearer&quot;,
  &quot;access_token&quot;: &quot;2YotnFZFEjr1zCsicMWpAA&quot;,
  &quot;scope&quot;: &quot;scope_1 scope_2 ... scope_M&quot;,
  &quot;expires_in&quot;: 3600,
  &quot;refresh_token&quot;: &quot;tGzv3JOkF0XG5Qx2TlKWIA&quot;,
  &quot;example_parameter&quot;: &quot;example_value&quot;
}</code></pre>
            <p><strong>Figure 3.71.4.2.2-1: Example Access Token
            Response</strong></p>
            <h6 id="3714221-json-web-token-option">3.71.4.2.2.1 JSON Web
            Token Option</h6>
            <p>The OAuth2.1 specification does not indicate the
            structure of the access token. Actors conforming to the JSON
            Web Token Option shall support access tokens formatted as
            signed JWT Tokens.</p>
            <p>JWT token shall be signed as specified in JSON Web
            Signature [RFC7515]. If signed, the JWS Compact
            Serialization (base64 encoded, with single signature or
            MACed) shall be used as described in [RFC7515, Section
            7.1].</p>
            <p>Any actor may support the JWE (unsigned but encrypted)
            alternative of the JWT token.</p>
            <p>Of the signature of JWT algorithms specified in the JSON
            Web Algorithms [RFC7518], the following algorithms shall be
            supported:</p>
            <ul>
            <li><em>HS256</em>: HMAC using SHA-256 hash algorithm.</li>
            <li><em>RS256</em>: RSA using SHA-256 hash algorithm.</li>
            </ul>
            <p>The following algorithms should be supported:</p>
            <ul>
            <li><em>ES256</em>: ECDSA using P-256 curve.</li>
            <li>SHA-256 hash algorithm ("ES256").</li>
            </ul>
            <p>Other algorithms may be supported except the "NONE" that
            shall not be used.</p>
            <p><em>Note:</em> It is recommended to use asymmetric
            (public-key based, e.g., RS256) methods for signing access
            token. When asymmetric methods are used, a Resource Server
            does not need to store sensitive symmetric keys, making
            these methods more robust against malicious attacks.</p>
            <p>In the JSON Web Token Option, the access token is defined
            as JSON object with the following attributes:</p>
            <ul>
            <li><p><em>iss</em> (required): A single valued string
            identifying the instance which issued the access token
            (e.g., the Authorization Server) [JWT Access Token, Section
            2.2].</p></li>
            <li><p><em>sub</em> (required): If known, unique identifier
            of the user; the <em>client_id</em> otherwise [JWT Access
            Token, Section 2.2].</p></li>
            <li><p><em>client_id</em> (required): identifier of the
            client for which the token is issued. [JWT Access Token,
            Section 2.2]</p></li>
            <li><p><em>aud</em> (required): An array of identifier
            strings for the Resource Server endpoints to be accessed
            [JWT Access Token, Section 2.2]. In the special case when
            the JWT has one audience, the "aud" value may be a single
            case-sensitive string.</p></li>
            <li><p><em>jti</em> (required): A unique identifier for the
            JWT access token [JWT Access Token, Section 2.2].</p></li>
            <li><p><em>exp</em> (required): Expiration time of the token
            in Numeric Date format [JWT Access Token, Section
            2.2].</p></li>
            <li><p><em>scope</em> (required): The scope granted by the
            Authorization Server [JWT Access Token, Section
            2.2.3].</p></li>
            <li><p><em>nbf</em> (optional): The earliest time in Numeric
            Date format the token shall be accepted [JWT, Section
            4.1.5].</p></li>
            <li><p><em>iat</em> (required): The issuing date in Numeric
            Date format [JWT Access Token, Section 2.2].</p></li>
            </ul>
            <p>The JWT access token may contain other parameters or
            extensions depending on the implementation details.</p>
            <p><strong>3.71.4.2.2.1.1 JWT IUA extension</strong></p>
            <p>The Authorization Server and Resource Server shall
            support the following extensions to the JWT access
            token:</p>
            <ul>
            <li><p><em>subject_name</em> (optional): The user's name as
            String.</p></li>
            <li><p><em>subject_organization_id</em> (optional): Unique
            identifier of the user's organization. Its value should be
            an URI, i.e., an URL or an OID in URN notation.</p></li>
            <li><p><em>subject_organization</em> (optional): Name or
            description of the user's organization.</p></li>
            <li><p><em>subject_role</em> (optional): Coded value
            indicating the user's role. If present, the value shall be
            formatted as FHIR Coding data type.</p></li>
            <li><p><em>purpose_of_use</em> (optional): Purpose of use
            for the request. If a coded value is used, the value shall
            be formatted as FHIR Coding data type.</p></li>
            <li><p><em>home_community_id</em> (optional): Home community
            identifier where the request originated. Its value should be
            an OID in URN notation.</p></li>
            <li><p><em>national_provider_identifier</em> (optional): A
            unique identifier issued to health care providers by their
            national authority.</p></li>
            <li><p><em>person_id</em> (optional): Patient identifier,
            Citizen identifier, or other similar public
            identifier.</p></li>
            </ul>
            <p>The above claims shall be wrapped in an "extensions"
            object with key 'ihe_iua' and a JSON value object containing
            the claims. For example:</p>
            <div class="sourceCode" id="cb9"><pre
            class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;extensions&quot;</span> <span class="er">:</span> <span class="fu">{</span>  </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ihe_iua&quot;</span> <span class="fu">:</span> <span class="fu">{</span>  </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;subject_name&quot;</span><span class="fu">:</span> <span class="st">&quot;Dr. John Smith&quot;</span><span class="fu">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;subject_organization&quot;</span><span class="fu">:</span> <span class="st">&quot;Central Hospital&quot;</span><span class="fu">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;subject_organization_id&quot;</span><span class="fu">:</span> <span class="st">&quot;urn:oid:1.2.3.4&quot;</span><span class="fu">,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;other_value&quot;</span><span class="fu">:</span> <span class="st">&quot;...&quot;</span>  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span>  </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
            <p>The claim content shall correspond to the content defined
            in the <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>
            specification (see <a
            href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-40.html#3.40.4.1.2">ITI
            TF-2: 3.40.4.1.2 Message Semantics</a>).</p>
            <p>The mapping of IUA extension claims to <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>-compliant
            SAML 2.0 Assertion attributes is shown in Table
            3.71.3.2.2.1-1 below.</p>
            <p><strong>Table 3.71.4.2.2.1.1-1: JWT claims of the IUA
            extension and corresponding XUA Assertion
            attributes</strong></p>
            <table>
            <thead>
            <tr class="header">
            <th>JWT Claim</th>
            <th>XUA Attribute</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>subject_name</td>
            <td>urn:oasis:names:tc:xspa:1.0:subject:subject-id</td>
            </tr>
            <tr class="even">
            <td>subject_organization</td>
            <td>urn:oasis:names:tc:xspa:1.0:subject:organization</td>
            </tr>
            <tr class="odd">
            <td>subject_organization_id</td>
            <td>urn:oasis:names:tc:xspa:1.0:subject:organization-id</td>
            </tr>
            <tr class="even">
            <td>subject_role</td>
            <td>urn:oasis:names:tc:xacml:2.0:subject:role</td>
            </tr>
            <tr class="odd">
            <td>purpose_of_use</td>
            <td>urn:oasis:names:tc:xspa:1.0:subject:purposeofuse</td>
            </tr>
            <tr class="even">
            <td>home_community_id</td>
            <td>urn:ihe:iti:xca:2010:homeCommunityId</td>
            </tr>
            <tr class="odd">
            <td>national_provider_identifier</td>
            <td>urn:oasis:names:tc:xspa:1.0:subject:npi</td>
            </tr>
            <tr class="even">
            <td>person_id</td>
            <td><em>not defined</em></td>
            </tr>
            </tbody>
            </table>
            <p><strong>3.71.4.2.2.1.2 JWT BPPC extension</strong></p>
            <p>In an environment that uses the IHE <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-19.html">Basic
            Patient Privacy Consents (BPPC)</a> Profile for documenting
            the consent, the Authorization Server and Resource Server
            shall support the following extension parameter:</p>
            <ul>
            <li><p><em>patient_id</em>: Patient identifier related to
            the Patient Privacy Policy Identifier. Its value should be
            the patient identifier in CX syntax or as URL.</p></li>
            <li><p><em>doc_id</em>: Patient Privacy Policy
            Acknowledgment Document. Its value should be an URN or
            URL.</p></li>
            <li><p><em>acp</em>: Patient Privacy Policy
            Identifier.</p></li>
            </ul>
            <p>If present, the claims shall be wrapped in an
            "extensions" object with key 'ihe_bppc' and a JSON value
            object containing the claims, e.g.,</p>
            <div class="sourceCode" id="cb10"><pre
            class="sourceCode json"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;extensions&quot;</span> <span class="er">:</span> <span class="fu">{</span>  </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ihe_bppc&quot;</span> <span class="fu">:</span> <span class="fu">{</span>  </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;patient_id&quot;</span><span class="fu">:</span> <span class="st">&quot;543797436^^^&amp;amp;1.2.840.113619.6.197&amp;amp;ISO&quot;</span><span class="fu">,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;doc_id&quot;</span><span class="fu">:</span> <span class="st">&quot;urn:oid:1.2.3.xxx&quot;</span><span class="fu">,</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;acp&quot;</span><span class="fu">:</span> <span class="st">&quot;urn:oid:1.2.3.yyyy&quot;</span><span class="fu">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;other_value&quot;</span><span class="fu">:</span> <span class="st">&quot;...&quot;</span>    </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span>  </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
            <p>The mapping of IUA extension claims to XUA-compliant SAML
            2.0 Assertion attributes is shown in Table
            3.71.4.2.2.1.2-1.</p>
            <p><strong>Table 3.71.4.2.2.1.2-1: JWT claims of the BPPC
            extension and corresponding XUA Assertion
            attributes</strong></p>
            <table>
            <thead>
            <tr class="header">
            <th>JWT Claim</th>
            <th>XUA Attribute</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>patient_id</td>
            <td>urn:oasis:names:tc:xacml:2.0:resource:resource-id</td>
            </tr>
            <tr class="even">
            <td>doc_id</td>
            <td>urn:ihe:iti:bppc:2007:docid</td>
            </tr>
            <tr class="odd">
            <td>acp</td>
            <td>urn:ihe:iti:xua:2012:acp</td>
            </tr>
            </tbody>
            </table>
            <p><strong>3.71.4.2.2.1.3 Example</strong></p>
            <p>The following is a non-normative example of JWT access
            token:</p>
            <p>JOSE Header:</p>
            <div class="sourceCode" id="cb11"><pre
            class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&quot;typ&quot;</span><span class="fu">:</span> <span class="st">&quot;IUA-JWT&quot;</span><span class="fu">,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&quot;alg&quot;</span><span class="fu">:</span> <span class="st">&quot;HS256&quot;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
            <p>JWS Payload:</p>
            <div class="sourceCode" id="cb12"><pre
            class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;iss&quot;</span><span class="fu">:</span> <span class="st">&quot;urn:vendor:sts&quot;</span><span class="fu">,</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;sub&quot;</span><span class="fu">:</span> <span class="st">&quot;b3ca1045-aa8b-42f9-9fd9-e0cbf5cb90a7&quot;</span><span class="fu">,</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;aud&quot;</span><span class="fu">:</span> <span class="st">&quot;http://ihe.connectathon.IUA/ResourceProvider-IHE-Connectathon&quot;</span><span class="fu">,</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;exp&quot;</span><span class="fu">:</span> <span class="dv">1438251487</span><span class="fu">,</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;nbf&quot;</span><span class="fu">:</span> <span class="dv">1438251187</span><span class="fu">,</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;iat&quot;</span><span class="fu">:</span> <span class="dv">1438251187</span><span class="fu">,</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;scope&quot;</span><span class="fu">:</span> <span class="st">&quot;ITI-68&quot;</span><span class="fu">,</span>    </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;extensions&quot;</span> <span class="fu">:</span> <span class="fu">{</span>  </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;ihe_iua&quot;</span> <span class="fu">:</span> <span class="fu">{</span>  </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;subject_name&quot;</span><span class="fu">:</span> <span class="st">&quot;Dr. John Smith&quot;</span><span class="fu">,</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;subject_organization&quot;</span><span class="fu">:</span> <span class="st">&quot;Central Hospital&quot;</span><span class="fu">,</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;subject_organization_id&quot;</span><span class="fu">:</span> <span class="st">&quot;urn:oid:1.2.3.4&quot;</span><span class="fu">,</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;home_community_id&quot;</span><span class="fu">:</span> <span class="st">&quot;urn:oid:1.2.3.4.5.6.7.8&quot;</span><span class="fu">,</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;person_id&quot;</span><span class="fu">:</span> <span class="st">&quot;urn:uuid:1.2.3.4&quot;</span><span class="fu">,</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;subject_role&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;system&quot;</span><span class="fu">:</span> <span class="st">&quot;2.16.840.1.113883.6.96&quot;</span><span class="fu">,</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;code&quot;</span><span class="fu">:</span> <span class="st">&quot;46255001&quot;</span><span class="fu">,</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;display&quot;</span><span class="fu">:</span> <span class="st">&quot;Pharmacist&quot;</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;purpose_of_use&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;system&quot;</span><span class="fu">:</span> <span class="st">&quot;1.0.14265.1&quot;</span><span class="fu">,</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;code&quot;</span><span class="fu">:</span> <span class="st">&quot;12&quot;</span><span class="fu">,</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;display&quot;</span><span class="fu">:</span> <span class="st">&quot;Law Enforcement&quot;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
            <h6 id="3714222-saml-token-option">3.71.4.2.2.2 SAML Token
            Option</h6>
            <p>An Authorization Server that supports the SAML Token
            Options shall be able to format the access token as a SAML
            2.0 assertion.</p>
            <p>The SAML 2.0 assertion content shall comply with <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>
            SAML assertion rules (see <a
            href="https://profiles.ihe.net/ITI/TF/Volume2/ITI-40.html">ITI
            TF-2: 3.40</a>).</p>
            <p>In accordance with [RFC7522, Section 2.2], the value of
            the access token contains a SAML 2.0 Assertion. It shall not
            contain more than one SAML 2.0 Assertion. The SAML Assertion
            XML data must be encoded using base64url, where the encoding
            adheres to the definition in Section 5 of RFC4648 [RFC4648]
            and where the padding bits are set to zero. To avoid the
            need for subsequent encoding steps (by
            "application/x-www-form-urlencoded"
            [W3C.REC-html401-19991224], for example), the
            base64url-encoded data must not be line wrapped and pad
            characters ("=") must not be included.</p>
            <h6 id="3714223-token-introspection-option">3.71.4.2.2.3
            Token Introspection Option</h6>
            <p>Actors that support the Token Introspection Option shall
            provide a non-empty, unique and non-guessable access token
            value.</p>
            <p>The access token may be a structured value, for example
            using the JWT or SAML token formats as described in <a
            href="#3714221-json-web-token-option">ITI TF-2:
            3.71.4.2.2.1</a> and <a
            href="#3714222-saml-token-option">ITI TF-2:
            3.71.4.2.2.2</a>. Alternatively, the token may be a opaque
            identifier pointing to a stored record of claims retrievable
            by the Authorization Server.</p>
            <p>The Authorization Server shall have means to retrieve the
            claims associated with the access token during token
            introspection (for details see <a
            href="#3102-introspect-token-iti-102">ITI TF-2: 3.102
            Introspect Token</a>).</p>
            <h3 id="3715-security-considerations">3.71.5 Security
            Considerations</h3>
            <p>Authorization Client and Authorization Server that
            support this transaction shall fulfill the security
            requirements defined in the OAuth Authorization Framework
            [OAuth 2.1], including:</p>
            <ul>
            <li><p>All HTTP transactions shall be secured by using TLS
            or equivalent transport security (e.g., ATNA Option STX:
            HTTPS IUA).</p></li>
            <li><p>Authorization Clients shall verify the identity of
            the Authorization Server, either by validating the TLS
            certificate chain or by other reliable methods.</p></li>
            <li><p>Authorization codes shall be for single use or
            short-lived with a lifetime less than or equal to 5
            minutes.</p></li>
            <li><p>Access token should be short-lived with a lifetime of
            1 hour or less. A lifetime less than or equal to 5 minutes
            is recommended.</p></li>
            <li><p>Refresh token may be long lived.</p></li>
            <li><p>To reduce the attack surface, client claims and
            authorization grants shall be the minimal; i.e., the
            authorization grant scope requested by the Authorization
            Client shall be the minimal required scope for the resource
            request to be used for.</p></li>
            </ul>
            <p>The Authorization Client is recommended to provide a
            resource value to limit usability of the requested token to
            the intended Resource Server. If provided, the Authorization
            Server should evaluate any resource values provided as part
            of the token request procedure. The Authorization Server
            should execute policies to detect whether the client has
            access to the indicated resource. If the Authorization
            Client presented a resource value in the token request, the
            Authorization Server shall limit the list of Resource Server
            identifiers in the audience claim to only those that are
            essential to interact with the specified resource (typically
            only the Resource Server itself).</p>
            <h4 id="37151-security-audit-considerations">3.71.5.1
            Security Audit Considerations</h4>
            <p>The Authorization Client or Authorization Server that is
            grouped with an <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-9.html">ATNA</a>
            Secure Node or Secure Application shall be able to send an
            audit event as defined below:</p>
            <table>
            <thead>
            <tr class="header">
            <th></th>
            <th>Field Name</th>
            <th>Opt</th>
            <th>Value Constraints</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td><strong>Event</strong><br/>(AuditMessage/EventIdentification)</td>
            <td>EventID</td>
            <td>M</td>
            <td>EV(110114, DCM, "User Authentication")</td>
            </tr>
            <tr class="even">
            <td></td>
            <td>EventActionCode</td>
            <td>M</td>
            <td>"E" (Execute)</td>
            </tr>
            <tr class="odd">
            <td></td>
            <td><em>EventDateTime</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="even">
            <td></td>
            <td><em>EventOutcomeIndicator</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="odd">
            <td></td>
            <td>EventTypeCode</td>
            <td>M</td>
            <td>EV("ITI-71", IHE, "User Authorization")</td>
            </tr>
            <tr class="even">
            <td><strong>Source (1)</strong></td>
            <td></td>
            <td></td>
            <td></td>
            </tr>
            <tr class="odd">
            <td><strong>Human Requestor (0)</strong></td>
            <td></td>
            <td></td>
            <td></td>
            </tr>
            <tr class="even">
            <td><strong>Destination (0)</strong></td>
            <td></td>
            <td></td>
            <td></td>
            </tr>
            <tr class="odd">
            <td><strong>Audit Source (Client Authentication Agent)
            (1)</strong></td>
            <td></td>
            <td></td>
            <td></td>
            </tr>
            <tr class="even">
            <td><strong>Participant Object (1)</strong></td>
            <td></td>
            <td></td>
            <td></td>
            </tr>
            </tbody>
            </table>
            <p>Where:</p>
            <table>
            <thead>
            <tr class="header">
            <th></th>
            <th>Field Name</th>
            <th>Opt</th>
            <th>Value Constraints</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td><strong>Source</strong>
            <br/>(AuditMessage/ActiveParticipant)</td>
            <td>UserID</td>
            <td>M</td>
            <td>The process ID as used within the local operating system
            in the local system logs.</td>
            </tr>
            <tr class="even">
            <td></td>
            <td><em>Alternative UserID</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="odd">
            <td></td>
            <td><em>UserName</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="even">
            <td></td>
            <td><em>UserIsRequestor</em></td>
            <td><em>M</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="odd">
            <td></td>
            <td>RoleIDCode</td>
            <td>M</td>
            <td>EV(110150, DCM, "Application")</td>
            </tr>
            <tr class="even">
            <td></td>
            <td>NetworkAccessPointTypeCode</td>
            <td>M</td>
            <td>"1" for machine (DNS) name, "2" for IP address</td>
            </tr>
            <tr class="odd">
            <td></td>
            <td>NetworkAccessPointID</td>
            <td>M</td>
            <td>The machine name or IP address</td>
            </tr>
            <tr class="even">
            <td><strong>Audit Source</strong><br/> AuditMessage/
            AuditSourceIdentification</td>
            <td><em>AuditSourceID</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="odd">
            <td></td>
            <td><em>AuditEnterpriseSiteID</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="even">
            <td></td>
            <td><em>AuditSourceTypeCode</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="odd">
            <td><strong>Token</strong> <br/>(AuditMessage/
            ParticipantObjectIdentification)</td>
            <td>ParticipantObjectTypeCode</td>
            <td>M</td>
            <td>"2" (System)</td>
            </tr>
            <tr class="even">
            <td></td>
            <td>ParticipantObjectTypeCodeRole</td>
            <td>M</td>
            <td>"13" (Security Resource)</td>
            </tr>
            <tr class="odd">
            <td></td>
            <td><em>ParticipantObjectDataLifeCycle</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="even">
            <td></td>
            <td><em>ParticipantObjectIDTypeCode</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="odd">
            <td></td>
            <td><em>ParticipantObjectSensitivity</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="even">
            <td></td>
            <td><em>ParticipantObjectID</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="odd">
            <td></td>
            <td><em>ParticipantObjectName</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            <tr class="even">
            <td></td>
            <td>ParticipantObjectQuery</td>
            <td>M</td>
            <td>URL requested</td>
            </tr>
            <tr class="odd">
            <td></td>
            <td><em>ParticipantObjectDetail</em></td>
            <td><em>U</em></td>
            <td><em>not specialized</em></td>
            </tr>
            </tbody>
            </table>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add Section 3.72</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h2 id="372-incorporate-access-token-iti-72">3.72
            Incorporate Access Token [ITI-72]</h2>
            <h3 id="3721-scope">3.72.1 Scope</h3>
            <p>This transaction is used to incorporate authorization
            information into HTTP RESTful transactions.</p>
            <h3 id="3722-actor-roles">3.72.2 Actor Roles</h3>
            <p><strong>Table 3.72.2-1: Actor Roles</strong></p>
            <table>
            <thead>
            <tr class="header">
            <th>Actor</th>
            <th>Role</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>Authorization Client</td>
            <td>Authorization component of a HTTP RESTful transaction
            client.</td>
            </tr>
            <tr class="even">
            <td>Resource Server</td>
            <td>Authorization component of a HTTP RESTful transaction
            server.</td>
            </tr>
            </tbody>
            </table>
            <h3 id="3723-referenced-standards">3.72.3 Referenced
            Standards</h3>
            <p>This transaction relies on standards defined in the
            following documents and the references therein:</p>
            <ul>
            <li><em>OAuth 2.1</em>: The OAuth 2.1 Authorization
            Framework, published as draft-ietf-oauth-v2-1-01, 1 February
            2021.</li>
            </ul>
            <h4 id="37231-related-ihe-profiles">3.72.3.1 Related IHE
            Profiles</h4>
            <p><a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA
            Cross-Enterprise User Assertion (XUA)</a> -- Attribute
            Extension</p>
            <h3 id="3724-messages">3.72.4 Messages</h3>
            <p><img src="media/incorporate-token.png"
            alt="simple-iauth" /></p>
            <p><strong>Figure 3.72.4-1: Process Flow for Incorporate
            Access Token Transaction</strong></p>
            <pre class="plantuml"><code>@startuml incorporate-token

participant &quot;Authorization Client&quot; as client
participant &quot;Resource Server&quot; as rs
participant &quot;Authorization Server&quot; as as

group Incorporate Access Token (ITI-72)

client -&gt; rs : Resource Request + Access Token

alt JWT or SAML token
  rs -&gt; rs: validate token

else introspect token
    rs -&gt; as : Introspect Token (ITI-102)
    as -&gt; as: validate token
    as --&gt; rs: token claims
end

client &lt;-- rs : Resource Response  
end  
@enduml</code></pre>
            <p><strong>Main Flow:</strong></p>
            <ol type="1">
            <li><p>The Authorization Client sends a resource request to
            a Resource Server, together with the access token. The token
            is opaque to the Authorization Client.</p></li>
            <li><p>The Resource Server identifies the format of the
            token, validates the token, and obtains the claims
            associated with the token. To this end it may use the
            Authorization Server metadata, such as signing keys (for JWT
            or SAML tokens), or the introspect endpoint
            location.</p></li>
            <li><p>The Resource Server makes an access control decision
            based upon the claims from the access token and the
            transaction details. It may provide access to the resource,
            a subset of the resource, or reject the request in
            total.</p></li>
            </ol>
            <p>This transaction works in conjunction with other HTTP
            RESTful transaction. It extends the other transaction by
            adding information to the HTTP request for that HTTP RESTful
            transaction.</p>
            <h4 id="37241-trigger-events">3.72.4.1 Trigger Events</h4>
            <p>A client needs to make an HTTP RESTful transaction to a
            Resource Server that enforces access authorization.</p>
            <h4 id="37242-message-semantics">3.72.4.2 Message
            Semantics</h4>
            <p>The Authorization Client shall incorporate the access
            token as received from the Authorization Server in a HTTP
            Authorization header of the type <em>Bearer</em> [OAuth2.1,
            Bearer token].</p>
            <p>A non-normative example of the access token incorporation
            to a RESTful transaction is:</p>
            <pre class="http"><code>GET /example/url/to/resource/location HTTP/1.1
Authorization: Bearer vGHTPOJzh3QFd\[...omitted for brevity...\]99bhgT8Ya
Host: example.com</code></pre>
            <h4 id="37243-expected-actions">3.72.4.3 Expected
            Actions</h4>
            <p>The Resource Server determine the token format (JWT,
            SAML, or other) by evaluating the "access_token_format"
            value in the Authorization Server Metadata document (see <a
            href="#3103-get-authorization-server-metadata-iti-103">ITI
            TF-2: 3.103</a>), inspection of the access token value, or
            some other method.</p>
            <p>When the Resource Server is not able to process the token
            format (through local verification or introspection), it
            shall respond with HTTP 401 (Unauthorized).</p>
            <p>The Resource Server shall validate or introspect the
            access token and ensure that it has not expired.</p>
            <p>If the token includes a scope claim, the Resource Server
            shall verify that the scope covers the transaction to the
            requested resource [OAuth 2.1, Section 7].</p>
            <p>If the token includes an audience claim, the Resource
            Server shall verify that the audience includes the Resource
            Server itself [OAuth 2.1, Section 7].</p>
            <p>The Resource Server shall verify that the claims conveyed
            in the access token match the transaction type and data
            (e.g., verify that the patient_id attribute of the access
            token corresponds to the patient_id of the resource
            request).</p>
            <p>In addition, the Resource Server shall enforce the access
            policies set in the specific environment by matching the
            information from the access token and the transaction data
            to the access policies.</p>
            <p>If the token verification, or scope matching, or the
            access policy enforcement fails, the Resource Server shall
            respond with a HTTP 401 (Unauthorized) error.</p>
            <p>Authorization Clients receiving a HTTP 401 (Unauthorized)
            error should NOT retry the request with the same token. An
            Authorization Client should reformulate the request or
            obtain a new token from the Authorization Server before
            retrying.</p>
            <h5 id="372431-json-web-token-option">3.72.4.3.1 JSON Web
            Token Option</h5>
            <p>A Resource Server that supports the JSON Web Token Option
            shall be able to interpret and validate the access token as
            a JWT Token as defined in <a
            href="#3714221-json-web-token-option">ITI TF-2:
            3.71.4.2.2.1</a>.</p>
            <p>A Resource Server that supports the Authorization Server
            Metadata Option (see <a
            href="#3421-authorization-server-metadata-option">ITI TF-1:
            34.2.1</a>) shall use the keys published through the
            Authorization Server Metadata Document for validating the
            JWT token's signature.</p>
            <h5 id="372432-saml-token-option">3.72.4.3.2 SAML Token
            Option</h5>
            <p>A Resource Server that supports the SAML Token Option
            shall be able to interpret and validate the access token as
            a <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-13.html">XUA</a>-compliant
            SAML Assertion as defined in <a
            href="#3714222-saml-token-option">ITI TF-2:
            3.71.4.2.2.2</a>.</p>
            <p>A Resource Server that supports the Authorization Server
            Metadata Option (see <a
            href="#3421-authorization-server-metadata-option">ITI TF-1:
            34.2.1</a>) shall use the keys published through the
            Authorization Server Metadata Document for validating the
            SAML token's signature.</p>
            <h5 id="372433-introspect-token-option">3.72.4.3.3
            Introspect Token Option</h5>
            <p>A Resource Server that supports the Token Introspection
            Option shall use the <a
            href="#3102-introspect-token-iti-102">Introspect Token
            [ITI-102]</a> transaction to exchange the access token with
            the related claims (see <a
            href="#3102-introspect-token-iti-102">ITI TF-2:
            3.102</a>).</p>
            <p>A Resource Server that supports the Authorization Server
            Metadata Option (see <a
            href="#3421-authorization-server-metadata-option">ITI TF-1:
            34.2.1</a>) shall use the introspection endpoint published
            through the Authorization Server Metadata Document for
            validating the token and obtaining the related claims.</p>
            <h3 id="3725-security-considerations">3.72.5 Security
            Considerations</h3>
            <p>Authorization Clients and Resource Servers that support
            this transaction shall fulfill the security requirements
            defined in the OAuth Authorization Framework [OAuth 2.1],
            especially:</p>
            <ul>
            <li><p>All HTTP transaction shall be secured by using TLS or
            equivalent transport security.</p></li>
            <li><p>Authorization Clients shall verify the identity of
            the Resource Server when making requests to protected
            resources, either by validating the TLS certificate chain
            [OAuth 2.1, Section 7.4.2] or by other reliable
            methods.</p></li>
            </ul>
            <h4 id="37251-security-audit-considerations">3.72.5.1
            Security Audit Considerations</h4>
            <p>When an <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-9.html">ATNA</a>
            Audit message needs to be generated by the Resource Server
            and the user is authenticated by way of a JWT Token, the <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-9.html">ATNA</a>
            Audit message <strong>UserName</strong> element shall record
            the JWT Token information using the following encoding:</p>
            <p><strong>alias"&lt;"user"@"issuer"&gt;"</strong></p>
            <p>where:</p>
            <ul>
            <li><strong>alias</strong> shall match the JWT token's "aud"
            parameter</li>
            <li><strong>user</strong> shall match the JWT token's "sub"
            parameter</li>
            <li><strong>issuer</strong> shall match the JWT token's
            "iss" parameter</li>
            </ul>
            <p>When an <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-9.html">ATNA</a>
            Audit message needs to be generated by the Resource Server
            and the user is authenticated by way of a SAML Token, the <a
            href="http://profiles.ihe.net/ITI/TF/Volume1/ch-9.html">ATNA</a>
            Audit message <strong>UserName</strong> element shall record
            the SAML token information using the following encoding:</p>
            <p><strong>alias"&lt;"user"@"issuer"&gt;"</strong></p>
            <p>where:</p>
            <ul>
            <li><strong>alias</strong> shall match the optional string
            within the SAML Assertion's Subject element SPProvidedID
            attribute</li>
            <li><strong>user</strong> shall match the required content
            of the SAML Assertion's Subject element</li>
            <li><strong>issuer</strong> shall match the X-Assertion
            Provider entity identifier contained with the content of
            SAML Assertion's Issuer element</li>
            </ul>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add Section 3.102</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h2 id="3102-introspect-token-iti-102">3.102 Introspect
            Token [ITI-102]</h2>
            <p>Token introspection defines a protocol that allows
            Resource Servers to query the Authorization Server to
            determine the set of claims for a given token that was
            presented to them by an Authorization Client. These claims
            include whether or not the token is currently active and the
            authorization context in which the token was granted.</p>
            <p>Token introspection allows a Resource Server to query
            this information regardless of whether or not it is carried
            in the token itself (e.g., as encoded in a JWT token),
            allowing this method to be used along with or independently
            of structured token values.</p>
            <p>The Authorization Server may decide to mark a token as
            active or inactive based on internal policies executed
            during introspection. For example, a token may be marked
            inactive if it has expired, been revoked, or if the
            introspection-requesting Resource Server is not part of the
            intended audience of the token. Note that the introspection
            response for inactive tokens does not contain other
            (privacy/security sensitive) claims, nor does it mention the
            reason why the token is marked inactive.</p>
            <p>Additionally, token introspection is carried out in the
            context of a particular Resource Server, allowing the
            returned authorization claims to be tuned to that
            authorization context. For example, the Authorization Server
            may limit the list of scopes to those that are deemed
            relevant for that particular Resource Server.</p>
            <h3 id="31021-scope">3.102.1 Scope</h3>
            <p>This transaction is used by Resource Servers to request
            an OAuth2.1-compliant bearer token evaluation from an
            Authorization Server.</p>
            <h3 id="31022-actor-roles">3.102.2 Actor Roles</h3>
            <p><strong>Table 3.102.2-1: Actor Roles</strong></p>
            <table>
            <thead>
            <tr class="header">
            <th>Actor</th>
            <th>Role</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>Resource Server</td>
            <td>Introspection Requester</td>
            </tr>
            <tr class="even">
            <td>Authorization Server</td>
            <td>Introspection Responder</td>
            </tr>
            </tbody>
            </table>
            <h3 id="31023-referenced-standards">3.102.3 Referenced
            Standards</h3>
            <p>This transaction relies on standards defined in the
            following documents and the references therein:</p>
            <ul>
            <li><p><em>OAuth 2.1</em>: The OAuth 2.1 Authorization
            Framework, published as draft-ietf-oauth-v2-1-01, 1 February
            2021.</p></li>
            <li><p><em>RFC7662</em>: OAuth 2.0 Token Introspection,
            published as RFC7662, October 2015</p></li>
            </ul>
            <h3 id="31024-messages">3.102.4 Messages</h3>
            <p>Introspection entails a single request and response
            between a Resource Server and an Authorization Server. This
            flow is typically executed as part of the authorization of
            RESTful resource request as depicted in <a
            href="#34422-process-flow">ITI TF-1: 34.4.2.2 Process
            Flow</a>.</p>
            <p><img src="media/introspect.png"
            alt="ITI-102 Introspect Diagram" /></p>
            <p><strong>Figure 3.102.4-1: Introspect Token (ITI-102]
            Diagram</strong></p>
            <pre class="plantuml"><code>@startuml introspect

participant &quot;Resource Server&quot; as ResourceServer
participant &quot;Authorization Server&quot; as AuthzServer

autonumber 0 1 &quot;&lt;b&gt;[00]&lt;/b&gt;&quot;
autoactivate on

group Introspect Token (ITI-102)  
ResourceServer -&gt; AuthzServer : Introspection Request\n(incl.Resource Server Access Token and Client Access Token)
ResourceServer &lt;-- AuthzServer : Introspection Response
end

autonumber stop

@enduml</code></pre>
            <p><strong>General flow:</strong></p>
            <ol type="1">
            <li>Optionally, the Resource Server obtains a metadata
            document from the Authorization Server, providing the
            introspect endpoint location.</li>
            <li>The Authorization Client as well as the Resource Server
            independently obtain their access tokens from the
            Authorization Server. The Resource Server requires this
            token to invoke the introspection endpoint.</li>
            <li>The Authorization Client will invoke a Resource Server
            endpoint, embedding its client access token in the
            request.</li>
            <li>The Resource Server obtains the authorization claims
            associated with the token from the Authorization Server by
            invoking the introspect endpoint. This step may be omitted
            if the Resource Server has a cached introspect response
            value for the access token (including responses where the
            <em>active</em> field was set to false).</li>
            <li>The Resource Server will evaluate the token claims,
            enforce any access control policies, and return the
            requested resources to the Authorization Client.</li>
            </ol>
            <h4 id="310241-token-introspection-request">3.102.4.1 Token
            Introspection Request</h4>
            <p>This request is send by the Resource Server to the
            Authorization Server to evaluate the validity and contents
            of an access token.</p>
            <h5 id="3102411-trigger-events">3.102.4.1.1 Trigger
            Events</h5>
            <p>Resource Server wishes to evaluate the validity and
            contents of an access token.</p>
            <h5 id="3102412-message-semantics">3.102.4.1.2 Message
            Semantics</h5>
            <p>The Resource Server shall perform an HTTP POST request to
            the introspect endpoint with the following parameters using
            the "application/x-www-form-urlencoded" format
            [RFC7662]:</p>
            <ul>
            <li><em>token (required)</em>: The string value of the
            token. This is the Authorization Client's access_token as
            received in the Authorization header in the request towards
            the Resource Server as defined in the [ITI-72]
            transaction.</li>
            </ul>
            <p>The Resource Server must securely identify itself towards
            the Authorization Server by using credentials agreed between
            the Authorization Server and Resource Server. See <a
            href="#31025-security-considerations">ITI TF-2: 3.102.5
            Security Considerations</a> for details.</p>
            <p>A Resource Server that supports the Authorization Server
            Metadata Option (see <a
            href="#3421-authorization-server-metadata-option">ITI TF-1:
            34.2.1</a>) shall use the introspection endpoint published
            through the Authorization Server Metadata Document for
            validating the token and obtaining the related claims.</p>
            <p>A non-normative example of an introspection request is
            (using a Bearer HTTP Authorization header) is:</p>
            <pre class="http"><code>POST /introspect HTTP/1.1
Host: server.example.com
Authorization: Bearer 23410913-abewfq.123483
Accept: application/json
Content-Type: application/x-www-form-urlencoded

token=2YotnFZFEjr1zCsicMWpAA</code></pre>
            <p>The token being introspected may be opaque to the
            Resource Server. It may be formatted as JWT or SAML token,
            but custom formats are allowed.</p>
            <h5 id="3102413-expected-actions">3.102.4.1.3 Expected
            Actions</h5>
            <p>Upon receiving the introspect request, the Authorization
            Server shall evaluate the Resource Server's access to the
            introspect endpoint. If access is not allowed, the
            Authorization Server shall return HTTP 401 (Not
            Authorized).</p>
            <p>The Authorization Server shall:</p>
            <ul>
            <li>Validate the structure and authenticity of the token to
            be introspected.</li>
            <li>Validate the active state of the token (e.g., check
            expiry or revocation).</li>
            <li>Evaluate configured access policies, taking into account
            the authorization claims related to the token and the
            Resource Server identity.</li>
            <li>Formulate and return an introspect response.</li>
            </ul>
            <p>If the one of the above checks fails the Authorization
            Server shall return an introspection response with the
            "active" field set to "false" as described in RFC7662,
            Section 2.2.</p>
            <p>The Authorization Server may return different responses
            for the same inspected token. For example, an Authorization
            Server may limit which scopes from a given token are
            returned for each Resource Server to prevent a Resource
            Server from learning more about the larger network than is
            necessary for its operation.</p>
            <p>The Authorization Server may include an expiry field
            (exp) in the introspect result. This expiry field value
            shall be shorter or equal to the expiry time of the access
            token introspected.</p>
            <h4 id="310242-token-introspection-response">3.102.4.2 Token
            Introspection Response</h4>
            <p>The Authorization Server returns the active state and
            authorization claims related to the token.</p>
            <h5 id="3102421-trigger-events">3.102.4.2.1 Trigger
            Events</h5>
            <p>The Authorization Server has formulated an access policy
            decision for the introspected access token.</p>
            <h5 id="3102422-message-semantics">3.102.4.2.2 Message
            Semantics</h5>
            <p>The introspect response is a JSON-formatted object. There
            are two variants of this object.</p>
            <ol type="1">
            <li>The Authorization Server considers the token to be
            invalid for the given Resource Server because of formatting
            issues, revocation data, expiry, or other access policy
            considerations. The introspect result object shall contain a
            single field "active" with boolean value "false".</li>
            <li>The Authorization Server considers the token to be valid
            for the given Resource Server. The object shall contain a
            field "active" with boolean value "true". In addition, it
            shall contain the same fields and values as formulated for
            the JWT token content as specified in <a
            href="#3714221-json-web-token-option">ITI TF-2: 3.71.4.2.2.1
            JSON Web Token</a>, including defined extensions.</li>
            </ol>
            <h5 id="3102423-expected-actions">3.102.4.2.3 Expected
            Actions</h5>
            <p>The Resource Server shall inspect the "active" field of
            the introspect result. If the active field is set to
            "false", the Resource Server shall return HTTP 401 (Not
            Authorized) for all requests carrying the introspected
            access token.</p>
            <p>The Resource Server shall use the introspection results
            as access token claims in all access control evaluations as
            depicted in <a href="#37243-expected-actions">ITI TF-2:
            3.72.4.3</a>.</p>
            <p>The Resource Server may cache introspection results for a
            given access token in case the introspection result contains
            an expiry field. This cache shall not extend the period as
            defined by the expiry field. If no expiry field is provided,
            the Resource Server shall not cache the introspection
            results.</p>
            <h3 id="31025-security-considerations">3.102.5 Security
            Considerations</h3>
            <p>The Resource Server shall securely identify itself
            towards the Authorization Server by using credentials agreed
            between the Authorization Server and Resource Server.</p>
            <p>At minimum, the Authorization Server and Resource Server
            shall support the use of <em>Bearer</em> tokens for Resource
            Server authentication as defined in [OAuth2.1, Section 7.2].
            To obtain a bearer token, the Resource Server may request
            such a token from the Authorization Server, reusing the
            client credential grant flow as described in the Get Access
            Token [ITI-71] transaction (see <a
            href="#3714121-client-credential-grant-type">ITI TF-2:
            3.71.4.1.2.1 Client Credential Grant Type</a>).</p>
            <p>An Authorization Server that supports the Authorization
            Server Metadata Option (see <a
            href="#3421-authorization-server-metadata-option">ITI TF-1:
            34.2.1</a>) should provide the available token introspection
            authentication options as part of its metadata document.</p>
            <p><em>Note:</em> The use of bearer tokens to authorize the
            introspect request will not lead to circular references to
            introspect. The Authorization Server is expected to natively
            understand the bearer tokens it created and therefore does
            not need to call introspect on itself.</p>
            <p>Resource Servers and Authorization Servers that support
            this transaction shall fulfill the security requirements
            defined in [RFC7662], especially:</p>
            <ul>
            <li><p>All HTTP transactions shall be secured by using TLS
            or equivalent transport security.</p></li>
            <li><p>Resource Servers shall verify the identity of the
            Authorization Server, either by validating the TLS
            certificate chain or by other reliable methods.</p></li>
            <li><p>To avoid token leakage through query parameters,
            Resource Servers shall only use HTTP POST for the
            introspection request. HTTP GET is not specified, nor
            allowed by this transaction.</p></li>
            <li><p>If the token can be used only at certain Resource
            Servers (as indicated by the resource field in the token
            request), the Authorization Server shall determine whether
            or not the token can be used at the Resource Server making
            the introspection call.</p></li>
            <li><p>The Authorization Server shall determine whether or
            not the token has expired.</p></li>
            <li><p>If the token can be revoked after it was issued, the
            Authorization Server shall determine whether or not such a
            revocation has taken place.</p></li>
            <li><p>If the token has been signed (e.g., it is a JWT
            Token), the Authorization Server shall validate the
            signature.</p></li>
            <li><p>To avoid disclosing the internal state of the
            Authorization Server, an introspection response for an
            inactive token should not contain any additional claims
            beyond the required "active" claim (with its value set to
            "false").</p></li>
            </ul>
            <h4 id="310251-security-audit-considerations">3.102.5.1
            Security Audit Considerations</h4>
            <p>Resource Servers shall use the introspection results as
            authorization claims when formulating audit messages, as
            specified in <a
            href="#37251-security-audit-considerations">ITI TF-2
            3.72.5.1</a>.</p>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add Section 3.103</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h2
            id="3103-get-authorization-server-metadata-iti-103">3.103
            Get Authorization Server Metadata [ITI-103]</h2>
            <h3 id="31031-scope">3.103.1 Scope</h3>
            <p>This transaction is used by Authorization Clients and
            Resource Servers to obtain metadata about an Authorization
            Server such as endpoint locations and references to key
            stores required to validate (token) signatures.</p>
            <h3 id="31032-actor-roles">3.103.2 Actor Roles</h3>
            <p><strong>Table 3.103.2-1: Actor Roles</strong></p>
            <table>
            <thead>
            <tr class="header">
            <th>Actor</th>
            <th>Role</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>Authorization Client</td>
            <td>Metadata Requester</td>
            </tr>
            <tr class="even">
            <td>Resource Server</td>
            <td>Metadata Requester</td>
            </tr>
            <tr class="odd">
            <td>Authorization Server</td>
            <td>Metadata Provider</td>
            </tr>
            </tbody>
            </table>
            <h3 id="31033-referenced-standards">3.103.3 Referenced
            Standards</h3>
            <p>This transaction relies on standards defined in the
            following documents and the references therein:</p>
            <ul>
            <li><p><em>OAuth 2.1</em>: The OAuth 2.1 Authorization
            Framework, published as draft-ietf-oauth-v2-1-01, 1 February
            2021.</p></li>
            <li><p><em>RFC8414</em>: OAuth 2.0 Authorization Server
            Metadata, June 2018</p></li>
            <li><p><em>OpenID Connect Discovery</em>: OpenID Connect
            Discovery 1.0 incorporating errata set 1, November
            2014</p></li>
            <li><p><em>RFC7517</em>: JSON Web Key (JWK), May
            2015</p></li>
            </ul>
            <h3 id="31034-messages">3.103.4 Messages</h3>
            <p>The Get Authorization Server Metadata transaction
            consists of a single request and response initiated by an
            Authorization Client or Resource Server as depicted in the
            diagram below:</p>
            <p><img src="media/get-authorization-server-metadata.png"
            alt="ITI-103 Get Authorization Server Metadata Diagram" /></p>
            <p><strong>Figure 3.103.4-1: Get Authorization Server
            Metadata [ITI-103] Diagram</strong></p>
            <pre class="plantuml"><code>@startuml get-authorization-server-metadata

participant &quot;Authorization Client\nor\nResource Server&quot; as Client
participant &quot;Authorization Server&quot; as AuthzServer

autonumber 0 1 &quot;&lt;b&gt;[00]&lt;/b&gt;&quot;
autoactivate on

Client -&gt; AuthzServer: Authorization Server Metadata Request
Client &lt;-- AuthzServer: Authorization Server Metadata Response

@enduml</code></pre>
            <h4
            id="310341-authorization-server-metadata-request">3.103.4.1
            Authorization Server Metadata Request</h4>
            <p>Used to request the metadata document of an Authorization
            Server.</p>
            <h5 id="3103411-trigger-events">3.103.4.1.1 Trigger
            Events</h5>
            <p>An Authorization Client or Resource Server wants to learn
            about Authorization Server endpoint locations, key material
            required for signature validation, or other relevant
            authorization data.</p>
            <h5 id="3103412-message-semantics">3.103.4.1.2 Message
            Semantics</h5>
            <p>The client issues a HTTP GET request to the well-known
            metadata endpoint associated with Authorization Server.</p>
            <p>There are various ways of formulating this endpoint as
            described in [RFC8414, section 3.1], and [OpenID Connect
            Discovery, section 4]. Authorization Servers are recommended
            to follow one of these procedures, but may choose a
            different well-known endpoint location mechanism.</p>
            <p>The manner in which the Authorization Clients or Resource
            Server are configured with the Authorization Server metadata
            endpoint locations is beyond the scope of this
            transaction.</p>
            <p>A non-normative example of such a request using [RFC8414]
            is:</p>
            <pre class="http"><code>GET /.well-known/oauth-authorization-server/tenant1 HTTP/1.1
Host: example.com</code></pre>
            <h5 id="3103413-expected-actions">3.103.4.1.3 Expected
            Actions</h5>
            <p>Upon receiving a metadata request, the Authorization
            Server should respond with the metadata document as
            described in <a
            href="#310342-authorization-server-metadata-response">ITI
            TF-2: 3.103.4.2</a>.</p>
            <p>Implementations supporting multi-tenancy shall respond
            with different metadata documents for different tenants,
            providing at least a different issuer value.</p>
            <p>Requests for metadata for non-existing tenants shall
            result in a HTTP 404 (not found) response.</p>
            <h4
            id="310342-authorization-server-metadata-response">3.103.4.2
            Authorization Server Metadata Response</h4>
            <p>The response is a set of claims about the Authorization
            Server's configuration, including all necessary endpoints
            and public key information.</p>
            <h5 id="3103421-trigger-events">3.103.4.2.1 Trigger
            Events</h5>
            <p>The Authorization Server Metadata Response message is
            returned as response to a valid Authorization Server
            Metadata Request.</p>
            <h5 id="3103422-message-semantics">3.103.4.2.2 Message
            Semantics</h5>
            <p>The response is a set of claims about the Authorization
            Server's configuration, including all necessary endpoints
            and public key location information.</p>
            <p>The response shall be structured as a plain JSON
            document.</p>
            <p>The document shall be structured according to the rules
            set forth in [RFC8414, Section 2], with these additional
            constraints:</p>
            <ul>
            <li><em>issuer (required)</em>: The Authorization Server's
            issuer identifier, which is a URL that uses the "https"
            scheme and has no query or fragment components. The URL
            shall use the "https" scheme. The URL shall contain the
            domain name of the URL at which the metadata document can be
            retrieved. The URL shall contain any path elements referring
            to a tenant. Other path elements, such as those referring to
            the document location (e.g., ".well-known" or
            "openid-configuration") should be omitted, e.g., a valid
            issuer associated with a metadata document retrievable at
            <code>https://example.com/.well-known/oauth-authorization-server/tenant1</code>
            would be <code>https://example.com/tenant1</code>.</li>
            <li><em>authorization_endpoint (required)</em>:
            Authorization Server's Authorization endpoint as used for
            the "authorization code" flow.</li>
            <li><em>token_endpoint (required)</em>: Authorization
            Server's Authorization token endpoint location.</li>
            <li>jwks_uri (conditional). URL of the Authorization
            Server's JWK Set [RFC7517, Section 5] document. An
            Authorization Server that supports the JWT Token or SAML
            Token Options shall provide this claim to communicate the
            public keys that can be used to verify JWT token or SAML
            token signatures.</li>
            <li><em>scopes_supported (optional)</em>: The list of scopes
            supported by the Authorization Server. Note this transaction
            does not define the scopes. Authorization Servers may opt to
            publish a subset of the scopes usable.</li>
            <li><em>response_types_supported (required)</em>: As the
            implicit grant flow is not supported in OAuth2.1, the
            response types should not include the value "token".
            Authorization Servers shall include the response type
            "code". Authorization Servers supporting [OpenId Connect] or
            other standards may include other token types, such as
            "id_token".</li>
            <li><em>grant_types_supported (required)</em>: A JSON array
            listing the type of grants supported toward the token
            endpoint. The list shall include the values
            "client_credentials", and "authorization_code".
            <ul>
            <li>Authorization Servers supporting refresh tokens shall
            include "refresh-token".</li>
            <li>Authorization Servers supporting the JWT grant shall
            include "urn:ietf:params:oauth:grant-type:jwt-bearer".</li>
            <li>Authorization Servers supporting the SAML grant shall
            include
            "urn:ietf:params:oauth:grant-type:saml2-bearer".</li>
            <li>Authorization Servers supporting other types of grants
            should provide additional values to this list representing
            those grant types.</li>
            </ul></li>
            <li><em>token_endpoint_auth_methods_supported
            (optional)</em>: JSON array containing a list of client
            authentication methods supported by this token endpoint.
            When provided, this list shall include
            "client_secret_basic".</li>
            <li><em>introspection_endpoint (conditional)</em>: URL of
            the Authorization Server's OAuth 2.0 introspection endpoint.
            This claim must be provided by Authorization Servers
            supporting the Token Introspection Option.</li>
            <li><em>introspection_endpoint_auth_methods_supported
            (conditional)</em>: JSON array containing a list of client
            authentication methods supported by the introspection
            endpoint. This claim must be provided by Authorization
            Servers supporting the Token Introspection Option. As the
            introspect option mandates support for Resource Server
            bearer access tokens, this claim must include the "Bearer"
            value. Other authentication methods (e.g.,
            "client_secret_basic") are allowed when supported by the
            Authorization Server.</li>
            </ul>
            <p>In addition to the claims provided in [RFC8414],
            Authorization Servers should provide the following
            claim:</p>
            <ul>
            <li><em>access_token_format (optional)</em>: JSON string
            defining the format of the access token as provided by the
            Authorization Server. This allows Resource Servers to learn
            about methods of verification. Authorization Servers
            supporting the JWT Token Option shall set this claim value
            to "ihe-jwt". Authorization Servers supporting the SAML
            Token Option shall set this claim value to "ihe-saml".
            Authorization Servers providing tokens that are non-parsable
            shall set this value to "opaque". Authorization Servers
            supporting access tokens in other structured formats may use
            alternative format identifiers.</li>
            </ul>
            <h5 id="3103423-expected-actions">3.103.4.2.3 Expected
            Actions</h5>
            <p>The Authorization Client or Resource Servers requesting
            the metadata document shall use the endpoint locations from
            the metadata document in its interactions with the
            Authorization Server.</p>
            <p>The Authorization Client or Resource Servers requesting
            the metadata document should use the JWK values retrieved
            from the jwks_uri endpoint published in the metadata
            document for validating JWT and/or SAML tokens.</p>
            <p>Resource Servers requesting the metadata document should
            use the "access_token_format" claim to determine the method
            of token validation and usage (e.g., interpret and validate
            access token as JWT structure).</p>
            <h3 id="31035-security-considerations">3.103.5 Security
            Considerations</h3>
            <p>All security considerations as described in [RFC8414,
            Section 6.2] shall be implemented.</p>
            <p><em>Note:</em> The issuer claim value of the metadata
            document is not necessarily the same as the issuer claim
            value associated with access-tokens. The issuer value in the
            metadata document refers to the source of the metadata
            document itself. This document may point to an token
            endpoint at a server other than the metadata document
            server. The issuer claim associated with the access token
            should refer to the server that implements the token
            endpoint.</p>
            <p>As the metadata document is intended to support the
            authorization processes, there is no need to provide client
            credentials towards the metadata endpoint. To prevent
            unnecessary disclosure of credentials, the Authorization
            Server Metadata Request shall not include and credentials
            from the Authorization Client or Resource Server.</p>
            <h1 id="33-mhd-profile">33 MHD Profile</h1>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following to MHD Volume
            1: Section 33.5 MHD Security Considerations</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h3
            id="3351-use-with-the-internet-user-authorization-iua-profile">33.5.1
            Use with the Internet User Authorization (IUA) Profile</h3>
            <p>The IUA Profile provides support for user authentication,
            app authentication, and authorization decisions. When MHD
            actors are grouped with IUA actors there are additional
            security and privacy functionality enabled by this grouping.
            There are additional requirements and functionality enabled
            through scope definitions that are transaction specific. See
            the Security Considerations sections of the MHD-defined
            transactions for guidance on scope definition when grouped
            with IUA actors.</p>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following to MHD Volume
            1: Section 33.6 MHD Cross Profile
            Considerations</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h3
            id="3364-use-with-the-internet-user-authorization-iua-profile">33.6.4
            Use with the Internet User Authorization (IUA) Profile</h3>
            <p>The IUA Profile provides support for user authentication,
            app authentication, and authorization decisions. When MHD
            actors are grouped with IUA actors there are additional
            security and privacy functionality enabled by this grouping.
            There are additional requirements and functionality enabled
            through scope definitions that are transaction-specific. See
            the Security Considerations sections of the MHD-defined
            transactions for guidance on scope definition when grouped
            with IUA actors.</p>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following to MHD Volume
            2: Section 3.65.5 Security Considerations</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h4
            id="36552-use-with-the-internet-user-authorization-iua-profile">3.65.5.2
            Use with the Internet User Authorization (IUA) Profile</h4>
            <p>The IUA Profile provides support for user authentication,
            app authentication, and authorization decisions. When MHD
            actors are grouped with IUA actors there are additional
            security and privacy functionality enabled by this grouping.
            There are additional requirements and functionality enabled
            through scope definitions that are transaction-specific.</p>
            <p>An MHD Document Source, when grouped with an IUA
            Authorization Client, shall use Get Access Token [ITI-71] to
            request the following scope from the IUA Authorization
            Server. This enables the MHD Document Source to submit a
            document using the Provide Document Bundle [ITI-65]
            transaction with the authorizing token in the combined
            transaction Incorporate Access Token [ITI-72].</p>
            <p>The MHD Document Recipient, when grouped with an IUA
            Resource Server, shall require Incorporate Access Token
            [ITI_72] in all Provide Document Bundle [ITI-65]
            transactions, shall enforce the authorization decision in
            the token, and may further enforce policies beyond those
            made by the Authorization Server such as consent or business
            rules.</p>
            <p>scope: <code>ITI-65</code></p>
            <p>This scope request authorizes the full [ITI-65]
            transaction. This scope implicitly requests patient-specific
            Create/Update for DocumentManifest, DocumentReference, List,
            and Binary. Further scope refinement is allowed in realm or
            project-specific situations; these scopes would be in
            addition to the scope defined here.</p>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following to MHD Volume
            2: Section 3.66.5 Security Considerations</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h4
            id="36652-use-with-the-internet-user-authorization-iua-profile">3.66.5.2
            Use with the Internet User Authorization (IUA) Profile</h4>
            <p>The IUA Profile provides support for user authentication,
            app authentication, and authorization decisions. When MHD
            actors are grouped with IUA actors there are additional
            security and privacy functionality enabled by this grouping.
            There are additional requirements and functionality enabled
            through scope definitions that are transaction specific.</p>
            <p>An MHD Document Consumer, when grouped with an IUA
            Authorization Client, shall use Get Access Token [ITI-72] to
            request the following scope from the IUA Authorization
            Server. This enables the MHD Document Consumer to use the
            Find Document Manifests [ITI-66] transaction with the
            authorizing token in the grouped transaction Incorporate
            Authorization Token [ITI-72].</p>
            <p>An MHD Document Consumer, when grouped with an IUA
            Authorization Client, shall use Get Access Token[ITI-71] to
            request the following scope from the IUA Authorization
            Server. This enables the MHD Document Consumer to query
            using [ITI-66] transaction with the authorizing token in the
            combined transaction Incorporate Access Token [ITI-72].</p>
            <p>The MHD Document Responder, when grouped with an IUA
            Resource Server, shall require Incorporate Access Token
            [ITI-72] in all Find Document Manifests [ITI-66] requests,
            shall enforce the authorization decision in the token, and
            may further enforce policies beyond those made by the
            Authorization Server such as consent or business rules.</p>
            <p>scope: <code>ITI-66</code></p>
            <p>This scope request authorizes the full [ITI-66]
            transaction. This scope implicitly requests patient-specific
            Search/Read for DocumentManifest resources as defined in
            [ITI-66]. Further scope refinement is allowed in realm or
            project-specific situations; these additional scopes would
            be in addition to the scope defined here.</p>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following to MHD Volume
            2: Section 3.67.5 Security Considerations</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h4
            id="36752-use-with-the-internet-user-authorization-iua-profile">3.67.5.2
            Use with the Internet User Authorization (IUA) Profile</h4>
            <p>The IUA Profile provides support for user authentication,
            app authentication, and authorization decisions. When MHD
            actors are grouped with IUA actors there are additional
            security and privacy functionality enabled by this grouping.
            There are additional requirements and functionality enabled
            through scope definitions that are transaction specific.</p>
            <p>An MHD Document Consumer, when grouped with an IUA
            Authorization Client, shall use Get Access Token [ITI-71] to
            request the following scope from the IUA Authorization
            Server. This enables the MHD Document Consumer to query
            using [ITI-67] transaction with the authorizing token in the
            combined transaction Incorporate Access Token [ITI-72].</p>
            <p>An MHD Document Responder, when grouped with an IUA
            Resource Server, shall require Incorporate Access Token
            [ITI-72] in all Find Document References [ITI-67] requests,
            shall enforce the authorization decision in the token, and
            may further enforce policies beyond those made by the
            Authorization Server such as consent or business rules.</p>
            <p>scope: <code>ITI-67</code></p>
            <p>This scope request authorizes the full [ITI-67]
            transaction. This scope implicitly requests patient-specific
            Search/Read for DocumentReference resources as defined in
            [ITI-67]. Further scope refinement is allowed in realm or
            project specific situations; these additional scopes would
            be in addition to the scope defined here.</p>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following to MHD Volume
            2: Section 3.68.5 Security Considerations</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h4
            id="36852-use-with-the-internet-user-authorization-iua-profile">3.68.5.2
            Use with the Internet User Authorization (IUA) Profile</h4>
            <p>The IUA Profile provides support for user authentication,
            app authentication, and authorization decisions. When MHD
            actors are grouped with IUA actors there are additional
            security and privacy functionality enabled by this grouping.
            There are additional requirements and functionality enabled
            through scope definitions that are transaction specific.</p>
            <p>An MHD Document Consumer, when grouped with an IUA
            Authorization Client, shall use Get Access Token [ITI-71] to
            request the following scope from the IUA Authorization
            Server. This enables the MHD Document Consumer to query
            using [ITI-68] transaction with the authorizing token in the
            combined transaction Incorporate Access Token [ITI-72].</p>
            <p>The MHD Document Responder, when grouped with an IUA
            Resource Server, shall require Incorporate Access Token
            [ITI-72] in all Retrieve Document [ITI-68] requests, shall
            enforce the authorization decision in the token, and may
            further enforce policies beyond those made by the
            Authorization Server such as consent or business rules.</p>
            <p>scope: <code>ITI-68</code></p>
            <p>This scope request authorizes the full [ITI-68]
            transaction. This scope implicitly requests patient-specific
            Read for Binary resources as defined in [ITI-68]. Further
            scope refinement is allowed in realm or project specific
            situations; these additional scopes would be in addition to
            the scope defined here.</p>
            <h1 id="9-atna-profile">9 ATNA Profile</h1>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following row to ATNA
            Volume 1: Section 9.2 ATNA Actor Options Table for both the
            Secure Node and Secure Application Actors</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <p>|------------------|------------------| | "STX: HTTPS
            IUA" | ITI TF-1:9.2.6.7 |
            |------------------|------------------|</p>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add Section 9.2.6.7 as
            follows</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h4 id="9267-stx-https-iua-option">9.2.6.7 STX: HTTPS IUA
            Option</h4>
            <p>Actors that support this option utilize server-side
            authenticated TLS (also known as https) to authenticate the
            server to the client and provide communications integrity
            and encryption. An actor that supports this option shall be
            grouped with actors in the Internet User Authorization (IUA)
            Profile to authenticate a client application to the server
            (IUA Resource Server). See <a
            href="#31966-stx-https-iua">ITI TF-2: 3.19.6.6</a>).</p>
            <table>
            <thead>
            <tr class="header">
            <th><strong>Editor: Please add the following section to
            Volume 2 as follows</strong></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
            <h4 id="31966-stx-https-iua-option">3.19.6.6 STX: HTTPS IUA
            Option</h4>
            <p>This configuration utilizes server-side authenticated TLS
            (also known as https) to authenticate the server to the
            client and provide communications integrity and encryption;
            and the IUA Profile to authenticate the client application
            to the server (IUA Resource Server).</p>
            <p>The ATNA Local Secure Node or Secure Application shall be
            grouped with an IUA Authorization Client. The ATNA Remote
            Secure Node or Secure Application shall be grouped with an
            IUA Resource Server.</p>
            <ul>
            <li>TLS shall be server side authenticated, and may be
            client authenticated</li>
            <li>TLS shall be compliant with BCP195</li>
            <li>Local Secure Node or Secure Application shall reject
            connections that are not https, and may enforce other
            policies</li>
            <li>Remote Secure Node or Secure Application shall reject
            connections that do not carry a valid IUA token, and may
            enforce other policies</li>
            </ul>

          </div>
        </div>
      </main>
    </div>

    <footer class="ihe-footer">
    <div class="grid-container fluid">
      <div class="grid-x grid-margin-x align-middle">
        <div class="cell medium-9 small-order-2 medium-order-1 text-center medium-text-left">
          © 2000 &mdash; <span id="current-year"></span> IHE International | TEL 1-630-481-1004 | 820&nbsp;Jorie&nbsp;Boulevard,
          Oak&nbsp;Brook, IL&nbsp;60523
        </div>
        <div class="cell medium-3 small-order-1 medium-order-2 text-center medium-text-right ihe-footer-icons">
          <a href="mailto:secretary@ihe.net"><i class="fi fi-mail"></i></a>
          <a href="https://www.linkedin.com/company/iheintl"><i class="fi fi-social-linkedin"></i></a>
          <a href="https://twitter.com/IHEIntl"><i class="fi fi-social-twitter" aria-hidden="true"></i></a>
          <a href="https://www.youtube.com/user/IHEIntl"><i class="fi fi-social-youtube" aria-hidden="true"></i></a>
        </div>
      </div>
    </div>
  </footer>

    <script src="../../js/vendor/jquery.min.js"></script>
    <script src="../../js/vendor/motion-ui.min.js"></script>
    <script src="../../js/vendor/what-input.js"></script>
    <script src="../../js/vendor/foundation.min.js"></script>
    <script src="../../js/app.js"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HLBNC861DJ');
</script>
  </body>
</html>
