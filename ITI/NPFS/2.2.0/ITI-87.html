<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>2:3.87 Submit File [ITI-87] - Non-patient File Sharing (NPFS) v2.2.0</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->
<link href="assets/css/ihe.css" rel="stylesheet"/>
<link href="assets/css/nonum.css" rel="stylesheet"/>
<script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-HLBNC861DJ" async> </script> 


    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="fhir-logo" sizes="144x144" href="assets/ico/icon-fhir-144.png"/>
    <link rel="fhir-logo" sizes="114x114" href="assets/ico/icon-fhir-114.png"/>
    <link rel="fhir-logo" sizes="72x72" href="assets/ico/icon-fhir-72.png"/>
    <link rel="fhir-logo" href="assets/ico/icon-fhir-57.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"3"}
    h3,h4,h5,h6{--heading-prefix:"3"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->
      <div class="container">  <!-- container -->
        <!-- Placeholder for child template header declarations -->

<div id="project-nav">
  <a id="ihe-logo" no-external="true" href="http://profiles.ihe.net">
    <img height="71" alt="Visit the IHE website" src="assets/images/ihe-international.png"/>
  </a>
</div>
<div id="family-nav">
  <a id="family-logo" no-external="true" href="http://hl7.org/fhir"><img height="30" alt="Visit the FHIR website" src="assets/images/fhir-logo.png"/> </a>
</div>
<!--
<div id="hl7-search">
  <a id="hl7-search-lnk" no-external="true" href="searchform.html"><img alt="Search FHIR" src="assets/images/search.png"/></a>
</div>
-->
<div id="project-nav">
  
  
    <a id="project-logo" no-external="true" href="http://profiles.ihe.net/ITI/index.html"><img height="70" alt="Visit the ITI website" src="assets/images/ITI.png"/> </a>
</div>

        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">Non-patient File Sharing (NPFS)</span>
            <br/>
            <span style="display:inline-block;">2.2.0 - Trial-Implementation



  <img alt="International flag" src="assets/images/001.svg" height="16" title="International"/>


            </span>
          </p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->

    <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">  <!-- container -->
        <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
          <!--status-bar-->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a class="navbar-brand hidden" href="http://hl7.org/fhir/R4/index.html">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <!-- menu.xml  -->

<ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
  <li>
    <a href="index.html">NPFS Home</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Volume 1
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="volume-1.html">Introduction</a>
      </li>
      <li>
        <a href="volume-1.html#1471-npfs-actors-transactions-and-content-modules">Actors and Transactions</a>
      </li>
      <li>
        <a href="volume-1.html#1472-npfs-actor-options">Actor Options</a>
      </li>
      <li>
        <a href="volume-1.html#1473-npfs-required-actor-groupings">Required Groupings</a>
      </li>
      <li>
        <a href="volume-1.html#1474-npfs-overview">Overview</a>
      </li>
      <li>
        <a href="volume-1.html#1475-npfs-security-considerations">Security Considerations</a>
      </li>
      <li>
        <a href="volume-1.html#1476-npfs-cross-profile-considerations">Cross-Profile Considerations</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Volume 2
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="ITI-87.html">Submit File [ITI-87]</a>
      </li>
      <li>
        <a href="ITI-88.html">Search File [ITI-88]</a>
      </li>
      <li>
        <a href="ITI-89.html">Update DocumentReference [ITI-89]</a>
      </li>
      <li>
        <a href="ITI-109.html">Retrieve File [ITI-109]</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="artifacts.html">Artifacts</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Other
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="other.html">Changes to Other IHE Specifications</a>
      </li>
      <li>
        <a href="download.html">Download and Analysis</a>
      </li>
      <li>
        <a href="testplan.html">Test Plan</a>
      </li>
    </ul>
  </li>
</ul>
            </div>  <!-- /.nav-collapse -->
          </div>  <!-- /.container -->
        </nav>  <!-- /.navbar -->
      <!-- /HEADER CONTENT -->
      </div>  <!-- /container -->
    </div>  <!-- /segment-navbar -->
    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><b>2:3.87 Submit File [ITI-87]</b></li>

          <span style="float:right;">

            <a href="volume-1.html">&lt;prev</a> | 

            <a href="#bottom">bottom</a>

          | <a href="ITI-88.html">next&gt;</a>

          </span>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">This page is part of the Non-patient File Sharing (NPFS) (v2.2.0: Publication) based on <a no-external="true" href="http://hl7.org/fhir/R4">FHIR R4</a>. This is the current published version in its permanent home (it will always be available at this URL).  For a full list of available versions, see the <a no-external="true" href="https://profiles.ihe.net/ITI/NPFS/history.html">Directory of published versions</a></p><!--EndReleaseHeader-->
  <h2>2:3.87 Submit File [ITI-87]</h2>
  












    <p><!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#23871-scope" id="markdown-toc-23871-scope">2:3.87.1 Scope</a></li>
  <li><a href="#23872-actors-roles" id="markdown-toc-23872-actors-roles">2:3.87.2 Actors Roles</a></li>
  <li><a href="#23873-referenced-standards" id="markdown-toc-23873-referenced-standards">2:3.87.3 Referenced Standards</a></li>
  <li><a href="#23874-messages" id="markdown-toc-23874-messages">2:3.87.4 Messages</a></li>
  <li><a href="#23875-security-considerations" id="markdown-toc-23875-security-considerations">2:3.87.5 Security Considerations</a></li>
</ul>

</div>

<h3 id="23871-scope">2:3.87.1 Scope</h3>

<p>This transaction allows a File Source to publish a new file and related
metadata. It also enables update of an existing file and update its
metadata and replacement of a file.</p>

<p>The files are not associated with a patient.</p>

<h3 id="23872-actors-roles">2:3.87.2 Actors Roles</h3>

<div>
<table border="1" borderspacing="0" style="border: 1px solid black; border-collapse: collapse">
    <caption style="text-align:left">
        <b> Table 2:3.87.2-1: Actor Roles </b>
    </caption>
    <tbody>
        <tr>
            <td style="padding:3px"><b>Actor:</b></td>
            <td><a href="volume-1.html#147113-file-source">File Source</a></td>
        </tr>
       <tr>
            <td><b>Role:</b></td>
            <td>Sends non-patient files and related metadata to a File Manager</td>
        </tr>
        <tr>
            <td><b>Actor:</b></td>
            <td><a href="volume-1.html#147111-file-manager">File Manager</a></td>
        </tr>
        <tr>
            <td><b>Role:</b></td>
            <td>Stores received non-patient files and maintains related metadata</td>
        </tr>
    </tbody>
</table>
</div>
<p><br /></p>

<h3 id="23873-referenced-standards">2:3.87.3 Referenced Standards</h3>

<table border="1" borderspacing="0" style="border: 1px solid black; border-collapse: collapse">
    <tbody>
        <tr>
            <td style="padding:3px">HL7 FHIR</td>
            <td><a href="http://www.hl7.org/FHIR/R4">HL7 FHIR Release 4.0</a></td>
        </tr>
    </tbody>
</table>

<h3 id="23874-messages">2:3.87.4 Messages</h3>

<div>
<?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="246px" preserveAspectRatio="none" style="width:264px;height:246px;background:#FFFFFF;" version="1.1" viewBox="0 0 264 246" width="264px" zoomAndPan="magnify"><defs /><g><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="43" y="69.9609" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="43" y="130.6641" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="43" y="191.3672" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="205" y="69.9609" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="205" y="130.6641" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="205" y="191.3672" /><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="48" x2="48" y1="37.6094" y2="239.7188" /><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="209.5" x2="209.5" y1="37.6094" y2="239.7188" /><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86" x="5" y="5" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="12" y="26.5332">File Source</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97" x="161.5" y="5" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="168.5" y="26.5332">File Manager</text><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="43" y="69.9609" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="43" y="130.6641" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="43" y="191.3672" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="205" y="69.9609" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="205" y="130.6641" /><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="205" y="191.3672" /><polygon fill="#181818" points="193,65.9609,203,69.9609,193,73.9609,197,69.9609" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="53" x2="199" y1="69.9609" y2="69.9609" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="60" y="65.1045">Create File Request</text><polygon fill="#181818" points="59,96.3125,49,100.3125,59,104.3125,55,100.3125" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="53" x2="209" y1="100.3125" y2="100.3125" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="65" y="95.4561">Submit File Response</text><polygon fill="#181818" points="193,126.6641,203,130.6641,193,134.6641,197,130.6641" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="53" x2="199" y1="130.6641" y2="130.6641" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="60" y="125.8076">Update File Request</text><polygon fill="#181818" points="59,157.0156,49,161.0156,59,165.0156,55,161.0156" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="53" x2="209" y1="161.0156" y2="161.0156" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="65" y="156.1592">Update File Response</text><polygon fill="#181818" points="193,187.3672,203,191.3672,193,195.3672,197,191.3672" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="53" x2="199" y1="191.3672" y2="191.3672" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="60" y="186.5107">Replace File Request</text><polygon fill="#181818" points="59,217.7188,49,221.7188,59,225.7188,55,221.7188" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="53" x2="209" y1="221.7188" y2="221.7188" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="65" y="216.8623">Submit File Response</text></g></svg>
<p><b>Figure 2:3.87.4-1: Create File Interactions</b></p>
</div>
<p><br clear="all" /></p>

<h4 id="238741-create-file-request-message">2:3.87.4.1 Create File Request Message</h4>

<p>The File Source uses this message to submit a new file (Binary Resource)
and related metadata (DocumentReference Resource) to a target File
Manager using a FHIR transaction.</p>

<h5 id="2387411-trigger-events">2:3.87.4.1.1 Trigger Events</h5>

<p>The File Source needs to submit a new file to a File Manager. The file
may have been created by the File Source itself or by another file
creator.</p>

<h5 id="2387412-message-semantics">2:3.87.4.1.2 Message Semantics</h5>

<p>The File Source shall issue an HTTP request according to requirements
defined in the HL7<sup>®</sup> FHIR<sup>®</sup> standard for “create”
interaction (<a href="http://hl7.org/fhir/R4/http.html#create">http://hl7.org/fhir/R4/http.html#create</a> ). The message
uses an HTTP POST method to submit a FHIR Bundle Resource.</p>

<p>The Bundle Resource:</p>

<ul>
  <li>
    <p>shall contain one Binary Resource
(<a href="https://www.hl7.org/fhir/R4/binary.html">https://www.hl7.org/fhir/R4/binary.html</a>) representing the file. The
Binary Resource shall contain the base64-encoded file in the content
element and the mime-type of the file in the contentType element.</p>
  </li>
  <li>
    <p>shall contain one FHIR DocumentReference Resource
(<a href="https://www.hl7.org/fhir/R4/documentreference.html">https://www.hl7.org/fhir/R4/documentreference.html</a>) with the file’s
metadata. Constraints on the DocumentReference Resource are listed in <a href="StructureDefinition-IHE.NPFS.DocumentReference.html">Resource Profile: NPFS DocumentReference</a>.</p>
  </li>
  <li>
    <p>may contain other resources that are referenced by the
DocumentReference Resource.</p>
  </li>
</ul>

<p>The File Source shall submit FHIR resources in either XML format or JSON
format. Values for media-type of the request message are defined in the
<a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.6-populating-the-expected-response-format">ITI TF-2: Appendix Z.6</a> (currently in the Appendix Z on HL7 FHIR Trial
Implementation Supplement).</p>

<p>See <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-W.html#Appendix%20W">ITI TF-2: Appendix W</a> for informative implementation material for
this transaction.</p>

<p>Sections below provide specific guidance about how handle metadata for
stylesheets, workflow definitions, and privacy policies. If other files
types will be managed, local policy should establish values for type,
category, format, mime-type and masterIdentifier elements.</p>

<h6 id="23874121-category-element">2:3.87.4.1.2.1 category element</h6>

<p>Codes in the category element shall be from <a href="ValueSet-DocumentReferenceCategory.html">ValueSet: NPFS DocumentReference category</a>, if any
of the codes within the value set can apply to the concept being
communicated. If the table does not cover the concept (based on human
review), an alternate code may be used instead.</p>

<h6 id="23874122-type-element">2:3.87.4.1.2.2 type element</h6>

<p>This section identifies specific guidelines for the type element which
depends on the “class” of the file:</p>

<ul>
  <li>
    <p>If the file submitted is a Workflow Definition template, the type
element could be valued with the workflow definition reference of the
Workflow Definition profile (see workflowDefinitionReference as
defined by the XDW Profile; <a href="https://www.ihe.net/uploadedFiles/Documents/ITI/IHE_ITI_TF_Rev15.0_Vol3_FT_2018-07-24.pdf">see ITI TF-3: 5.4.2.2</a>).</p>
  </li>
  <li>
    <p>If the file submitted is a Patient Privacy Policy (see ITI TF-1:
19.2.1 Basic Patient Privacy Consent), the type element should be
valued with the LOINC code 57017-6 “Privacy policy Organization
Document” as shown in <a href="ValueSet-DocumentReferenceCategory.html">ValueSet: NPFS DocumentReference category</a>.</p>
  </li>
  <li>
    <p>If the file submitted is a Stylesheet, the type element will be valued
with a codeable concept defined by local policy that classifies the
type of the stylesheet. The codeable concept of the type element shall
be defined by both a code and a system (e.g., code= “laboratory”
system=”http://localdomain.org/stylesheetstype”).</p>
  </li>
</ul>

<h6 id="23874123-file-relationships">2:3.87.4.1.2.3 File relationships</h6>

<p>The relatesTo element holds relationships that the file has with other
non-patient files. The DocumentReference.relatesTo element allows for
the creation of those relationships (i.e., replacement, sign, transform,
or append).</p>

<h6 id="23874124-masteridentifier-element">2:3.87.4.1.2.4 MasterIdentifier element</h6>

<p>This section identifies specific requirements for the masterIdentifier
element, if used:</p>

<ul>
  <li>
    <p>If the file submitted is a Workflow Definition template, the
masterIdentifier element shall be valued with the
workflowDefinitionReference as defined by the XDW Profile (<a href="https://www.ihe.net/uploadedFiles/Documents/ITI/IHE_ITI_TF_Rev15.0_Vol3_FT_2018-07-24.pdf">see ITI TF-3: 5.4.2.2</a>) .</p>
  </li>
  <li>
    <p>If the file submitted is a Patient Privacy Policy (<a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-19.html">see ITI TF-1: 19.2.1 Basic Patient Privacy Consent</a>), the masterIdentifier element
shall be valued with the associated Patient Privacy Policy Identifier.</p>
  </li>
</ul>

<p>Local policies should define how to handle this element in case of
file’s revision, update or replacement.</p>

<h6 id="23874125-create-file-request-message-example">2:3.87.4.1.2.5 Create File request message example</h6>

<p>For an example of a Create File Request Bundle see <a href="Bundle-ex-CreateDocumentBundle.html">Example Bundle: Create Document Bundle</a>.</p>

<h5 id="2387413-expected-actions">2:3.87.4.1.3 Expected Actions</h5>

<p>The File Manager shall support all the media-types defined in <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.6-populating-the-expected-response-format">ITI TF-2: Appendix Z.6</a> (currently in the Appendix Z on HL7 FHIR Trial
Implementation Supplement).</p>

<p>On receipt of the Create File Request, the File Manager shall validate
the Resources and respond with one of the HTTP codes defined in <a href="ITI-87.html#2387442-message-semantics">Section 3.87.4.4.2 Message Semantics</a>.</p>

<p>The File Manager shall process the Bundle atomically.</p>

<p>The File Manager shall support Create File Request messages that contain
one Binary Resource and one DocumentReference Resource. The File Manager
shall store these resources and make them available for further
processing, e.g., file update or replacement [ITI-87], file metadata
update [ITI-89], search [ITI-88], and retrieve [ITI-109].</p>

<p>If the File Manager receives a Create File Request message that contains
resources other than the required ones, it may respond to the File
Source with a failure (see <a href="ITI-87.html#2387442-message-semantics">Section 3.87.4.4.2</a>).</p>

<h4 id="238742-update-file-request-message">2:3.87.4.2 Update File Request Message</h4>

<p>The File Source uses this message to update a file already existing on
the File Manager.</p>

<p>This message is used when there is a prior file that does not need to be
preserved.</p>

<p>The File Manager is not required to support FHIR resource versioning
(<a href="https://www.hl7.org/fhir/R4/versions.html">https://www.hl7.org/fhir/R4/versions.html</a>).</p>

<h5 id="2387421-trigger-events">2:3.87.4.2.1 Trigger Events</h5>

<p>The File Source needs to update a file that exists on the File Manager.</p>

<p>Prior to sending the update, the File Source shall discover the resource
ids of the existing DocumentReference Resource and the Binary Resource
to be updated.</p>

<h5 id="2387422-message-semantics">2:3.87.4.2.2 Message Semantics</h5>

<p>The File Source shall issue an HTTP request according to requirements
defined in the HL7<sup>®</sup> FHIR<sup>®</sup> standard for “update”
interaction (<a href="http://hl7.org/fhir/R4/http.html#update">http://hl7.org/fhir/R4/http.html#update</a>).</p>

<p>The message uses an HTTP POST to submit a FHIR Bundle that contains the
updated Binary and DocumentReference Resources. For each resource in the
Bundle, the bundle.entry.request.method shall be valued with the HTTP
PUT Method.</p>

<p>The Bundle Resource shall contain:</p>

<ul>
  <li>
    <p>one Binary Resource (<a href="https://www.hl7.org/fhir/R4/binary.html">https://www.hl7.org/fhir/R4/binary.html</a>)
representing the file that will update the existing Binary Resource.
The id of the Binary Resource shall be valued with the id of the
Binary Resource to be updated on the File Manager.</p>
  </li>
  <li>
    <p>one DocumentReference Resource
(<a href="https://www.hl7.org/fhir/R4/documentreference.html">https://www.hl7.org/fhir/R4/documentreference.html</a>) with updated
metadata. The id of the DocumentReference Resource shall be valued
with the id of the DocumentReference Resource to be updated;
constraints on the DocumentReference Resource are listed in <a href="StructureDefinition-IHE.NPFS.DocumentReference.html">Resource Profile: NPFS DocumentReference</a>.</p>
  </li>
</ul>

<p>The File Source shall submit FHIR resources in either XML format or JSON
format. Values for media-type of the request message are defined in the
<a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.6-populating-the-expected-response-format">ITI TF-2: Appendix Z.6</a> (currently in the Appendix Z on HL7 FHIR Trial
Implementation Supplement).</p>

<h6 id="23874221-update-file-request-message-example">2:3.87.4.2.2.1 Update File Request message example</h6>

<p>For an example of a Update File Request Bundle see <a href="Bundle-ex-UpdateDocumentBundle.html">Example Bundle: Update Document Bundle</a>.</p>

<h5 id="2387423-expected-actions">2:3.87.4.2.3 Expected Actions</h5>

<p>The File Manager shall support all the media-type defined in <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.6-populating-the-expected-response-format">ITI TF-2: Appendix Z.6</a> (currently in the Appendix Z on HL7 FHIR Trial
Implementation Supplement).</p>

<p>On receipt of the Update File Request, the File Manager shall respond
with one of the HTTP codes defined in <a href="ITI-87.html#2387442-message-semantics">Section 3.87.4.4.2 Message Semantics</a>.</p>

<p>The File Manager shall process the Bundle atomically.</p>

<p>The File Manager shall support Update File Request messages that contain
one Binary Resource and one DocumentReference Resource. The File Manager
shall store these resources and make them available for further
processing, e.g., file update or replacement [ITI-87], file metadata
update [ITI-89], search [ITI-88], and retrieve [ITI-109].</p>

<p>The previous content in the updated Binary and DocumentReference
Resources will be no longer accessible, and the new file will be
retrievable using the same bundle.entry.fullUrl as the previous one.</p>

<p>If the File Manager receives an Update File Request message that
contains resources other than the required ones, it may respond to the
File Source with a failure (see <a href="ITI-87.html#2387442-message-semantics">Section 3.87.4.4.2</a>).</p>

<h4 id="238743-replace-file-request-message">2:3.87.4.3 Replace File Request Message</h4>

<p>The File Source uses this message to replace a file already existing on
the File Manager.</p>

<p>This message is used when there is a prior file that needs to be
preserved, so the existing Binary and Document Reference Resources will
be superseded (i.e., deprecated).</p>

<p>The File Manager is not required to support FHIR resource versioning
(<a href="https://www.hl7.org/fhir/R4/versions.html">https://www.hl7.org/fhir/R4/versions.html</a>).</p>

<h5 id="2387431-trigger-events">2:3.87.4.3.1 Trigger Events</h5>

<p>The File Source needs to replace a file that exists on the File Manager.</p>

<p>The replace mechanism will be handled by creating a new file and
updating the previous DocumentReference Resource in one message.</p>

<h5 id="2387432-message-semantics">2:3.87.4.3.2 Message Semantics</h5>

<p>This message uses an HTTP POST to submit a FHIR Bundle that contains the
new Binary and DocumentReference Resources and also the prior
DocumentReference Resource that needs to be replaced.</p>

<p>The Bundle Resource shall contain:</p>

<ul>
  <li>
    <p>one Binary Resource representing the new file, valued according to
<a href="ITI-87.html#2387412-message-semantics">Section 3.87.4.1.2</a>, with the bundle.entry.request.method element set
to POST</p>
  </li>
  <li>
    <p>one DocumentReference Resource with metadata for the new file, where
the DocumentReference.status shall be set to “current”, the
relatesTo.code shall be set to “replaces”, and the relatesTo.target to
the URL of the previous DocumentReference Resource, and the
bundle.entry.request.method element set to POST</p>
  </li>
  <li>
    <p>one DocumentReference Resource with metadata of the previous file,
valued as specified in <a href="ITI-89.html#2389411-trigger-events">Section 3.89.4.1.1</a> with the
bundle.entry.request.method element set to PUT and the
DocumentReference.status to “superseded”</p>
  </li>
</ul>

<h5 id="2387433-expected-actions">2:3.87.4.3.3 Expected Actions</h5>

<p>The File Manager shall support all the media-types defined in <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.6-populating-the-expected-response-format">ITI TF-2: Appendix Z.6</a> (currently in the Appendix Z on HL7 FHIR Trial
Implementation Supplement).</p>

<p>On receipt of the Replace File Request, the File Manager shall validate
the Resources and respond with one of the HTTP codes defined in <a href="ITI-87.html#2387442-message-semantics">Section 3.87.4.4.2 Message Semantics</a>.</p>

<p>The File Manager shall process the Bundle atomically.</p>

<p>The File Manager shall store these resources and make the new file
available for further processing, e.g., file update or replacement
[ITI-87], file metadata update [ITI-89], search [ITI-88], and
retrieve [ITI-109].</p>

<p>If the File Manager receives a Replace File Request message that
contains resources other than the required ones, it may respond to the
File Source with a failure (<a href="ITI-87.html#2387442-message-semantics">see Section 3.87.4.4.2</a>).</p>

<h4 id="238744-submit-file-response-message">2:3.87.4.4 Submit File Response Message</h4>

<p>The File Manager sends a Submit File Response message in response to a
Create File Request, an Update File Request, or a Replace File Request
Message.</p>

<h5 id="2387441-trigger-events">2:3.87.4.4.1 Trigger Events</h5>

<p>When the File Manager has finished creating or updating the file and
metadata received from the File Source, the File Manager sends this
message to the File Source acknowledging the result of the create,
update or replace request.</p>

<h5 id="2387442-message-semantics">2:3.87.4.4.2 Message Semantics</h5>

<p>When the File Manager has processed the request, it shall return an HTTP
response with an overall status code.</p>

<p>The File Manager returns a HTTP status code appropriate to the
processing, conforming to the transaction specification requirements as
specified in <a href="http://hl7.org/fhir/R4/http.html#transaction-response">http://hl7.org/fhir/R4/http.html#transaction-response</a>.</p>

<p>To allow the File Source to know the outcome of processing the
transaction, and the identities assigned to the resources by the File
Manager, the File Manager shall return a Bundle, with type set to
transaction-response, that contains one entry for each entry in the
request, in the same order as received, with the outcome of processing
the entry. Each entry element shall contain a response element with an
HTTP Status Code which details the outcome of processing of the request
entry.</p>

<p>If the operation is a success, the HTTP status code of the response
shall be a 2xx code.</p>

<p>If the operation is a failure, the File Manager shall be capable of
returning the following status code:</p>

<ul>
  <li>
    <p>422 – Unprocessable Entity:</p>
  </li>
  <li>
    <p>When the FHIR Resource DocumentReference.type is not supported by the File Manager</p>
  </li>
  <li>
    <p>If the Bundle Resource contains resources other than Binary, DocumentReference Resources and the resources referenced by the DocumentReference Resource</p>
  </li>
</ul>

<p>The File Manager can return other status codes 4xx or 5xx in accordance
to internal business rules that are out of scope for this transaction.</p>

<h5 id="2387443-expected-actions">2:3.87.4.4.3 Expected Actions</h5>

<p>The File Source processes the response according to application-defined
rules.</p>

<h4 id="238745-capabilitystatement-resource">2:3.87.4.5 CapabilityStatement Resource</h4>

<p>File Managers implementing this transaction shall provide a CapabilityStatement Resource as described in <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.3-capabilitystatement-resource">ITI TF-2: Appendix Z.3</a> indicating the transaction has been implemented.</p>

<ul>
  <li>Requirements CapabilityStatement for <a href="CapabilityStatement-IHE.NPFS.FileSource.html">File Source</a></li>
  <li>Requirements CapabilityStatement for <a href="CapabilityStatement-IHE.NPFS.FileSourceOption.html">File Source implementing Update DocumentReference</a></li>
  <li>Requirements CapabilityStatement for <a href="CapabilityStatement-IHE.NPFS.FileManager.html">File Manager</a></li>
</ul>

<h3 id="23875-security-considerations">2:3.87.5 Security Considerations</h3>

<p>See <a href="volume-1.html#1475-npfs-security-considerations">NPFS Security Considerations</a>.</p>

<p>The files are not Patient specific, but they may have other needs for security controls, such as business knowledge restrictions. Thus the use of Security may be applicable.
Actors involved in this transaction should be aware that even if the
Resources exchanged do not contain PHI or other private information,
actions such creating, updating, or replacing those Resources could
compromise patient care or have other legal ramifications. For general
security considerations, see <a href="https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.8-mobile-security-considerations">ITI TF-2: Appendix Z.8</a> (currently in the
Appendix Z on HL7 FHIR Trial Implementation Supplement).</p>

<h4 id="238751-security-audit-considerations">2:3.87.5.1 Security Audit Considerations</h4>

<p>The File Source, when grouped with <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-9.html">ATNA</a> Secure Node or Secure Application Actor, shall be able to record a <a href="StructureDefinition-IHE.NPFS.SubmitFile.Audit.Source.html">Submit File Source Audit Event Log</a>.</p>

<p>The File Manager, when grouped with <a href="https://profiles.ihe.net/ITI/TF/Volume1/ch-9.html">ATNA</a> Secure Node or Secure Application Actor, shall be able to record a <a href="StructureDefinition-IHE.NPFS.SubmitFile.Audit.Manager.html">Submit File Manager Audit Event Log</a>.</p>

<p>The File Source and File Manager may also record fundamental AuditEvents for each individual resource Created or Updated, using the <a href="https://profiles.ihe.net/ITI/BALP/index.html">BALP</a> <a href="https://profiles.ihe.net/ITI/BALP/content.html#3573-restful-activities">basic profile for REST events</a>.</p>




</div>
        </div>  <!-- /inner-wrapper -->
      </div>  <!-- /row -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-content -->

  <script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

  <script type="text/javascript">
    $(document).ready(function(){
      if(window.location.hash != "") {
          $('a[href="' + window.location.hash + '"]').click()
      }
    });
  </script>
  <a name="bottom"> </a>
  <div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
    <div class="container">  <!-- container -->

      <div style="background-color:var(--footer-nav-bg-color)">
        <table style="width:100%">
          <tbody>
            <tr>
              <td style="text-align:left">&#xA0;

                <a href="volume-1.html">&lt;prev</a>

              </td>
              <td style="text-align:center">
                <a href="#top">top</a>
              </td>
              <td style="text-align:right">&#xA0;

                <a href="ITI-88.html">next&gt;</a>

              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="inner-wrapper">
        <p>
          IG &#169; 2021+ <a style="color:var(--footer-hyperlink-text-color)" href="https://www.ihe.net/ihe_domains/it_infrastructure/">IHE IT Infrastructure Technical Committee</a>.  Package ihe.iti.npfs#2.2.0 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Thu, Nov 16, 2023 16:07-0600">2023-11-16</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)">
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                  | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/IHE/ITI.NPFS/issues/new/choose">New Issue</a> | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/IHE/ITI.NPFS/issues">Issues</a>
                
                 <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://profiles.ihe.net/ITI/NPFS/history.html">Version History</a></a> |
                 <a style="color: var(--footer-hyperlink-text-color)" rel="license" href="https://profiles.ihe.net/GeneralIntro/ch-9.html"><img style="border-style: none;" alt="CC0" src="assets/images/cc-by.png" height="17"/></a> |
                <!-- <a style="color: var(--footer-hyperlink-text-color)" href="searchform.html">Search</a> | -->
                 <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://www.ihe.net/resources/public_comment/">Propose a change<img alt="external" style="vertical-align: baseline" src="external.png"/></a>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HLBNC861DJ');
</script>

          </span>
        </p>
      </div>  <!-- /inner-wrapper -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
    <div class="container">  <!-- container -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-post-footer -->
  
  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
  <script type="text/javascript" src="assets/js/respond.min.js"> </script>
  <script type="text/javascript" src="assets/js/anchor.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard-btn.js"> </script>
  <script>anchors.options.visible = 'hover'
anchors.add()</script>
  
<!-- feedback form - Google forms -->
<!-- v0.1, 2021-01-09 -->


  
    
  


  
    
  



<!-- / feedback form  -->

  <!-- Analytics Below
  ================================================== -->
  </body>
</html>

